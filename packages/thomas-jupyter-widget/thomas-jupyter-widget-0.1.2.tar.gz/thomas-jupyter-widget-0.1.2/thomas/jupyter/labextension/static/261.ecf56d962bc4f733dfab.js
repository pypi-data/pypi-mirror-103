(self.webpackChunkthomas_jupyter_widget=self.webpackChunkthomas_jupyter_widget||[]).push([[261,568],{1568:(t,e,i)=>{t.exports=i(1367),t.exports.version=i(306).version},6261:(t,e,i)=>{var s=i(1568),n=i(1337);t.exports={id:"thomas-jupyter-widget:plugin",requires:[n.IJupyterWidgetRegistry],activate:function(t,e){e.registerWidget({name:"thomas-jupyter-widget",version:s.version,exports:s})},autoStart:!0}},1367:(t,e,i)=>{var s=i(1337),n=i(5431),h=i(4827);const{v1:d}=i(2231);var o=s.DOMWidgetModel.extend({defaults:n.extend(s.DOMWidgetModel.prototype.defaults(),{_view_name:"View",_model_name:"Model",_view_module:"thomas-jupyter-widget",_model_module:"thomas-jupyter-widget",_model_module_version:"0.1.0",_view_module_version:"0.1.0",value:{},marginals_and_evidence:{},evidence_sink:"",height:300})});function a(t,e,i,s,n,h,d,o){if(t===i&&e===s||n===d&&h===o)return console.warn("Found line of length 0"),!1;var a=(o-h)*(i-t)-(d-n)*(s-e);if(0===a)return console.warn("Denominator is zero 0"),!1;let r=((d-n)*(e-h)-(o-h)*(t-n))/a,l=((i-t)*(e-h)-(s-e)*(t-n))/a;return!(r<0||r>1||l<0||l>1)&&{x:t+r*(i-t),y:e+r*(s-e)}}function r(t,e){const i=[["tl","tr"],["tl","bl"],["tr","br"],["bl","br"]];var s=!1;for(const n of i){const i=n[0],h=n[1];if(s=a(t[i].x,t[i].y,t[h].x,t[h].y,e.src.x,e.src.y,e.dst.x,e.dst.y))break}return s||console.warn("Could not determine intersection"),s}class l extends h.Group{constructor(t,e,i,s){super({x:t.position[0],y:t.position[1],draggable:!0});const{onDragMove:n,onDragEnd:h,onStateSelected:d}=s;this.RV=t.RV,this.name=t.name,this.node=t,this.edges=[],this._title_height=15,this._state_offset=8,this._state_height=14,this._state_padding=2,this._width=180,this._height=this.computeHeight(),this.width(this._width),this.height(this._height),this.createBackground(),this.createTitle(),this.createStates(e,i,d),this.on("dragmove",(()=>n(this))),this.on("dragend",(()=>h(this)))}addEdge(t){this.edges.push(t)}getCenter(){return{x:this.x()+this.width()/2,y:this.y()+this.height()/2}}getCorners(){return{tl:{x:this.x(),y:this.y()},tr:{x:this.x()+this.width(),y:this.y()},bl:{x:this.x(),y:this.y()+this.height()},br:{x:this.x()+this.width(),y:this.y()+this.height()}}}computeHeight(){const{node:t}=this;return t.states.length*this._state_height+2*this._state_offset+this._title_height}createBackground(){this.add(new h.Rect({fill:"#efefef",width:this._width,height:this._height,cornerRadius:5,shadowBlur:5}))}createTitle(){const{node:t}=this,e=new h.Label;e.add(new h.Text({text:t.RV,padding:4,fontSize:this._title_height,fontStyle:"bold",width:this._width})),t.RV!=t.name&&e.add(new h.Text({x:20,text:`| ${t.name}`,padding:4,fontSize:this._title_height-2,fontStyle:"normal",verticalAlign:"bottom",width:this._width})),this.add(e)}createState(t,e,i,s,n){const d=this._title_height+this._state_offset+e*this._state_height,o=this._width-70-55;var a="...",r=0,l="#003366";s&&s===t&&(l="#00BCCC"),i&&(a=(100*i[t]).toFixed(2)+"%",r=1+o*i[t]);const g=new h.Group({y:d});g.add((new h.Label).add(new h.Text({text:t,padding:this._state_padding,fontSize:this._state_height-this._state_padding,wrap:"none",ellipsis:"ellipsis",width:this._width}))),g.add(new h.Rect({x:70,y:1,width:r,height:this._state_height-2,fill:l})),g.add(new h.Label({x:this._width-55}).add(new h.Text({text:a,padding:this._state_padding,fontSize:this._state_height-this._state_padding,align:"right",wrap:"none",width:55}))),g.on("dblclick",(()=>n(this.RV,t))),this.add(g)}createStates(t,e,i){const{states:s}=this.node;s.map(((s,n)=>{this.createState(s,n,t,e,i)}))}}class g extends h.Arrow{constructor(t,e){super({x:0,y:0,pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:2}),this.src=t,this.dst=e,this.recomputePoints(),t.addEdge(this),e.addEdge(this)}recomputePoints(){const{src:t,dst:e}=this,i=t.getCenter(),s=e.getCenter(),n=r(t.getCorners(),{src:i,dst:s}),h=r(e.getCorners(),{src:i,dst:s});this.points([n.x,n.y,h.x,h.y])}onNodeMoving(){this.recomputePoints()}}var _=s.DOMWidgetView.extend({render:function(){var t=this.model.get("height");this.container_id=`konva-container-${d()}`,this.node_title_height=15,this.node_state_offset=8,this.node_state_height=14,this.node_state_padding=2,this.node_width=180,this.nodes=[],this.edges=[],this.map={},this.el.innerHTML=`\n            <div>\n                \x3c!--\n                <div style="padding: 10px; background-color: #336699">\n                    <button id="save">Save as image</button>\n                </div>\n                --\x3e\n                <div\n                    id="${this.container_id}"\n                    style="background-color: #336699"\n                    >\n                </div>\n            </div>\n        `,setTimeout((()=>{this.stage=new h.Stage({container:this.container_id,width:2048,height:t}),this.layer=new h.Layer,this.model.on("change:value",this.value_changed,this),this.model.on("change:marginals_and_evidence",this.value_changed,this),this.value_changed()}),0)},downloadURI:function(t,e){var i=document.createElement("a");i.download=e,i.href=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),delete i},value_changed:function(){var t,e=this.model.get("value"),{marginals:i,evidence:s}=this.model.get("marginals_and_evidence");"BayesianNetwork"===e.type&&(this.layer.removeChildren(),this.map={},this.nodes=e.nodes.map((e=>(t=new l(e,i[e.RV],s[e.RV],{onDragMove:t=>this.on_node_moving(t),onDragEnd:t=>this.on_node_moved(t),onStateSelected:(t,e)=>this.on_state_selected(t,e)}),this.map[e.RV]=t,t))),this.edges=e.edges.map((t=>{const e=this.map[t[0]],i=this.map[t[1]];return new g(e,i)})),this.edges.forEach((t=>this.layer.add(t))),this.nodes.forEach((t=>this.layer.add(t))),this.stage.add(this.layer),this.layer.draw())},on_node_moving(t){t.edges.forEach((t=>t.onNodeMoving())),this.layer.draw()},on_node_moved(t){console.log(`node ${t.RV} moved!`),t.node.position=[t.x(),t.y()];var e=this.model.get("value");this.model.set("value","null"),this.model.set("value",Object.assign({},e)),this.touch()},on_state_selected(t,e){const{marginals:i,evidence:s}=this.model.get("marginals_and_evidence"),n=Object.assign({},s);n[t]&&n[t]===e?n[t]="":n[t]=e,this.model.set("evidence_sink",n),this.touch()}});t.exports={Model:o,View:_}},306:t=>{"use strict";t.exports={version:"0.1.0"}}}]);