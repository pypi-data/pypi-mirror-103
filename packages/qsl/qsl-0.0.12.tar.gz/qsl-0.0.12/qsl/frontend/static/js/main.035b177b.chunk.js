(this.webpackJsonpqsl=this.webpackJsonpqsl||[]).push([[0],{199:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n(0),r=n.n(c),i=n(51),o=n.n(i),l=n(5),s=n(72),u=n(117),j=n(20),b=n(24),d=n(7),h=n(45),f=n.n(h),O=n(60),x=n(4),m=n(19),g=n(201),p=n(271),v=n(119),y=n(107),C=n(69),k=n(78),S=n(258),w=n(215),B=n(57),I=n(259),N=n(209),E=n(267),L=n(156),P=n(272),M=function(e){return Object(a.jsx)(g.a,{value:e.optionName,control:e.control,label:"".concat(e.optionName," (").concat(e.optionConfig.shortcut,")")})},z=function(e){var t=c.useState(""),n=Object(l.a)(t,2),r=n[0],i=n[1],o=c.useState("single"),s=Object(l.a)(o,2),u=s[0],j=s[1];return Object(a.jsxs)(p.a,{container:!0,spacing:3,children:[Object(a.jsx)(p.a,{item:!0,xs:6,children:Object(a.jsx)(v.a,{value:r,placeholder:"New label name",onChange:function(e){return i(e.target.value)},style:{width:"100%"}})}),Object(a.jsx)(p.a,{item:!0,xs:3,children:Object(a.jsxs)(y.a,{labelId:"config-type-selector",id:"config-type-selector",label:"New label type",value:u,onChange:function(e){return j(e.target.value)},style:{width:"100%"},children:[Object(a.jsx)(C.a,{value:"single",children:"Single"}),Object(a.jsx)(C.a,{value:"multiple",children:"Multiple"}),Object(a.jsx)(C.a,{value:"text",children:"Text"})]})}),Object(a.jsx)(p.a,{item:!0,xs:3,children:Object(a.jsx)(k.a,{variant:"contained",color:"primary",onClick:function(){e.addConfig(r,u),i("")},style:{width:"100%"},disabled:!r||e.configGroup[u].hasOwnProperty(r),children:"Add Label"})})]})},A=function(e){var t=c.useState(""),n=Object(l.a)(t,2),r=n[0],i=n[1],o=c.useState(""),s=Object(l.a)(o,2),u=s[0],j=s[1];return Object(a.jsxs)(S.a,{style:{marginBottom:"10px"},children:[Object(a.jsx)(v.a,{value:r,onChange:function(e){return i(e.target.value)},placeholder:"New option name",style:{marginRight:"10px"}}),Object(a.jsx)(v.a,{value:u,onChange:function(e){return j(e.target.value)},placeholder:"Keyboard shortcut",style:{marginRight:"10px"}}),Object(a.jsx)(k.a,{disabled:0===r.length||1!==u.length||!e.isShortcutValid(r,u),variant:"contained",color:"primary",onClick:function(){e.addOption(r,u),i(""),j("")},children:"Add Option"})]})},R=function(e){return Object(a.jsxs)(w.a,{children:[Object(a.jsx)(B.a,{component:"fieldset",children:Object(a.jsxs)(I.a,{"aria-label":e.configName,name:e.configName,value:e.selected,children:[Object(a.jsx)(N.a,{component:"legend",children:e.configName}),Object.entries(e.config.options).map((function(t){var n=Object(l.a)(t,2),c=n[0],r=n[1];return Object(a.jsx)(M,{optionName:c,optionConfig:r,control:Object(a.jsx)(E.a,{disabled:!e.onChange,onClick:function(t){return e.onChange(t,t.target.value)}})},c)}))]})}),e.setConfig?Object(a.jsx)(A,{isShortcutValid:e.isShortcutValid,addOption:function(t,n){return e.setConfig(e.configName,Object(x.a)(Object(x.a)({},e.config),{},{options:Object(x.a)(Object(x.a)({},e.config.options),{},Object(d.a)({},t,{shortcut:n,id:null}))}))}}):null]})},D=function(e){return Object(a.jsxs)("div",{children:[Object(a.jsx)(w.a,{children:Object(a.jsxs)(B.a,{component:"fieldset",children:[Object(a.jsx)(N.a,{component:"legend",children:e.configName}),Object.entries(e.config.options).map((function(t){var n=Object(l.a)(t,2),c=n[0],r=n[1];return Object(a.jsx)(M,{optionName:c,optionConfig:r,control:Object(a.jsx)(L.a,{disabled:!e.onChange,checked:!!e.selected&&e.selected.indexOf(c)>=0,onChange:function(t){return e.onChange(t,c)},name:c})},c)}))]})}),e.setConfig?Object(a.jsx)(A,{isShortcutValid:e.isShortcutValid,addOption:function(t,n){return e.setConfig(e.configName,Object(x.a)(Object(x.a)({},e.config),{},{options:Object(x.a)(Object(x.a)({},e.config.options),{},Object(d.a)({},t,{shortcut:n,id:null}))}))}}):null]})},T=function(e){return Object(a.jsx)(B.a,{component:"fieldset",children:Object(a.jsxs)(w.a,{children:[Object(a.jsx)(N.a,{component:"legend",children:e.configName}),Object(a.jsx)(v.a,{value:e.value,onChange:function(t){return e.onChange(t,t.target.value)},onBlur:e.onBlur,onFocus:e.onFocus,disabled:!e.onChange})]})})},U=function(e,t,n,a,c){if(e.hasOwnProperty(c)){var r=e[c];return r.configName===t&&r.optionName===n&&r.type===a}return!0},G=function(e){var t=e.configGroup,n=e.labels,r=e.setLabelGroup,i=e.onEnter,o=e.onShiftEnter,s=e.onCtrlEnter,u=e.onEsc,j=e.onDel,b=e.setConfigGroup,h=c.useMemo((function(){return function(e){return Object.entries(e.single).map((function(e){var t=Object(l.a)(e,2);return[t[0],t[1],"single"]})).concat(Object.entries(e.multiple).map((function(e){var t=Object(l.a)(e,2);return[t[0],t[1],"multiple"]}))).map((function(e){var t=Object(l.a)(e,3),n=t[0],a=t[1],c=t[2];return Object.entries(a.options).map((function(e){var t=Object(l.a)(e,2),a=t[0];return{key:t[1].shortcut,configName:n,optionName:a,type:c}}))})).flat().reduce((function(e,t){return e[t.key]={type:t.type,configName:t.configName,optionName:t.optionName},e}),{})}(t)}),[t]),f=c.useState(!1),O=Object(l.a)(f,2),g=O[0],p=O[1],v=c.useCallback((function(e,n,a){var c=Object(x.a)(Object(x.a)({},t),{},Object(d.a)({},n,Object(x.a)(Object(x.a)({},t[n]),{},Object(d.a)({},e,a))));b(c)}),[t,b]),y=c.useCallback((function(e,n){var a=Object(x.a)(Object(x.a)({},t),{},Object(d.a)({},n,Object(x.a)(Object(x.a)({},t[n]),{},Object(d.a)({},e,{id:null}))));"multiple"!==n&&"single"!==n||(a[n][e].options={}),b(a)}),[t,b]),C=c.useCallback((function(e,t,a){if(r){var c,i;if("single"===t||"text"===t)i="single"===t&&n[t][e]===a?null:a,c=Object(x.a)(Object(x.a)({},n),{},Object(d.a)({},t,Object(x.a)(Object(x.a)({},n[t]),{},Object(d.a)({},e,i))));else if("multiple"===t){var o=Object(m.a)(n[t][e]),l=o.indexOf(a);l>=0?o.splice(l,1):o.push(a),c=Object(x.a)(Object(x.a)({},n),{},Object(d.a)({},t,Object(x.a)(Object(x.a)({},n[t]),{},Object(d.a)({},e,o))))}r(c)}}),[n,r]);return c.useEffect((function(){var e=function(e){if(i||r||u||j)if(!h.hasOwnProperty(e.key)||e.ctrlKey||e.shiftKey||g)!i||"Enter"!==e.key||e.shiftKey||e.ctrlKey?o&&"Enter"===e.key&&e.shiftKey&&!e.ctrlKey?o():s&&"Enter"===e.key&&!e.shiftKey&&e.ctrlKey?s():u&&"Escape"===e.key?u():j&&"Delete"===e.key&&j():i();else{var t=h[e.key],n=t.type,a=t.configName,c=t.optionName;C(a,n,c)}};return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[i,r,h,g,C]),Object(a.jsxs)("div",{children:[e.setConfigGroup?Object(a.jsxs)("div",{children:[Object(a.jsx)(z,{addConfig:y,configGroup:t}),Object(a.jsx)(P.a,{style:{marginTop:"10px",marginBottom:"10px"}})," "]}):null,Object.entries(t.single).map((function(t){var n=Object(l.a)(t,2),c=n[0],i=n[1];return Object(a.jsx)(R,{config:i,onChange:r?function(e,t){return C(c,"single",t)}:null,setConfig:e.setConfigGroup?function(e,t){return v(e,"single",t)}:null,isShortcutValid:function(e,t){return U(h,c,e,"single",t)},configName:c,selected:e.labels?e.labels.single[c]:null},c)})),Object.entries(t.multiple).map((function(t){var n=Object(l.a)(t,2),c=n[0],i=n[1];return Object(a.jsx)(D,{config:i,onChange:r?function(e,t){return C(c,"multiple",t)}:null,setConfig:e.setConfigGroup?function(e,t){return v(e,"multiple",t)}:null,isShortcutValid:function(e,t){return U(h,c,e,"multiple",t)},configName:c,selected:e.labels?e.labels.multiple[c]:null},c)})),Object.entries(t.text).map((function(t){var n=Object(l.a)(t,2),c=n[0];n[1];return Object(a.jsx)(T,{onChange:r?function(e,t){return C(c,"text",t)}:null,onFocus:function(){return p(!0)},onBlur:function(){return p(!1)},configName:c,value:e.labels&&e.labels.text[c]||""},c)}))]})},F=n(203).a({startIcon:{position:"absolute",left:"8px"},label:{paddingLeft:"40px"}})(k.a),H=n(273),K=n(274),q=n(216),_=n(213),V=n(47),W=V.a((function(e){return{root:{"& a":{color:"white",textDecoration:"none"}}}})),J=function(e){var t,n=e.project&&0!==e.project.nImages?Math.round(100*e.project.nLabeled/e.project.nImages):null,c=W();return Object(a.jsx)(H.a,{position:null!==(t=e.position)&&void 0!==t?t:"static",style:{zIndex:1201},children:Object(a.jsxs)(K.a,{children:[null!==n?Object(a.jsxs)(S.a,{position:"relative",display:"inline-flex",children:[Object(a.jsx)(q.a,{style:{color:"white"},variant:"determinate",size:40,color:"secondary",value:n}),Object(a.jsx)(S.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:Object(a.jsx)(_.a,{variant:"caption",component:"div",style:{color:"white"},children:"".concat(n,"%")})})]}):null,Object(a.jsx)(_.a,{variant:"h6",style:{marginLeft:"10px"},className:c.root,children:e.children})]})})},Y=n(79),Q=n(275),X=n(276),Z=n(268),$=n(277),ee=n(278),te=n(260),ne=n(261),ae=n(262),ce=n(263),re=n(48),ie=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"",oe=function(e){return{text:Object.entries(e.text).reduce((function(e,t){var n=Object(l.a)(t,2),a=n[0];n[1];return Object(x.a)(Object(x.a)({},e),{},Object(d.a)({},a,null))}),{}),multiple:Object.entries(e.multiple).reduce((function(e,t){var n=Object(l.a)(t,2),a=n[0];n[1];return Object(x.a)(Object(x.a)({},e),{},Object(d.a)({},a,[]))}),{}),single:Object.entries(e.single).reduce((function(e,t){var n=Object(l.a)(t,2),a=n[0];n[1];return Object(x.a)(Object(x.a)({},e),{},Object(d.a)({},a,null))}),{})}},le=function(e){return{image:oe(e.labelingConfiguration.image),boxes:[],default:!1,ignored:!1}},se=function(e){return Object.keys(e.box.single).length>0||Object.keys(e.box.multiple).length>0||Object.keys(e.box.text).length>0},ue={credentials:"include"},je={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"},be=function(){return fetch("".concat(ie,"/api/v1/auth/config"),ue).then((function(e){return e.json()}))},de=function(){return fetch("".concat(ie,"/api/v1/users/me"),ue).then((function(e){if(e.ok)return e;throw Error(e.statusText)})).then((function(e){return e.json()}))},he=function(e){return fetch("".concat(ie,"/api/v1/projects/").concat(e),ue).then((function(e){return e.json()}))},fe=function(e){return fetch("".concat(ie,"/api/v1/projects"),Object(x.a)(Object(x.a)({},je),{},{body:JSON.stringify(e)})).then((function(e){return e.json()}))},Oe=function(e,t){return fetch("".concat(ie,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),ue).then((function(e){return e.json()}))},xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=t.map((function(e){return"exclude=".concat(e)})).join("&"),l="".concat(ie,"/api/v1/projects/").concat(e,"/images?shuffle=").concat(a,"&limit=").concat(n,"&exclude_ignored=").concat(c,"&max_labels=").concat(r,"&").concat(o);return i&&(l+="&page=".concat(i)),fetch(l,ue).then((function(e){return e.json()}))},me=function(e,t,n){return fetch("".concat(ie,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),Object(x.a)(Object(x.a)({},je),{},{body:JSON.stringify(n)})).then((function(e){return e.json()}))},ge=function(e,t){return fetch("".concat(ie,"/api/v1/projects/").concat(e,"/images/").concat(t,"/labels"),Object(x.a)(Object(x.a)({},ue),{},{method:"DELETE"})).then((function(e){return e.json()}))},pe=function(e,t){return"".concat(ie,"/api/v1/projects/").concat(e,"/images/").concat(t,"/file")},ve=function(e){return"".concat(ie,"/api/v1/projects/").concat(e,"/export")},ye=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Ce=function(){var e=Object(O.a)(f.a.mark((function e(t){var n,a,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=t.current)||void 0===n||n.focus({preventScroll:!0}),e.next=3,ye(200);case 3:null===(a=t.current)||void 0===a||a.blur(),null===(c=t.current)||void 0===c||c.click();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ke=function(e){return Object.fromEntries(e.map((function(e){return[e.id,{selected:!0,remoteStatus:"unknown"}]})))},Se=V.a((function(e){return{checkbox:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"},checked:{color:"rgba(0, 150, 0, 1)"},unchecked:{color:"rgba(150, 0, 0, 1)"}}})),we=function(e){var t=Se(),n=function(n){return Object(a.jsx)(Y.a,{className:"".concat(t.checkbox," ").concat(n.selected?t.checked:t.unchecked),onClick:function(){return e.toggleSelected(n.image.id)},"aria-label":"selected ".concat(n.image.id),children:n.selected?Object(a.jsx)(te.a,{}):Object(a.jsx)(ne.a,{})})};return Object(a.jsx)(Q.a,{rowHeight:e.thumbnailSize,cols:Math.ceil(800/e.thumbnailSize),children:e.items.map((function(t){return Object(a.jsxs)(X.a,{cols:1,children:[Object(a.jsx)("img",{style:{maxWidth:"100%",maxHeight:"100%",height:"100%",width:"100%",objectFit:"contain",transform:"none",margin:"auto",position:"absolute",top:0,bottom:0,left:0,right:0},src:pe(e.projectId,t.image.id),alt:"ID: ".concat(t.image.id),onClick:function(){return e.toggleSelected(t.image.id)}}),n(t)]},t.image.id)}))})},Be=function(){var e=b.g().params,t=e.projectId,n=e.imageIds,r=c.useState({labels:null,dirty:!1,saved:[],batches:[],batchSize:10,thumbnailSize:160,redirecting:!1,advanceOnSave:!0,history:[],project:null,currentBatchStatus:{},currentBatch:[]}),i=Object(l.a)(r,2),o=i[0],s=i[1],u=c.useRef(),h=c.useRef(),m=c.useRef(),v=c.useRef(),y=c.useRef(),C=c.useRef(),w=c.useRef(),B=c.useCallback((function(){return o.history.filter((function(e){return e.images.map((function(e){return e.id})).join(",")!==n}))}),[o,n]),I=c.useCallback((function(e){var n,a,c=o.currentBatch.filter((function(e){return o.currentBatchStatus[e.id].selected}));switch(e){case"ignore":a="ignored",n=c.map((function(e){return me(t,e.id,Object(x.a)(Object(x.a)({},o.labels),{},{ignored:!0}))}));break;case"delete":a="unknown",n=c.map((function(e){return ge(t,e.id)}));break;case"save":a="labeled",n=c.map((function(e){return me(t,e.id,o.labels)}))}Promise.all(n).then((function(){var e=Object(x.a)(Object(x.a)({},o),{},{currentBatchStatus:Object(x.a)(Object(x.a)({},o.currentBatchStatus),Object.fromEntries(c.map((function(e){return[e.id,{selected:!1,remoteStatus:a}]}))))});s(e),o.advanceOnSave&&Object.entries(e.currentBatchStatus).filter((function(e){var t=Object(l.a)(e,2);t[0];return"unknown"!==t[1].remoteStatus})).length===e.currentBatch.length&&Ce(h)}))}),[o,h]),N=c.useCallback((function(){var e=[{images:o.currentBatch,status:o.currentBatchStatus}].concat(B());s(Object(x.a)(Object(x.a)({},o),{},{currentBatch:o.batches[0],currentBatchStatus:ke(o.batches[0]),batches:o.batches.slice(1),history:e,redirecting:!0}))}),[o,B]),E=c.useCallback((function(){s(Object(x.a)(Object(x.a)({},o),{},{history:o.history.slice(1),currentBatch:o.history[0].images,currentBatchStatus:o.history[0].status,batches:[o.currentBatch].concat(o.batches),redirecting:!0}))}),[o]),M=c.useCallback((function(){return s(Object(x.a)(Object(x.a)({},o),{},{currentBatchStatus:ke(o.currentBatch)}))}),[o]),z=c.useCallback((function(){return s(Object(x.a)(Object(x.a)({},o),{},{currentBatchStatus:Object.fromEntries(Object.entries(o.currentBatchStatus).map((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return[n,Object(x.a)(Object(x.a)({},a),{},{selected:"unknown"===a.remoteStatus})]})))}))}),[o]),A=c.useCallback((function(){return s(Object(x.a)(Object(x.a)({},o),{},{currentBatchStatus:Object.fromEntries(Object.entries(o.currentBatchStatus).map((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return[n,Object(x.a)(Object(x.a)({},a),{},{selected:!1})]})))}))}),[o]);c.useEffect((function(){var e=n.split(",").map((function(e){return{id:parseInt(e)}})),a=ke(e),c=o.batches.length>0?Promise.resolve(o.batches):xe(t,e.map((function(e){return e.id})),o.batchSize,!0,!0,0).then((function(e){return Promise.resolve([e])}));Promise.all([he(t),Oe(t,e[0].id),c]).then((function(t){var n=Object(l.a)(t,3),c=n[0],r=n[1],i=n[2];return s(Object(x.a)(Object(x.a)({},o),{},{labels:r,batches:i,project:c,currentBatchStatus:a,currentBatch:e,redirecting:!1}))}))}),[t,n]),c.useEffect((function(){var e=function(){var e=Object(O.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,e.t0=t.key,e.next="A"===e.t0?4:"a"===e.t0?6:"ArrowRight"===e.t0?8:"ArrowLeft"===e.t0?10:"Enter"===e.t0?12:"Backspace"===e.t0||"Delete"===e.t0?14:16;break;case 4:return n=t.ctrlKey&&t.shiftKey?w:null,e.abrupt("break",16);case 6:return n=t.ctrlKey&&!t.shiftKey?C:null,e.abrupt("break",16);case 8:return n=h,e.abrupt("break",16);case 10:return n=m,e.abrupt("break",16);case 12:return n=t.shiftKey?v:u,e.abrupt("break",16);case 14:return n=y,e.abrupt("break",16);case 16:n&&Ce(n);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[o,h,m,u,v,y,C,w]);var R=null;if(o.redirecting){var D=o.currentBatch.map((function(e){return e.id})).join(",");D?D!==n&&(R=Object(a.jsx)(b.a,{to:"/projects/".concat(t,"/batches/").concat(D),push:!0})):R=Object(a.jsx)(b.a,{to:"/projects/".concat(t),push:!0})}if(!o.project||!o.labels)return null;var T=Object.entries(o.currentBatchStatus).reduce((function(e,t){var n=Object(l.a)(t,2);n[0];return e+("labeled"===n[1].remoteStatus?1:0)}),0),U=Object.entries(o.currentBatchStatus).reduce((function(e,t){var n=Object(l.a)(t,2);n[0];return e+("ignored"===n[1].remoteStatus?1:0)}),0),H=Object.entries(o.currentBatchStatus).reduce((function(e,t){var n=Object(l.a)(t,2);n[0];return e+n[1].selected}),0);return Object(a.jsxs)("div",{children:[Object(a.jsxs)(p.a,{container:!0,spacing:2,children:[Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsxs)(J,{project:o.project,children:[Object(a.jsx)(j.b,{to:"/",children:"QSL"})," /"," ",Object(a.jsx)(j.b,{to:"/projects/".concat(t),children:o.project.name})," ","/ Batches"]})}),Object(a.jsxs)(p.a,{item:!0,xs:3,children:[Object(a.jsxs)(p.a,{item:!0,children:[R,Object(a.jsx)(_.a,{style:{marginBottom:"10px"},variant:"h6",children:"Image-Level Labels"}),o.labels&&o.project?Object(a.jsx)(G,{configGroup:o.project.labelingConfiguration.image,labels:o.labels.image,setLabelGroup:function(e){return s(Object(x.a)(Object(x.a)({},o),{},{labels:{boxes:[],image:e,default:!1,ignored:!1}}))}}):null,Object(a.jsx)(P.a,{})]}),Object(a.jsxs)(p.a,{item:!0,children:[Object(a.jsx)(_.a,{variant:"h6",children:"View Settings"}),Object(a.jsx)(_.a,{id:"batch-size-selector",gutterBottom:!0,children:"Target Batch Size"}),Object(a.jsx)(Z.a,{value:o.batchSize,"aria-labelledby":"batch-size-selector",valueLabelDisplay:"auto",onChange:function(e,t){return s(Object(x.a)(Object(x.a)({},o),{},{batchSize:t}))},step:10,marks:!0,min:10,max:110}),Object(a.jsx)(_.a,{id:"batch-size-selector",gutterBottom:!0,children:"Thumbnail Size"}),Object(a.jsx)(Z.a,{value:o.thumbnailSize,"aria-labelledby":"batch-size-selector",valueLabelDisplay:"auto",onChange:function(e,t){return s(Object(x.a)(Object(x.a)({},o),{},{thumbnailSize:t}))},step:20,marks:!0,min:160,max:500}),Object(a.jsx)(P.a,{})]}),Object(a.jsxs)(p.a,{item:!0,children:[Object(a.jsx)(_.a,{style:{marginBottom:"10px"},variant:"h6",children:"Label Actions"}),Object(a.jsxs)($.a,{size:"small",orientation:"vertical",color:"primary",style:{width:"100%"},"aria-label":"acton button group",children:[Object(a.jsx)(F,{startIcon:"\u23ce",disabled:T+U===o.currentBatch.length||0===H,onClick:function(){return I("save")},ref:u,children:"Save"}),Object(a.jsx)(F,{startIcon:"\u21e7\u23ce",disabled:T+U===o.currentBatch.length||0===H,onClick:function(){return I("ignore")},ref:v,children:"Ignore"}),Object(a.jsx)(F,{startIcon:"\u232b",ref:y,disabled:T+U===o.currentBatch.length||0===H,onClick:function(){return I("delete")},children:"Remove Labels"}),Object(a.jsx)(F,{startIcon:Object(a.jsx)(ae.a,{}),ref:h,onClick:N,disabled:0===o.batches.length,children:"Next"}),Object(a.jsx)(F,{startIcon:Object(a.jsx)(ce.a,{}),onClick:E,ref:m,disabled:0===B().length,children:"Previous"}),Object(a.jsx)(F,{disabled:H===o.currentBatch.length-T,onClick:z,startIcon:"\u2303A",ref:C,children:"Select All"}),Object(a.jsx)(F,{startIcon:"\u2303\u21e7A",disabled:0===H,onClick:A,ref:w,children:"Select None"})]}),Object(a.jsx)(g.a,{control:Object(a.jsx)(L.a,{checked:o.advanceOnSave,onChange:function(e,t){return s(Object(x.a)(Object(x.a)({},o),{},{advanceOnSave:t}))},name:"advanceOnSave"}),label:"Advance when batch complete?"}),se(o.project.labelingConfiguration)?Object(a.jsx)(_.a,{variant:"body1",children:"This project has box-level labels which will be overwritten in batch mode."}):null]}),Object(a.jsxs)(p.a,{item:!0,children:[Object(a.jsx)(P.a,{style:{marginBottom:"10px"}}),Object(a.jsx)(_.a,{variant:"h6",children:"History"}),Object(a.jsx)(_.a,{variant:"caption",children:"Ten most recently reviewed batches."}),Object(a.jsx)(re.a,{rows:o.history.map((function(e){return Object(x.a)(Object(x.a)({},e),{},{id:e.images.map((function(e){return e.id})).join(",")})})),hideFooterPagination:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,hideFooter:!0,disableColumnReorder:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"images",headerName:"ID",flex:1,renderCell:function(e){var n=e.value.map((function(e){return e.id}));return Object(a.jsx)(j.b,{to:"/projects/".concat(t,"/images/").concat(n.join(",")),children:n.slice(0,5).join(", ")+(n.length>5?", ...":"")})}}]}),R,Object(a.jsx)(P.a,{style:{marginBottom:"10px"}}),Object(a.jsx)(ee.a,{component:j.b,variant:"body1",to:"/projects/".concat(t),children:"Return to Project Menu"})]})]}),Object(a.jsxs)(p.a,{item:!0,xs:9,children:[T+U<o.currentBatch.length?Object(a.jsxs)(S.a,{children:[Object(a.jsx)(we,{items:o.currentBatch.filter((function(e){return"unknown"===o.currentBatchStatus[e.id].remoteStatus})).map((function(e){return{image:e,selected:o.currentBatchStatus[e.id].selected}})),thumbnailSize:o.thumbnailSize,projectId:t,toggleSelected:function(e){return s(Object(x.a)(Object(x.a)({},o),{},{currentBatchStatus:Object(x.a)(Object(x.a)({},o.currentBatchStatus),{},Object(d.a)({},e,Object(x.a)(Object(x.a)({},o.currentBatchStatus[e]),{},{selected:!o.currentBatchStatus[e].selected})))}))}}),Object(a.jsx)(P.a,{style:{marginBottom:"10px"}})]}):null,Object(a.jsxs)(p.a,{container:!0,direction:"row",alignItems:"center",spacing:1,children:[Object(a.jsx)(p.a,{item:!0,children:Object(a.jsx)(k.a,{onClick:M,disabled:0===T&&0===U,variant:"contained",children:"Reset"})}),Object(a.jsx)(p.a,{item:!0,children:Object(a.jsxs)(_.a,{variant:"body1",children:["Hiding ",T," labeled and ",U," ignored images."]})})]})]})]}),o.batches&&o.batches.length?o.batches.map((function(e,n){return e.map((function(e,n){return Object(a.jsx)("img",{alt:"Background Load: ".concat(e.id),src:pe(t,e.id),style:{width:0,height:0}},e.id)}))})):null]})},Ie=n(159),Ne=n(264),Ee=n(269),Le=n(279),Pe=n(265),Me=n(143),ze=n.n(Me),Ae=function(e){return"".concat(100*e,"%")},Re=function(e){var t=e.points&&e.points.length>0,n=t&&2===e.points.length&&e.points[0].x===e.points[1].x&&e.points[0].y===e.points[1].y?e.points.slice(0,1):e.points;return{x:t?null:Math.min(e.x1,e.x2),y:t?null:Math.min(e.y1,e.y2),w:t?null:Math.abs(e.x2-e.x1),h:t?null:Math.abs(e.y2-e.y1),id:e.id,labels:e.labels,points:n}},De=function(e,t,n){var a=t.getBoundingClientRect(),c=a.x,r=a.y,i=a.width,o=a.height;return{x:(e.nativeEvent.pageX-window.scrollX-c*n)/(i*n),y:(e.nativeEvent.pageY-window.scrollY-r*n)/(o*n)}},Te=function(e){if(!e.draftBox&&!e.box)return null;var t=e.box&&null!==e.box.points||e.draftBox&&null!==e.draftBox.points;if(!t&&e.draftBox&&!(e.draftBox.x1&&e.draftBox.x2&&e.draftBox.y1&&e.draftBox.y2))return null;var n=e.draftBox?Re(e.draftBox):e.box;if(t&&0===n.points.length)return null;var c=e.draftBox?"red":"blue",r=t?Math.min.apply(Math,n.points.map((function(e){return e.x}))):n.x,i=t?Math.min.apply(Math,n.points.map((function(e){return e.y}))):n.y,o=t?Math.max.apply(Math,n.points.map((function(e){return e.x}))):n.x+n.w,l=t?Math.max.apply(Math,n.points.map((function(e){return e.y}))):n.y+n.h,s=t?o-r:n.w,u=t?l-i:n.h,j=null;j=t&&s>0&&u>0?Object(a.jsx)("svg",{children:Array.from(Array(n.points.length-1).keys()).map((function(e){return Object(a.jsx)("line",{stroke:c,strokeWidth:"4",x1:Ae((n.points[e].x-r)/s),y1:Ae((n.points[e].y-i)/u),x2:Ae((n.points[e+1].x-r)/s),y2:Ae((n.points[e+1].y-i)/u)},e)}))}):t?Object(a.jsx)("rect",{transform:"translate(-5, -5)",width:10,height:10,fill:c}):Object(a.jsx)("rect",{width:"100%",height:"100%",stroke:c,fill:"none",strokeWidth:"4"});var b,d=null;if(e.draftBox&&e.draftBox.fixed&&!t&&null!==e.draftBox.next){var h=e.draftBox.y1>e.draftBox.y2,f=e.draftBox.x1>e.draftBox.x2,O=1===e.draftBox.next&&!h||2===e.draftBox.next&&h,x=1===e.draftBox.next&&!f||2===e.draftBox.next&&f;d=Object(a.jsx)("rect",{x:x?"0%":"100%",y:O?"0%":"100%",transform:"translate(-5, -5)",width:10,height:10,fill:"red"})}else e.draftBox&&t&&null!==e.draftBox.next&&s>0&&u>0&&(d=Object(a.jsx)("rect",{x:Ae((n.points[0].x-r)/s),y:Ae((n.points[0].y-i)/u),transform:"translate(-5, -5)",width:10,height:10,fill:"red"}));return Object(a.jsxs)("svg",{width:s>0?Ae(s):10,height:u>0?Ae(u):10,onClick:e.onClick,onMouseMove:e.onMouseMove,style:{position:"absolute",left:Ae(r),top:Ae(i),overflow:"visible"},children:[Object(a.jsx)("text",{x:5,y:5,fill:c,fontFamily:"Roboto,Helvetica,Arial,sans-serif",alignmentBaseline:"hanging",children:(b=n.labels,Object.values(b.single).filter((function(e){return null!==e})).concat(Object.values(b.text).filter((function(e){return null!==e}))).join(", "))}),j,d]})},Ue=function(e){var t=b.g().params,n=t.projectId,r=t.imageId,i=c.useRef(),o=ze.a.debounce((function(t){e.onHover(De(t,i.current,e.zoom))}),5);return Object(a.jsx)("div",{children:Object(a.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[Object(a.jsx)(Te,{onMouseMove:o,onClick:function(t){return e.onSelectBox(null,De(t,i.current,e.zoom))},draftBox:e.draftBox}),Object(a.jsxs)(Ie.a,{children:[e.boxes.map((function(t,n){return Object(a.jsx)(Te,{box:t,onMouseMove:o,onClick:function(t){return e.onSelectBox(n,De(t,i.current,e.zoom))}},n)})),Object(a.jsx)("img",{onClick:function(t){e.onClick&&e.onClick(De(t,i.current,e.zoom))},onMouseMove:o,ref:i,src:pe(n,r),alt:"ID: ".concat(r),style:{display:"block",zoom:e.zoom}})]})]})})},Ge=function(e){return e.length>0?e[0].id.toString():null},Fe=function(e,t,n){return[{id:parseInt(e),status:t}].concat(n.filter((function(t){return t.id!==parseInt(e)}))).slice(0,10)},He=function(){var e=b.g().params,t=e.projectId,n=e.imageId,r=c.useRef(),i=c.useRef(),o=c.useRef(),s=c.useRef(),u=c.useRef(),d=c.useRef(),h=c.useRef(),m=c.useState(null),p=Object(l.a)(m,2),v=p[0],y=p[1],C=c.useState(null),k=Object(l.a)(C,2),w=k[0],I=k[1],E=c.useState({queueSize:20,desiredImageId:n,status:"initializing",usePolygon:!1,labels:null,advanceOnSave:!0,dirty:!1,notice:null,history:[],queue:[]}),M=Object(l.a)(E,2),z=M[0],A=M[1],R=c.useState(1),D=Object(l.a)(R,2),T=D[0],U=D[1],H=v&&v.fixed,q=w?H?w.labelingConfiguration.box:w.labelingConfiguration.image:null,V=z.labels?H?v.labels:z.labels.image:null,W=c.useCallback((function(e){if(v)if(v&&null!==v.next){var t=v.points&&v.points.length>0,n=t?(a={x:e.x,y:e.y},c=v.points[0],Math.sqrt(Math.pow(a.y-c.y,2)+Math.pow(a.x-c.x,2))<.001?c:a):null;y(Object(x.a)(Object(x.a)({},v),{},{x1:t?null:1===v.next?e.x:v.x1,y1:t?null:1===v.next?e.y:v.y1,x2:t?null:2===v.next?e.x:v.x2,y2:t?null:2===v.next?e.y:v.y2,fixed:!0,next:1===v.next?2:1,points:t?v.points.concat([n]):null}))}else A(Object(x.a)(Object(x.a)({},z),{},{labels:Object(x.a)(Object(x.a)({},z.labels),{},{boxes:[Re(v)].concat(z.labels.boxes),default:!1})})),y(null);else y({x1:z.usePolygon?null:e.x,y1:z.usePolygon?null:e.y,x2:null,y2:null,labels:oe(w.labelingConfiguration.box),id:null,fixed:!!z.usePolygon,points:z.usePolygon?[{x:e.x,y:e.y}]:null,next:2});var a,c}),[z,v,w]),Q=c.useCallback((function(e){!v||v.points||v.fixed||null===v.next||y(Object(x.a)(Object(x.a)({},v),{},{x2:e.x,y2:e.y}))}),[z,v]),X=c.useCallback((function(e,t){if(v)v&&null!==v.next?W(t):v&&null===v.next&&(A(Object(x.a)(Object(x.a)({},z),{},{labels:Object(x.a)(Object(x.a)({},z.labels),{},{boxes:[Re(v)].concat(z.labels.boxes),default:!1})})),y(null));else{var n=z.labels.boxes.splice(e,1)[0];y({x1:(a=n).x,x2:a.x+a.w,y1:a.y,y2:a.y+a.h,labels:a.labels,id:a.id,next:null,fixed:!0,points:a.points}),A(Object(x.a)(Object(x.a)({},z),{},{labels:Object(x.a)(Object(x.a)({},z.labels),{},{boxes:z.labels.boxes,default:!1})}))}var a}),[z,v]);c.useEffect((function(){he(t).then(I)}),[t,n]),c.useEffect((function(){var e=z.queue.filter((function(e){return e.id.toString()!==n})),a=e.map((function(e){return e.id})).concat(n?[parseInt(n)]:[]);Promise.all([n?Oe(t,n):Promise.resolve(null),z.queueSize<=e.length?Promise.resolve([]):xe(t,a,z.queueSize-e.length)]).then((function(t){var a=Object(l.a)(t,2),c=a[0],r=a[1],i=e.concat(r);A(Object(x.a)(Object(x.a)({},z),{},{labels:c,queue:i,status:n?"waiting":"redirecting",desiredImageId:n||Ge(i)}))}))}),[n]);var ee=c.useCallback((function(){A(Object(x.a)(Object(x.a)({},z),{},{dirty:!0})),y(null)}),[z]),te=c.useCallback((function(){z.labels.default||ge(t,n).then((function(e){A(Object(x.a)(Object(x.a)({},z),{},{labels:e,dirty:!1,history:Fe(n,"Unlabeled",z.history),notice:"Deleted your label and reverted to default."}))}))}),[n,z]),ne=c.useCallback((function(){return A(Object(x.a)(Object(x.a)({},z),{},{notice:null}))}),[z]),ie=c.useCallback((function(){me(t,n,Object(x.a)(Object(x.a)({},z.labels),{},{ignored:!1})).then(function(){var e=Object(O.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(Object(x.a)(Object(x.a)({},z),{},{labels:t,dirty:!1,history:Fe(n,"Labeled",z.history),notice:"Saved your labels."})),z.advanceOnSave&&Ce(r);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[z,r]),le=c.useCallback((function(){y(null),A(Object(x.a)(Object(x.a)({},z),{},{dirty:!0,labels:Object(x.a)(Object(x.a)({},z.labels),{},{boxes:z.labels.boxes.concat([Re(v)])})}))}),[v,z]),ue=c.useCallback((function(){H||me(t,n,Object(x.a)(Object(x.a)({},z.labels),{},{ignored:!0})).then((function(e){A(Object(x.a)(Object(x.a)({},z),{},{labels:e,dirty:!1,history:Fe(n,"Ignored",z.history),notice:"Ignored this image."}))}))}),[z,H]),je=c.useCallback((function(){H||A(Object(x.a)(Object(x.a)({},z),{},{desiredImageId:Ge(z.queue),history:Fe(n,z.labels.ignored?"Ignored":z.labels.default?"Unlabeled":"Labeled",z.history),notice:"Advancing to next image.",status:"redirecting"}))}),[n,z.labels,z]),be=c.useCallback((function(){H||0===z.history.length||A(Object(x.a)(Object(x.a)({},z),{},{desiredImageId:z.history.length>0?z.history[0].id.toString():null,history:z.history.slice(1),queue:[{id:parseInt(n)}].concat(z.queue),status:"redirecting"}))}),[n,z]),de=c.useCallback((function(e){H?(y(Object(x.a)(Object(x.a)({},v),{},{labels:e})),A(Object(x.a)(Object(x.a)({},z),{},{dirty:!0}))):A(Object(x.a)(Object(x.a)({},z),{},{dirty:!0,labels:Object(x.a)(Object(x.a)({},z.labels),{},{image:e,default:!1})}))}),[z,v]);c.useEffect((function(){var e=function(){var e=Object(O.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,e.t0=t.key,e.next="ArrowRight"===e.t0?4:"ArrowLeft"===e.t0?6:"Enter"===e.t0?8:"Backspace"===e.t0||"Delete"===e.t0?10:12;break;case 4:return n=r,e.abrupt("break",12);case 6:return n=i,e.abrupt("break",12);case 8:return n=H?d:t.shiftKey?s:o,e.abrupt("break",12);case 10:return n=H?h:null,e.abrupt("break",12);case 12:n&&Ce(n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e,!1)}}),[z,H,d,h,r,i,o,s,u]);var fe="redirecting"===z.status?Object(a.jsx)(b.a,{to:z.desiredImageId?"/projects/".concat(t,"/images/").concat(z.desiredImageId):"/projects/".concat(t),push:!0}):null;if(!z.labels||!w)return fe;return Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)(Ne.a,{}),Object(a.jsxs)(J,{project:w,position:"fixed",children:[Object(a.jsx)(j.b,{to:"/",children:"QSL"})," /"," ",Object(a.jsx)(j.b,{to:"/projects/".concat(t),children:w.name})," / Images / ",n]}),Object(a.jsx)(Ee.a,{variant:"permanent",style:{flexShrink:0},children:Object(a.jsxs)(S.a,{style:{padding:"10px",width:250},children:[Object(a.jsx)(K.a,{}),fe,Object(a.jsx)(_.a,{style:{marginBottom:"10px"},variant:"h6",children:H?"Box-Level Labels":"Image-Level Labels"}),Object(a.jsx)(G,{configGroup:q,labels:V,setLabelGroup:de}),Object(a.jsx)(P.a,{style:{marginTop:"10px"}}),Object(a.jsx)(_.a,{variant:"h6",children:"View Settings"}),Object(a.jsxs)(B.a,{style:{margin:"10px 0px",width:"100%"},component:"fieldset",children:[Object(a.jsx)(N.a,{component:"legend",children:"Zoom"}),Object(a.jsx)(Z.a,{style:{margin:"0 5px"},valueLabelDisplay:"auto","aria-labelledby":"zoom-slider",value:T,min:1,max:5,onChange:function(e,t){return U(t)}})]}),Object(a.jsx)(P.a,{}),Object(a.jsx)(_.a,{style:{marginBottom:"10px"},variant:"h6",children:"Label Actions"}),Object(a.jsxs)($.a,{size:"small",orientation:"vertical",color:"primary",style:{width:"100%"},"aria-label":"acton button group",children:[H?Object(a.jsx)(F,{startIcon:"\u23ce",onClick:le,ref:d,children:"Set Box Label"}):null,H?Object(a.jsx)(F,{startIcon:"\u232b",onClick:ee,ref:h,children:"Delete Box"}):null,H?null:Object(a.jsx)(F,{startIcon:"\u23ce",disabled:!z.labels.default&&!z.dirty,onClick:ie,ref:o,children:"Save"}),H?null:Object(a.jsx)(F,{startIcon:"\u21e7\u23ce",disabled:z.labels.ignored,onClick:ue,ref:s,children:"Ignore"}),H?null:Object(a.jsx)(F,{startIcon:Object(a.jsx)(ae.a,{}),ref:r,onClick:je,children:"Next"}),H?null:Object(a.jsx)(F,{startIcon:Object(a.jsx)(ce.a,{}),onClick:be,ref:i,disabled:0===z.history.filter((function(e){return e.id!==parseInt(n)})).length,children:"Previous"}),H?null:Object(a.jsx)(F,{disabled:z.labels.default,ref:u,onClick:te,children:z.labels.ignored?"Unignore":"Remove Label"})]}),Object(a.jsx)(g.a,{control:Object(a.jsx)(L.a,{checked:z.advanceOnSave,onChange:function(e,t){return A(Object(x.a)(Object(x.a)({},z),{},{advanceOnSave:t}))},name:"advanceOnSave"}),label:"Advance on saving?"}),Object(a.jsx)(g.a,{control:Object(a.jsx)(L.a,{checked:z.usePolygon,onChange:function(e,t){return A(Object(x.a)(Object(x.a)({},z),{},{usePolygon:t}))},name:"usePolygon"}),label:"Use polygons instead of boxes?"}),Object(a.jsx)(P.a,{style:{marginBottom:"10px"}}),Object(a.jsx)(_.a,{variant:"h6",children:"History"}),Object(a.jsx)(_.a,{variant:"caption",children:"Ten most recently reviewed images."}),Object(a.jsx)(re.a,{rows:z.history,hideFooterPagination:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,hideFooter:!0,disableColumnReorder:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:1,renderCell:function(e){return Object(a.jsx)(j.b,{to:"/projects/".concat(t,"/images/").concat(e.value),children:e.value})}},{field:"status",headerName:"Status",flex:3}]})]})}),Object(a.jsxs)("div",{style:{width:"calc(100%-".concat(250,"px"),marginLeft:250},children:[Object(a.jsx)(K.a,{}),Object(a.jsx)(Ue,{onClick:se(w.labelingConfiguration)?W:null,onHover:Q,onSelectBox:X,boxes:z.labels.boxes,draftBox:v,zoom:T}),Object(a.jsx)(Le.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:null!==z.notice,autoHideDuration:1500,onClose:ne,message:z.notice,action:Object(a.jsx)(c.Fragment,{children:Object(a.jsx)(Y.a,{size:"small","aria-label":"close",color:"inherit",onClick:ne,children:Object(a.jsx)(Pe.a,{fontSize:"small"})})})}),z.queue&&z.queue.length?z.queue.map((function(e,n){return Object(a.jsx)("img",{alt:"Background Load: ".concat(e.id),src:pe(t,e.id),style:{width:0,height:0}},e.id)})):null]})]})},Ke=function(){var e=b.g().params.projectId,t=c.useState(null),n=Object(l.a)(t,2),r=n[0],i=n[1],o=c.useState(!1),s=Object(l.a)(o,2),u=s[0],d=s[1],h=c.useState(!1),f=Object(l.a)(h,2),O=f[0],m=f[1],g=c.useState(!1),y=Object(l.a)(g,2),C=y[0],S=y[1],I=c.useCallback((function(){return function(e,t){return fetch("".concat(ie,"/api/v1/projects/").concat(e),Object(x.a)(Object(x.a)({},je),{},{body:JSON.stringify(t)})).then((function(e){return e.json()}))}(e,r).then((function(e){i(e),d(!1),m(!0)}))}),[r,i]),E=c.useCallback((function(){he(e).then(i)}),[e]),L=c.useCallback((function(){(function(e){return fetch("".concat(ie,"/api/v1/projects/").concat(e),Object(x.a)(Object(x.a)({},ue),{},{method:"DELETE"})).then((function(e){return e.json()}))})(r.id).then((function(){S(!0)}))}),[r]);return c.useEffect((function(){E()}),[e]),r?O?Object(a.jsx)(b.a,{to:"/projects/".concat(e)}):C?Object(a.jsx)(b.a,{to:"/projects"}):Object(a.jsxs)(p.a,{container:!0,spacing:2,children:[Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsxs)(J,{children:[Object(a.jsx)(j.b,{to:"/",children:"QSL"})," /"," ",Object(a.jsx)(j.b,{to:"/projects/".concat(e),children:r.name})," / Edit"]})}),Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsx)(B.a,{component:"fieldset",children:Object(a.jsxs)(w.a,{children:[Object(a.jsx)(N.a,{component:"legend",children:"Project Name"}),Object(a.jsx)(v.a,{value:r.name,onChange:function(e){i(Object(x.a)(Object(x.a)({},r),{},{name:e.target.value})),d(!0)}})]})})}),Object(a.jsxs)(p.a,{item:!0,xs:12,sm:6,children:[Object(a.jsx)(_.a,{variant:"h6",children:"Image-Level Labels"}),Object(a.jsx)(G,{configGroup:r.labelingConfiguration.image,setConfigGroup:function(e){d(!0),i(Object(x.a)(Object(x.a)({},r),{},{labelingConfiguration:Object(x.a)(Object(x.a)({},r.labelingConfiguration),{},{image:e})}))}})]}),Object(a.jsxs)(p.a,{item:!0,sm:12,md:6,children:[Object(a.jsx)(_.a,{variant:"h6",children:"Box-Level Labels"}),Object(a.jsx)(G,{configGroup:r.labelingConfiguration.box,setConfigGroup:function(e){d(!0),i(Object(x.a)(Object(x.a)({},r),{},{labelingConfiguration:Object(x.a)(Object(x.a)({},r.labelingConfiguration),{},{box:e})}))}})]}),Object(a.jsxs)(p.a,{item:!0,container:!0,xs:12,spacing:2,children:[Object(a.jsx)(p.a,{item:!0,children:Object(a.jsx)(k.a,{onClick:I,variant:"contained",disabled:!u,color:"primary",children:"Save Changes"})}),Object(a.jsx)(p.a,{item:!0,children:Object(a.jsx)(k.a,{onClick:E,variant:"contained",disabled:!u,color:"secondary",children:"Reset"})}),Object(a.jsx)(p.a,{item:!0,children:Object(a.jsx)(k.a,{onClick:L,variant:"contained",color:"secondary",children:"Delete Project"})})]})]}):null},qe=n(144),_e=n.n(qe),Ve=function(){var e=b.g().params.projectId,t=c.useState(null),n=Object(l.a)(t,2),r=n[0],i=n[1],o=c.useState([]),s=Object(l.a)(o,2),u=s[0],d=s[1],h=c.useState(null),f=Object(l.a)(h,2),O=f[0],m=f[1],g=c.useCallback((function(){return function(e,t,n){return fetch("".concat(ie,"/api/v1/projects/").concat(e,"/images"),Object(x.a)(Object(x.a)({},je),{},{body:JSON.stringify({files:t,defaults:n})})).then((function(e){return e.json()}))}(e,u,O).then((function(){m(le(r)),d([])}))}),[r,u,O]);return c.useEffect((function(){he(e).then((function(e){m(le(e)),i(e)}))}),[]),r?Object(a.jsxs)(p.a,{container:!0,spacing:2,children:[Object(a.jsxs)(p.a,{item:!0,xs:12,children:[Object(a.jsx)(j.b,{to:"/projects/".concat(e),children:Object(a.jsx)(_.a,{variant:"subtitle1",children:"Back to project menu"})}),Object(a.jsx)(_.a,{variant:"h5",children:"Add Files to Project"})]}),Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsx)(k.a,{onClick:g,disabled:0===u.length,style:{width:"100%"},variant:"contained",color:"primary",children:"Add Files"})}),Object(a.jsx)(p.a,{item:!0,xs:6,children:Object(a.jsx)(_e.a,{label:"New Files",variant:"outlined",value:u,onPaste:function(e){e.preventDefault(),d(u.concat(e.clipboardData.getData("Text").split("\n").filter((function(e){return e.length>0}))))},onAdd:function(e){return d(u.concat([e]))},onDelete:function(e){return d(u.filter((function(t){return t!==e})))},fullWidth:!0})}),Object(a.jsxs)(p.a,{item:!0,xs:6,children:[Object(a.jsx)(_.a,{variant:"h6",children:"Defaults"}),Object(a.jsx)(G,{configGroup:r.labelingConfiguration.image,labels:O.image,setLabelGroup:function(e){return m(Object(x.a)(Object(x.a)({},O),{},{image:e}))}})]})]}):null},We=function(){var e=b.g().params.projectId,t=c.useState([]),n=Object(l.a)(t,2),r=n[0],i=n[1],o=c.useState(null),s=Object(l.a)(o,2),u=s[0],d=s[1],h=c.useState(0),f=Object(l.a)(h,2),O=f[0],x=f[1],m=c.useState([]),g=Object(l.a)(m,2),v=g[0],y=g[1],C=c.useState(!1),S=Object(l.a)(C,2),w=S[0],B=S[1];if(c.useEffect((function(){he(e).then(d)}),[]),c.useEffect((function(){xe(e,[],10,!1,!0,0).then(i)}),[e]),c.useEffect((function(){B(!0),xe(e,[],15,!1,!1,-1,O+1).then((function(e){y(e),B(!1)}))}),[e,O]),!u)return null;var I,N=(I=u.labelingConfiguration,Object.keys(I.box.single).length>0||Object.keys(I.box.multiple).length>0||Object.keys(I.box.text).length>0||Object.keys(I.image.single).length>0||Object.keys(I.image.multiple).length>0||Object.keys(I.image.text).length>0);return Object(a.jsxs)(p.a,{container:!0,spacing:2,children:[Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsxs)(J,{project:u,children:[Object(a.jsx)(j.b,{to:"/",children:"QSL"})," /"," ",Object(a.jsx)(j.b,{to:"/projects/".concat(u.name),children:u.name})]})}),Object(a.jsx)(p.a,{item:!0,children:Object(a.jsxs)("ul",{children:[N&&v.length>0?Object(a.jsx)("li",{children:r.length>0?Object(a.jsx)(j.b,{to:"/projects/".concat(e,"/images/").concat(r[0].id),children:Object(a.jsx)(_.a,{variant:"body1",children:"Start labeling individual images"})}):Object(a.jsx)(_.a,{variant:"body1",children:"No images remain for labeling."})}):null,N&&0!==v.length&&0!==r.length?Object(a.jsx)("li",{children:Object(a.jsx)(j.b,{to:"/projects/".concat(e,"/batches/").concat(r.map((function(e){return e.id})).join(",")),children:Object(a.jsx)(_.a,{variant:"body1",children:"Start labeling image batches"})})}):null,Object(a.jsx)("li",{children:Object(a.jsx)(j.b,{to:"/projects/".concat(e,"/edit-project"),children:Object(a.jsx)(_.a,{variant:"body1",children:N?"Edit project configuration":"Configure project"})})}),Object(a.jsx)("li",{children:Object(a.jsx)("a",{href:ve(e),children:Object(a.jsx)(_.a,{variant:"body1",children:"Export project"})})})]})}),Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsx)(re.a,{rows:v,autoHeight:!0,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,disableColumnFilter:!0,columns:[{field:"id",headerName:"ID",flex:1,disableColumnMenu:!0,renderCell:function(t){return Object(a.jsx)(j.b,{to:"/projects/".concat(e,"/images/").concat(t.value),children:t.value})}},{field:"filepath",headerName:"Path",flex:5},{field:"labels",headerName:"# Labels",flex:1},{field:"status",headerName:"Status",renderCell:function(e){return Object(a.jsx)("span",{style:{textTransform:"capitalize"},children:e.value})},flex:1}],pagination:!0,pageSize:15,rowsPerPageOptions:[15],rowCount:u.nImages,paginationMode:"server",onPageChange:function(e){return x(e.page)},loading:w})}),Object(a.jsx)(p.a,{item:!0,children:Object(a.jsx)(k.a,{component:j.b,to:"/projects/".concat(e,"/add-images"),variant:"contained",color:"primary",disabled:!N,children:"Add Images"})})]})},Je=function(){var e=c.useState(""),t=Object(l.a)(e,2),n=t[0],r=t[1],i=c.useState([]),o=Object(l.a)(i,2),s=o[0],u=o[1];c.useEffect((function(){fetch("".concat(ie,"/api/v1/projects"),ue).then((function(e){return e.json()})).then(u)}),[]);var b=c.useCallback((function(){fe({name:n,id:null,labelingConfiguration:null}).then((function(e){u(s.concat([e])),r("")}))}),[n,s,u]),d=c.useCallback((function(e){he(e.id).then((function(t){return fe(Object(x.a)(Object(x.a)({},t),{},{name:"".concat(e.name," (Duplicate)")}))})).then((function(e){return u(s.concat([e]))}))}),[s,u]);return Object(a.jsxs)(p.a,{container:!0,spacing:2,children:[Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsx)(re.a,{rows:s,disableColumnSelector:!0,disableSelectionOnClick:!0,disableColumnMenu:!0,disableColumnFilter:!0,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:1,renderCell:function(e){return Object(a.jsx)(j.b,{to:"/projects/".concat(e.value),children:e.value})}},{field:"name",headerName:"Name",flex:3},{field:"nImages",headerName:"Number of Images",flex:1},{field:"nLabeled",headerName:"Labeled Images",flex:1},{field:"Actions",renderCell:function(e){return Object(a.jsxs)("div",{children:[Object(a.jsx)(k.a,{variant:"outlined",component:j.b,to:"/projects/".concat(e.row.id,"/edit-project"),style:{marginRight:"10px"},children:"Edit"}),Object(a.jsx)(k.a,{variant:"outlined",onClick:function(){return d(e.row)},children:"Duplicate"})]})},flex:2}]})}),Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsxs)(S.a,{children:[Object(a.jsx)(v.a,{value:n,placeholder:"New project name",onChange:function(e){return r(e.target.value)},style:{marginRight:"10px"}}),Object(a.jsx)(k.a,{variant:"contained",color:"primary",disabled:""===n,onClick:b,children:"Create Project"})]})})]})},Ye=function(){var e=c.useState({newUserName:"",users:[],myUser:null,authConfig:null,newUserAdmin:!1}),t=Object(l.a)(e,2),n=t[0],r=t[1];c.useEffect((function(){Promise.all([de(),fetch("".concat(ie,"/api/v1/users"),ue).then((function(e){return e.json()})),be()]).then((function(e){var t=Object(l.a)(e,3),a=t[0],c=t[1],i=t[2];r(Object(x.a)(Object(x.a)({},n),{},{myUser:a,users:c,authConfig:i}))}))}),[]);var i=c.useCallback((function(){var e;(e={name:n.newUserName,isAdmin:n.newUserAdmin,id:null},fetch("".concat(ie,"/api/v1/users"),Object(x.a)(Object(x.a)({},je),{},{body:JSON.stringify(e)})).then((function(e){return e.json()}))).then((function(e){r(Object(x.a)(Object(x.a)({},n),{},{newUserName:"",users:n.users.concat([e])}))}))}),[n]);return n.myUser&&n.authConfig?Object(a.jsxs)(p.a,{container:!0,spacing:2,children:[Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsxs)(_.a,{variant:"body1",children:["github"===n.authConfig.provider?"You are using GitHub as the authentication provider. Usernames should match GitHub usernames.":null,"google"===n.authConfig.provider?"You are using Google as the authentication provider. Usernames should match email addresses.":null,null===n.authConfig.provider?"You are not using an authentication provider. You will always be logged in as the first user.":null]})}),Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsx)(re.a,{rows:n.users,autoHeight:!0,columns:[{field:"id",headerName:"ID",flex:1,disableColumnMenu:!0},{field:"name",headerName:"Name",flex:5,disableColumnMenu:!0},{field:"isAdmin",headerName:"Adminstrator",flex:2,valueFormatter:function(e){return e.value?"Yes":"No"},disableColumnMenu:!0}]})}),Object(a.jsx)(p.a,{item:!0,xs:12,children:n.myUser.isAdmin?Object(a.jsxs)(p.a,{container:!0,direction:"row",children:[Object(a.jsx)(v.a,{value:n.newUserName,onChange:function(e){return r(Object(x.a)(Object(x.a)({},n),{},{newUserName:e.target.value}))},placeholder:"New user name"}),Object(a.jsx)(g.a,{control:Object(a.jsx)(L.a,{checked:n.newUserAdmin,onChange:function(e,t){return r(Object(x.a)(Object(x.a)({},n),{},{newUserAdmin:t}))},name:"makeAdmin"}),label:"Administrator"}),Object(a.jsx)(k.a,{disabled:""===n.newUserName,onClick:i,children:"Create User"})]}):null})]}):null},Qe=function(){return Object(a.jsxs)(p.a,{container:!0,spacing:2,children:[Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsx)(J,{children:Object(a.jsx)(j.b,{to:"/",children:"QSL"})})}),Object(a.jsxs)(p.a,{item:!0,xs:12,children:[Object(a.jsx)(_.a,{style:{marginTop:"10px",marginBottom:"10px"},variant:"h4",children:"Projects"}),Object(a.jsx)(Je,{}),Object(a.jsx)(_.a,{style:{marginTop:"20px",marginBottom:"10px"},variant:"h4",children:"Users"}),Object(a.jsx)(Ye,{})]})]})},Xe=s.a({components:{MuiImageListItem:{styleOverrides:{img:{maxWidth:"100%",maxHeight:"100%",height:"auto",width:"auto",transform:"none",margin:"auto",position:"absolute",top:0,bottom:0,left:0,right:0}}}}}),Ze=function(){var e=c.useState({user:void 0,config:void 0}),t=Object(l.a)(e,2),n=t[0],r=t[1];return c.useEffect((function(){Promise.all([de(),be()]).then((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return r({user:n,config:a})}),(function(){r({user:null,config:null})}))}),[]),void 0===n.user?null:null===n.user?(window.location.href="".concat(ie,"/auth/login"),null):Object(a.jsx)(u.a,{theme:Xe,children:Object(a.jsx)(j.a,{children:Object(a.jsxs)(b.d,{children:[Object(a.jsx)(b.b,{path:"/projects/:projectId/images/:imageId",children:Object(a.jsx)(He,{})}),Object(a.jsx)(b.b,{path:"/projects/:projectId/batches/:imageIds",children:Object(a.jsx)(Be,{})}),Object(a.jsx)(b.b,{path:"/projects/:projectId/edit-project",children:Object(a.jsx)(Ke,{})}),Object(a.jsx)(b.b,{path:"/projects/:projectId/add-images",children:Object(a.jsx)(Ve,{})}),Object(a.jsx)(b.b,{path:"/projects/:projectId",children:Object(a.jsx)(We,{})}),Object(a.jsx)(b.b,{path:"/projects",children:null!==n.config.singleProject?Object(a.jsx)(b.a,{to:"/projects/".concat(n.config.singleProject)}):Object(a.jsx)(Qe,{})}),Object(a.jsx)(b.b,{path:"/users",children:null!==n.config.singleProject?Object(a.jsx)(b.a,{to:"/projects/".concat(n.config.singleProject)}):Object(a.jsx)(Qe,{})}),Object(a.jsx)(b.b,{path:"/",children:null!==n.config.singleProject?Object(a.jsx)(b.a,{to:"/projects/".concat(n.config.singleProject)}):Object(a.jsx)(Qe,{})})]})})})};n(198);o.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(Ze,{})}),document.getElementById("root"))}},[[199,1,2]]]);
//# sourceMappingURL=main.035b177b.chunk.js.map