{"version":3,"sources":["webpack://ipydraw/./src/index.ts","webpack://ipydraw/./src/version.ts","webpack://ipydraw/./src/widget.ts","webpack://ipydraw/external \"@jupyter-widgets/base\"","webpack://ipydraw/webpack/bootstrap","webpack://ipydraw/webpack/startup"],"names":["data","MODULE_VERSION","version","MODULE_NAME","name","CanvasModel","DOMWidgetModel","super","defaults","_model_name","model_name","_model_module","model_module","_model_module_version","model_module_version","_view_name","view_name","_view_module","view_module","_view_module_version","view_module_version","path","line_width","size","color","serializers","CanvasView","DOMWidgetView","Array","from","this","model","get","lastPoint","drawing","onMouseMove","e","point","currentPoint","push","redraw","onMouseDown","window","addEventListener","onMouseUp","sendUpdate","removeEventListener","el","classList","add","canvas","document","createElement","width","height","style","border","context","getContext","lineWidth","strokeStyle","lineJoin","appendChild","createClearButton","createColorPicker","event","rect","getBoundingClientRect","clientX","left","clientY","top","points","inStroke","lineTo","moveTo","beginPath","stroke","closePath","set","toDataURL","updated_view","touch","button","onclick","preventDefault","clearRect","innerText","input","type","pt","value","onchange","currentTarget","module","exports","__WEBPACK_EXTERNAL_MODULE__612__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call"],"mappings":"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","file":"embed-bundle.js","sourcesContent":["// Copyright (c) Travis DePrato\n// Distributed under the terms of the Modified BSD License.\n\nexport * from './version';\nexport * from './widget';\n","// Copyright (c) Travis DePrato\n// Distributed under the terms of the Modified BSD License.\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst data = require('../package.json');\n\n/**\n * The _model_module_version/_view_module_version this package implements.\n *\n * The html widget manager assumes that this is the same as the npm package\n * version number.\n */\nexport const MODULE_VERSION = data.version;\n\n/*\n * The current package name.\n */\nexport const MODULE_NAME = data.name;\n","// Copyright (c) Travis DePrato\n// Distributed under the terms of the Modified BSD License.\n\nimport {\n  DOMWidgetModel,\n  DOMWidgetView,\n  ISerializers,\n} from '@jupyter-widgets/base';\n\nimport { MODULE_NAME, MODULE_VERSION } from './version';\n\ntype Point = [number, number];\n\nexport class CanvasModel extends DOMWidgetModel {\n  defaults() {\n    return {\n      ...super.defaults(),\n      _model_name: CanvasModel.model_name,\n      _model_module: CanvasModel.model_module,\n      _model_module_version: CanvasModel.model_module_version,\n      _view_name: CanvasModel.view_name,\n      _view_module: CanvasModel.view_module,\n      _view_module_version: CanvasModel.view_module_version,\n      data: '',\n      path: [],\n      line_width: 10,\n      size: [200, 200],\n      color: false,\n    };\n  }\n\n  static serializers: ISerializers = {\n    ...DOMWidgetModel.serializers,\n    // Add any extra serializers here\n  };\n\n  static model_name = 'CanvasModel';\n  static model_module = MODULE_NAME;\n  static model_module_version = MODULE_VERSION;\n  static view_name = 'CanvasView';\n  static view_module = MODULE_NAME;\n  static view_module_version = MODULE_VERSION;\n}\n\ntype Path = Array<Point | string | null>;\n\nexport class CanvasView extends DOMWidgetView {\n  canvas: HTMLCanvasElement;\n  context: CanvasRenderingContext2D;\n  declare model: CanvasModel;\n\n  // An array of points that forms the overall path that is drawn.\n  // The path can can actually consist of multiple strokes. A null element\n  // signifies the end of the previous stroke and the beginning of the next\n  // stroke.\n  private path: Path = Array.from(this.model.get('path'));\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  private lastPoint: Point | null = null;\n  private drawing = false;\n\n  render(): void {\n    this.el.classList.add('ipydraw-canvas');\n\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = this.model.get('size')[0];\n    this.canvas.height = this.model.get('size')[1];\n    this.canvas.style.border = '1px solid #ccc';\n\n    this.context = this.canvas.getContext('2d') as CanvasRenderingContext2D;\n    this.context.lineWidth = this.model.get('line_width');\n    this.context.strokeStyle = 'black';\n    this.context.lineJoin = 'round';\n\n    this.canvas.addEventListener('mousemove', this.onMouseMove);\n    this.canvas.addEventListener('mousedown', this.onMouseDown);\n    this.el.appendChild(this.canvas);\n    this.el.appendChild(this.createClearButton());\n    if (this.model.get('color')) {\n      this.el.appendChild(this.createColorPicker());\n    }\n    this.redraw();\n  }\n\n  private currentPoint(event: MouseEvent): Point {\n    const rect = this.canvas.getBoundingClientRect();\n    return [event.clientX - rect.left, event.clientY - rect.top];\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const point = this.currentPoint(e);\n    this.lastPoint = point;\n    if (!this.drawing) {\n      return;\n    }\n    this.path.push(point);\n    this.redraw();\n  };\n\n  private onMouseDown = (e: MouseEvent) => {\n    this.lastPoint = this.currentPoint(e);\n    this.drawing = true;\n    window.addEventListener('mouseup', this.onMouseUp);\n  };\n\n  private onMouseUp = (e: MouseEvent) => {\n    this.drawing = false;\n    this.path.push(null);\n    this.redraw();\n    this.sendUpdate();\n    window.removeEventListener('mouseup', this.onMouseUp);\n  };\n\n  private redraw() {\n    const points = this.path || [];\n    const context = this.context;\n    let inStroke = false;\n\n    context.strokeStyle = 'black';\n\n    // always add a terminating null point\n    for (const point of [...points, null]) {\n      if (point === null) {\n        if (inStroke) {\n          context.stroke();\n          context.closePath();\n          inStroke = false;\n        }\n        continue;\n      }\n      if (typeof point === 'string') {\n        // change color\n        context.strokeStyle = point;\n        continue;\n      }\n      if (!inStroke) {\n        // start a new stroke\n        context.moveTo(...point);\n        context.beginPath();\n        inStroke = true;\n      } else {\n        // continue the previous stroke\n        context.lineTo(...point);\n      }\n    }\n  }\n\n  private sendUpdate() {\n    this.model.set('data', this.canvas.toDataURL(), { updated_view: this });\n    this.model.set('path', Array.from(this.path), { updated_view: this });\n    this.touch();\n  }\n\n  private createClearButton(): HTMLButtonElement {\n    const button = document.createElement('button');\n    button.onclick = (e) => {\n      e.preventDefault();\n      this.path = [];\n      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      this.redraw();\n      this.sendUpdate();\n    };\n    button.innerText = 'Clear';\n    return button;\n  }\n\n  private createColorPicker(): HTMLElement {\n    const input = document.createElement('input');\n    input.type = 'color';\n\n    // loop through the path to find the last set color\n    for (const pt of this.path) {\n      if (typeof pt === 'string') {\n        input.value = pt;\n      }\n    }\n\n    input.onchange = (event) => {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      this.path.push(event.currentTarget.value);\n    };\n\n    return input;\n  }\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__612__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(607);\n"],"sourceRoot":""}