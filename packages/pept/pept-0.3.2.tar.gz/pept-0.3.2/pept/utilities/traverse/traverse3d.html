<!DOCTYPE html>
<!-- Generated by Cython 0.29.23 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: traverse3d.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.23</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="traverse3d.c">traverse3d.c</a></p>
<div class="cython"><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: # -*- coding: utf-8 -*-</pre>
<pre class='cython code score-13 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_kp_u_traverse3d_line_110, __pyx_kp_u_Fast_voxel_traversal_for_3D_lin) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: #    pept is a Python library that unifies Positron Emission Particle</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: #    Tracking (PEPT) research, including tracking, simulation, data analysis</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: #    and visualisation tools.</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: #    If you used this codebase or any software making use of it in a scientific</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: #    publication, you must cite the following paper:</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: #        Nicuşan AL, Windows-Yule CR. Positron emission particle tracking</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: #        using machine learning. Review of Scientific Instruments.</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: #        2020 Jan 1;91(1):013329.</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: #        https://doi.org/10.1063/1.5129251</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: #    Copyright (C) 2019-2021 the pept developers</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: #    This program is free software: you can redistribute it and/or modify</pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: #    it under the terms of the GNU General Public License as published by</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: #    the Free Software Foundation, either version 3 of the License, or</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: #    (at your option) any later version.</pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: #    This program is distributed in the hope that it will be useful,</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: #    but WITHOUT ANY WARRANTY; without even the implied warranty of</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: #    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: #    GNU General Public License for more details.</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: #    You should have received a copy of the GNU General Public License</pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: #    along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: #    pept is a Python library that unifies Positron Emission Particle</pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: #    Tracking (PEPT) research, including tracking, simulation, data analysis</pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: #    and visualisation tools</pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: # File              : traverse3d.pyx</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: # License           : GNU v3.0</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: # Author            : Andrei Leonard Nicusan &lt;a.l.nicusan@bham.ac.uk&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: # Date              : 03.02.2019</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: # cython: language_level=3</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: # cython: boundscheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: # cython: wraparound=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: # cython: initializedcheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: # cython: nonecheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: # cython: embedsignature=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: # cython: cdivision=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>: from libc.float cimport DBL_MAX</pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>: cdef inline double fabs(double x) nogil:</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE double __pyx_f_4pept_9utilities_8traverse_10traverse3d_fabs(double __pyx_v_x) {
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">053</span>:     return (x if x &gt;= 0 else -x)</pre>
<pre class='cython code score-0 '>  if (((__pyx_v_x &gt;= 0.0) != 0)) {
    __pyx_t_1 = __pyx_v_x;
  } else {
    __pyx_t_1 = (-__pyx_v_x);
  }
  __pyx_r = __pyx_t_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">054</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>: cdef inline void swap(double *x, double *y) nogil:</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE void __pyx_f_4pept_9utilities_8traverse_10traverse3d_swap(double *__pyx_v_x, double *__pyx_v_y) {
  double __pyx_v_aux;
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0">&#xA0;<span class="">057</span>:     cdef double aux</pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">059</span>:     aux = x[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_aux = (__pyx_v_x[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">060</span>:     x[0] = y[0]</pre>
<pre class='cython code score-0 '>  (__pyx_v_x[0]) = (__pyx_v_y[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">061</span>:     y[0] = aux</pre>
<pre class='cython code score-0 '>  (__pyx_v_y[0]) = __pyx_v_aux;
</pre><pre class="cython line score-0">&#xA0;<span class="">062</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">064</span>: cdef double intersect(</pre>
<pre class='cython code score-0 '>static double __pyx_f_4pept_9utilities_8traverse_10traverse3d_intersect(double *__pyx_v_u, double *__pyx_v_v, double __pyx_v_xmin, double __pyx_v_xmax, double __pyx_v_ymin, double __pyx_v_ymax, double __pyx_v_zmin, double __pyx_v_zmax) {
  double __pyx_v_tmin;
  double __pyx_v_tmax;
  double __pyx_v_tymin;
  double __pyx_v_tymax;
  double __pyx_v_tzmin;
  double __pyx_v_tzmax;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">065</span>:     double[3] u,</pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:     double[3] v,</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>:     double xmin,</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:     double xmax,</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:     double ymin,</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>:     double ymax,</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>:     double zmin,</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:     double zmax,</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>: ) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:     '''Given a 3D line defined as L(t) = U + t V and an axis-aligned bounding</pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:     box (AABB), find the `t` for which the line intersects the box, if it</pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:     exists.</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:     It is assumed that the line starts *outside* the AABB, so that t == 0.0 is</pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:     only reserved for when the line does not intersect the box.</pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:     '''</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:     cdef double tmin, tmax, tymin, tymax, tzmin, tzmax</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">084</span>:     tmin = (xmin - u[0]) / v[0]     # Relies on IEEE FP behaviour for div by 0</pre>
<pre class='cython code score-0 '>  __pyx_v_tmin = ((__pyx_v_xmin - (__pyx_v_u[0])) / (__pyx_v_v[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">085</span>:     tmax = (xmax - u[0]) / v[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_tmax = ((__pyx_v_xmax - (__pyx_v_u[0])) / (__pyx_v_v[0]));
</pre><pre class="cython line score-0">&#xA0;<span class="">086</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">087</span>:     tymin = (ymin - u[1]) / v[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_tymin = ((__pyx_v_ymin - (__pyx_v_u[1])) / (__pyx_v_v[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:     tymax = (ymax - u[1]) / v[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_tymax = ((__pyx_v_ymax - (__pyx_v_u[1])) / (__pyx_v_v[1]));
</pre><pre class="cython line score-0">&#xA0;<span class="">089</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">090</span>:     tzmin = (zmin - u[2]) / v[2]</pre>
<pre class='cython code score-0 '>  __pyx_v_tzmin = ((__pyx_v_zmin - (__pyx_v_u[2])) / (__pyx_v_v[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:     tzmax = (zmax - u[2]) / v[2]</pre>
<pre class='cython code score-0 '>  __pyx_v_tzmax = ((__pyx_v_zmax - (__pyx_v_u[2])) / (__pyx_v_v[2]));
</pre><pre class="cython line score-0">&#xA0;<span class="">092</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>:     if tmin &gt; tmax: swap(&amp;tmin, &amp;tmax)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tmin &gt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
    __pyx_f_4pept_9utilities_8traverse_10traverse3d_swap((&amp;__pyx_v_tmin), (&amp;__pyx_v_tmax));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:     if tymin &gt; tymax: swap(&amp;tymin, &amp;tymax)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tymin &gt; __pyx_v_tymax) != 0);
  if (__pyx_t_1) {
    __pyx_f_4pept_9utilities_8traverse_10traverse3d_swap((&amp;__pyx_v_tymin), (&amp;__pyx_v_tymax));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:     if tzmin &gt; tzmax: swap(&amp;tzmin, &amp;tzmax)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tzmin &gt; __pyx_v_tzmax) != 0);
  if (__pyx_t_1) {
    __pyx_f_4pept_9utilities_8traverse_10traverse3d_swap((&amp;__pyx_v_tzmin), (&amp;__pyx_v_tzmax));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">096</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>:     if tmin &gt; tymax or tymin &gt; tmax: return 0.0</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_tmin &gt; __pyx_v_tymax) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L7_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tymin &gt; __pyx_v_tmax) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L7_bool_binop_done:;
  if (__pyx_t_1) {
    __pyx_r = 0.0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">098</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:     if tymin &gt; tmin: tmin = tymin</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tymin &gt; __pyx_v_tmin) != 0);
  if (__pyx_t_1) {
    __pyx_v_tmin = __pyx_v_tymin;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>:     if tymax &lt; tmax: tmax = tymax</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tymax &lt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
    __pyx_v_tmax = __pyx_v_tymax;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">101</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>:     if tmin &gt; tzmax or tzmin &gt; tmax: return 0.0</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_tmin &gt; __pyx_v_tzmax) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L12_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tzmin &gt; __pyx_v_tmax) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L12_bool_binop_done:;
  if (__pyx_t_1) {
    __pyx_r = 0.0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">103</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>:     if tzmin &gt; tmin: tmin = tzmin</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tzmin &gt; __pyx_v_tmin) != 0);
  if (__pyx_t_1) {
    __pyx_v_tmin = __pyx_v_tzmin;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">105</span>:     if tzmax &lt; tmax: tmax = tzmax</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tzmax &lt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
    __pyx_v_tmax = __pyx_v_tzmax;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">106</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">107</span>:     return tmin</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_tmin;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">108</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>: </pre>
<pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">110</span>: cpdef void traverse3d(</pre>
<pre class='cython code score-56 '>static PyObject *__pyx_pw_4pept_9utilities_8traverse_10traverse3d_1traverse3d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static void __pyx_f_4pept_9utilities_8traverse_10traverse3d_traverse3d(__Pyx_memviewslice __pyx_v_voxels, __Pyx_memviewslice __pyx_v_lines, __Pyx_memviewslice __pyx_v_grid_x, __Pyx_memviewslice __pyx_v_grid_y, __Pyx_memviewslice __pyx_v_grid_z, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_n_lines;
  Py_ssize_t __pyx_v_nx;
  Py_ssize_t __pyx_v_ny;
  Py_ssize_t __pyx_v_nz;
  double __pyx_v_gsize_x;
  double __pyx_v_gsize_y;
  double __pyx_v_gsize_z;
  double __pyx_v_xmin;
  double __pyx_v_xmax;
  double __pyx_v_ymin;
  double __pyx_v_ymax;
  double __pyx_v_zmin;
  double __pyx_v_zmax;
  Py_ssize_t __pyx_v_ix;
  Py_ssize_t __pyx_v_iy;
  Py_ssize_t __pyx_v_iz;
  double __pyx_v_p1[3];
  double __pyx_v_p2[3];
  double __pyx_v_u[3];
  double __pyx_v_v[3];
  double __pyx_v_t;
  Py_ssize_t __pyx_v_step_x;
  Py_ssize_t __pyx_v_step_y;
  Py_ssize_t __pyx_v_step_z;
  double __pyx_v_tnext_x;
  double __pyx_v_tnext_y;
  double __pyx_v_tnext_z;
  double __pyx_v_deltat_x;
  double __pyx_v_deltat_y;
  double __pyx_v_deltat_z;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
/* … */
  /* function exit code */
}

/* Python wrapper */
static PyObject *__pyx_pw_4pept_9utilities_8traverse_10traverse3d_1traverse3d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4pept_9utilities_8traverse_10traverse3d_traverse3d[] = "traverse3d(double[:, :, :] voxels, double[:, :] lines, double[:] grid_x, double[:] grid_y, double[:] grid_z) -&gt; void\n Fast voxel traversal for 3D lines (or LoRs).\n\n    ::\n\n        Function Signature:\n            traverse3d(\n                long[:, :, :] voxels,       # Initialised!\n                double[:, :] lines,         # Has exactly 7 columns!\n                double[:] grid_x,           # Has voxels.shape[0] + 1 elements!\n                double[:] grid_y,           # Has voxels.shape[1] + 1 elements!\n                double[:] grid_z            # Has voxels.shape[2] + 1 elements!\n            )\n\n    This function computes the number of lines that passes through each voxel,\n    saving the result in `voxels`. It does so in an efficient manner, in which\n    for every line, only the voxels that is passes through are traversed.\n\n    As it is highly optimised, this function does not perform any checks on the\n    validity of the input data. Please check the parameters before calling\n    `traverse3d`, as it WILL segfault on wrong input data. Details are given\n    below, along with an example call.\n\n    Parameters\n    ----------\n    voxels : numpy.ndarray(dtype = numpy.float64, ndim = 3)\n        The `voxels` parameter is a numpy.ndarray of shape (X, Y, Z) that\n        has been initialised to zeros before the function call. The values\n        will be modified in-place in the function to reflect the number of\n        lines that pass through each voxel.\n\n    lines : numpy.ndarray(dtype = numpy.float64, ndim = 2)\n        The `lines` parameter is a numpy.ndarray of shape(N, 7), where each\n        row is formatted as [time, x1, y1, z1, x2, y2, z2]. Only indices 1:7\n        will be used as the two points P1 = [x1, y1, z2] and P2 = [x2, y2, z2]\n        defining the line (or LoR).\n\n    grid_x : numpy.ndarray(dtype = numpy.float64, ndim = 1)\n        The grid_x parameter is a one-dimensional grid that delimits the\n        voxels in the x-dimen""sion. It must be *sorted* in ascending order\n        with *equally-spaced* numbers and length X + 1 (voxels.shape[0] + 1).\n\n    grid_y : numpy.ndarray(dtype = numpy.float64, ndim = 1)\n        The grid_y parameter is a one-dimensional grid that delimits the\n        voxels in the y-dimension. It must be *sorted* in ascending order\n        with *equally-spaced* numbers and length Y + 1 (voxels.shape[1] + 1).\n\n    grid_z : numpy.ndarray(dtype = numpy.float64, ndim = 1)\n        The grid_z parameter is a one-dimensional grid that delimits the\n        voxels in the z-dimension. It must be *sorted* in ascending order\n        with *equally-spaced* numbers and length Z + 1 (voxels.shape[2] + 1).\n\n    Examples\n    --------\n    The input parameters can be easily generated using numpy before calling the\n    function. For example, if a volume of 300 x 400 x 500 is split into\n    30 x 40 x 50 voxels, a possible code would be:\n\n    &gt;&gt;&gt; import numpy as np\n    &gt;&gt;&gt; from pept.utilities.traverse import traverse3d\n    &gt;&gt;&gt;\n    &gt;&gt;&gt; volume = [300, 400, 500]\n    &gt;&gt;&gt; number_of_voxels = [30, 40, 50]\n    &gt;&gt;&gt; voxels = np.zeros(number_of_voxels)\n\n    The grid has one extra element than the number of voxels. For example, 5\n    voxels between 0 and 5 would be delimited by the grid [0, 1, 2, 3, 4, 5]\n    which has 6 elements (see off-by-one errors - story of my life).\n\n    &gt;&gt;&gt; grid_x = np.linspace(0, volume[0], number_of_voxels[0] + 1)\n    &gt;&gt;&gt; grid_y = np.linspace(0, volume[1], number_of_voxels[1] + 1)\n    &gt;&gt;&gt; grid_z = np.linspace(0, volume[2], number_of_voxels[2] + 1)\n    &gt;&gt;&gt;\n    &gt;&gt;&gt; random_lines = np.random.random((100, 7)) * 300\n\n    Calling `traverse3d` will modify `voxels` in-place.\n\n    &gt;&gt;&gt; traverse3d(voxels, random_lines, grid_x, grid_y, grid_z)\n\n    Notes\n    -----\n    This function is an adaptation of a widely-used algorithm [1]_, optimised\n    for PEPT LoRs traversal.\n\n    .. [1] Amanatides J, Woo A. A fast voxel traversal algorithm for ray trac""ing.\n       InEurographics 1987 Aug 24 (Vol. 87, No. 3, pp. 3-10)..\n\n    ";
static PyObject *__pyx_pw_4pept_9utilities_8traverse_10traverse3d_1traverse3d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_voxels = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_lines = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_grid_x = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_grid_y = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_grid_z = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("traverse3d (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_voxels,&amp;__pyx_n_s_lines,&amp;__pyx_n_s_grid_x,&amp;__pyx_n_s_grid_y,&amp;__pyx_n_s_grid_z,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_voxels)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lines)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse3d", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_grid_x)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse3d", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_grid_y)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse3d", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_grid_z)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse3d", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "traverse3d") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_voxels = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_voxels.memview)) __PYX_ERR(0, 111, __pyx_L3_error)</span>
    __pyx_v_lines = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_lines.memview)) __PYX_ERR(0, 112, __pyx_L3_error)</span>
    __pyx_v_grid_x = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_grid_x.memview)) __PYX_ERR(0, 113, __pyx_L3_error)</span>
    __pyx_v_grid_y = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_grid_y.memview)) __PYX_ERR(0, 114, __pyx_L3_error)</span>
    __pyx_v_grid_z = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_grid_z.memview)) __PYX_ERR(0, 115, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse3d", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.utilities.traverse.traverse3d.traverse3d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4pept_9utilities_8traverse_10traverse3d_traverse3d(__pyx_self, __pyx_v_voxels, __pyx_v_lines, __pyx_v_grid_x, __pyx_v_grid_y, __pyx_v_grid_z);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4pept_9utilities_8traverse_10traverse3d_traverse3d(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_voxels, __Pyx_memviewslice __pyx_v_lines, __Pyx_memviewslice __pyx_v_grid_x, __Pyx_memviewslice __pyx_v_grid_y, __Pyx_memviewslice __pyx_v_grid_z) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("traverse3d", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_4pept_9utilities_8traverse_10traverse3d_traverse3d(__pyx_v_voxels, __pyx_v_lines, __pyx_v_grid_x, __pyx_v_grid_y, __pyx_v_grid_z, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.utilities.traverse.traverse3d.traverse3d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_voxels, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lines, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_grid_x, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_grid_y, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_grid_z, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">111</span>:     double[:, :, :] voxels,     # Initialised!</pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>:     double[:, :] lines,         # Has exactly 7 columns!</pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>:     double[:] grid_x,           # Has voxels.shape[0] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>:     double[:] grid_y,           # Has voxels.shape[1] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>:     double[:] grid_z            # Has voxels.shape[2] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>: ) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:     ''' Fast voxel traversal for 3D lines (or LoRs).</pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>:     ::</pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>:         Function Signature:</pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:             traverse3d(</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:                 long[:, :, :] voxels,       # Initialised!</pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:                 double[:, :] lines,         # Has exactly 7 columns!</pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:                 double[:] grid_x,           # Has voxels.shape[0] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:                 double[:] grid_y,           # Has voxels.shape[1] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>:                 double[:] grid_z            # Has voxels.shape[2] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:             )</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:     This function computes the number of lines that passes through each voxel,</pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:     saving the result in `voxels`. It does so in an efficient manner, in which</pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:     for every line, only the voxels that is passes through are traversed.</pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>:     As it is highly optimised, this function does not perform any checks on the</pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>:     validity of the input data. Please check the parameters before calling</pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>:     `traverse3d`, as it WILL segfault on wrong input data. Details are given</pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>:     below, along with an example call.</pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">140</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">141</span>:     voxels : numpy.ndarray(dtype = numpy.float64, ndim = 3)</pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>:         The `voxels` parameter is a numpy.ndarray of shape (X, Y, Z) that</pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:         has been initialised to zeros before the function call. The values</pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>:         will be modified in-place in the function to reflect the number of</pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>:         lines that pass through each voxel.</pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:     lines : numpy.ndarray(dtype = numpy.float64, ndim = 2)</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:         The `lines` parameter is a numpy.ndarray of shape(N, 7), where each</pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>:         row is formatted as [time, x1, y1, z1, x2, y2, z2]. Only indices 1:7</pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:         will be used as the two points P1 = [x1, y1, z2] and P2 = [x2, y2, z2]</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>:         defining the line (or LoR).</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:     grid_x : numpy.ndarray(dtype = numpy.float64, ndim = 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:         The grid_x parameter is a one-dimensional grid that delimits the</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>:         voxels in the x-dimension. It must be *sorted* in ascending order</pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:         with *equally-spaced* numbers and length X + 1 (voxels.shape[0] + 1).</pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>:     grid_y : numpy.ndarray(dtype = numpy.float64, ndim = 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:         The grid_y parameter is a one-dimensional grid that delimits the</pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>:         voxels in the y-dimension. It must be *sorted* in ascending order</pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>:         with *equally-spaced* numbers and length Y + 1 (voxels.shape[1] + 1).</pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>:     grid_z : numpy.ndarray(dtype = numpy.float64, ndim = 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>:         The grid_z parameter is a one-dimensional grid that delimits the</pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>:         voxels in the z-dimension. It must be *sorted* in ascending order</pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>:         with *equally-spaced* numbers and length Z + 1 (voxels.shape[2] + 1).</pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">168</span>:     Examples</pre>
<pre class="cython line score-0">&#xA0;<span class="">169</span>:     --------</pre>
<pre class="cython line score-0">&#xA0;<span class="">170</span>:     The input parameters can be easily generated using numpy before calling the</pre>
<pre class="cython line score-0">&#xA0;<span class="">171</span>:     function. For example, if a volume of 300 x 400 x 500 is split into</pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>:     30 x 40 x 50 voxels, a possible code would be:</pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>:     &gt;&gt;&gt; import numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>:     &gt;&gt;&gt; from pept.utilities.traverse import traverse3d</pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>:     &gt;&gt;&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">177</span>:     &gt;&gt;&gt; volume = [300, 400, 500]</pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>:     &gt;&gt;&gt; number_of_voxels = [30, 40, 50]</pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>:     &gt;&gt;&gt; voxels = np.zeros(number_of_voxels)</pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>:     The grid has one extra element than the number of voxels. For example, 5</pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:     voxels between 0 and 5 would be delimited by the grid [0, 1, 2, 3, 4, 5]</pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>:     which has 6 elements (see off-by-one errors - story of my life).</pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>:     &gt;&gt;&gt; grid_x = np.linspace(0, volume[0], number_of_voxels[0] + 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>:     &gt;&gt;&gt; grid_y = np.linspace(0, volume[1], number_of_voxels[1] + 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>:     &gt;&gt;&gt; grid_z = np.linspace(0, volume[2], number_of_voxels[2] + 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>:     &gt;&gt;&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">189</span>:     &gt;&gt;&gt; random_lines = np.random.random((100, 7)) * 300</pre>
<pre class="cython line score-0">&#xA0;<span class="">190</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">191</span>:     Calling `traverse3d` will modify `voxels` in-place.</pre>
<pre class="cython line score-0">&#xA0;<span class="">192</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>:     &gt;&gt;&gt; traverse3d(voxels, random_lines, grid_x, grid_y, grid_z)</pre>
<pre class="cython line score-0">&#xA0;<span class="">194</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">195</span>:     Notes</pre>
<pre class="cython line score-0">&#xA0;<span class="">196</span>:     -----</pre>
<pre class="cython line score-0">&#xA0;<span class="">197</span>:     This function is an adaptation of a widely-used algorithm [1]_, optimised</pre>
<pre class="cython line score-0">&#xA0;<span class="">198</span>:     for PEPT LoRs traversal.</pre>
<pre class="cython line score-0">&#xA0;<span class="">199</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>:     .. [1] Amanatides J, Woo A. A fast voxel traversal algorithm for ray tracing.</pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>:        InEurographics 1987 Aug 24 (Vol. 87, No. 3, pp. 3-10)..</pre>
<pre class="cython line score-0">&#xA0;<span class="">202</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">203</span>:     '''</pre>
<pre class="cython line score-0">&#xA0;<span class="">204</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:     cdef Py_ssize_t n_lines = lines.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_n_lines = (__pyx_v_lines.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">206</span>:     cdef Py_ssize_t nx = voxels.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_nx = (__pyx_v_voxels.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>:     cdef Py_ssize_t ny = voxels.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_ny = (__pyx_v_voxels.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>:     cdef Py_ssize_t nz = voxels.shape[2]</pre>
<pre class='cython code score-0 '>  __pyx_v_nz = (__pyx_v_voxels.shape[2]);
</pre><pre class="cython line score-0">&#xA0;<span class="">209</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">210</span>:     # Grid size</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>:     cdef double gsize_x = grid_x[1] - grid_x[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 1;
  __pyx_t_2 = 0;
  __pyx_v_gsize_x = ((*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_1 * __pyx_v_grid_x.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_2 * __pyx_v_grid_x.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">212</span>:     cdef double gsize_y = grid_y[1] - grid_y[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = 1;
  __pyx_t_1 = 0;
  __pyx_v_gsize_y = ((*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_2 * __pyx_v_grid_y.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_1 * __pyx_v_grid_y.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:     cdef double gsize_z = grid_z[1] - grid_z[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 1;
  __pyx_t_2 = 0;
  __pyx_v_gsize_z = ((*((double *) ( /* dim=0 */ (__pyx_v_grid_z.data + __pyx_t_1 * __pyx_v_grid_z.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_grid_z.data + __pyx_t_2 * __pyx_v_grid_z.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">214</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>:     # Delimiting grid</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">216</span>:     cdef double xmin = grid_x[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = 0;
  __pyx_v_xmin = (*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_2 * __pyx_v_grid_x.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>:     cdef double xmax = grid_x[nx]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_nx;
  __pyx_v_xmax = (*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_2 * __pyx_v_grid_x.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">218</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>:     cdef double ymin = grid_y[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = 0;
  __pyx_v_ymin = (*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_2 * __pyx_v_grid_y.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">220</span>:     cdef double ymax = grid_y[ny]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_ny;
  __pyx_v_ymax = (*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_2 * __pyx_v_grid_y.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">221</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:     cdef double zmin = grid_z[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = 0;
  __pyx_v_zmin = (*((double *) ( /* dim=0 */ (__pyx_v_grid_z.data + __pyx_t_2 * __pyx_v_grid_z.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:     cdef double zmax = grid_z[nz]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_nz;
  __pyx_v_zmax = (*((double *) ( /* dim=0 */ (__pyx_v_grid_z.data + __pyx_t_2 * __pyx_v_grid_z.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">224</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">225</span>:     # The current voxel indices [ix, iy, iz] that the line passes</pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>:     # through.</pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>:     cdef Py_ssize_t ix, iy, iz</pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>:     # Define a line as L(t) = U + t V</pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>:     # If an LoR is defined as two points P1 and P2, then</pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>:     # U = P1 and V = P2 - P1</pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>:     cdef double[3] p1, p2, u, v</pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>:     cdef double t</pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>:     # The step [step_x, step_y, step_z] defines the sense of the LoR.</pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>:     # If V[0] is positive, then step_x = 1</pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>:     # If V[0] is negative, then step_x = -1</pre>
<pre class="cython line score-0">&#xA0;<span class="">238</span>:     cdef Py_ssize_t step_x, step_y, step_z</pre>
<pre class="cython line score-0">&#xA0;<span class="">239</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>:     # The value of t at which the line passes through to the next</pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>:     # voxel, for each dimension.</pre>
<pre class="cython line score-0">&#xA0;<span class="">242</span>:     cdef double tnext_x, tnext_y, tnext_z</pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>:     # deltat indicates how far along the ray we must move (in units of</pre>
<pre class="cython line score-0">&#xA0;<span class="">245</span>:     # t) for each component to be equal to the size of the voxel in</pre>
<pre class="cython line score-0">&#xA0;<span class="">246</span>:     # that dimension.</pre>
<pre class="cython line score-0">&#xA0;<span class="">247</span>:     cdef double deltat_x, deltat_y, deltat_z</pre>
<pre class="cython line score-0">&#xA0;<span class="">248</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>:     cdef Py_ssize_t i, j</pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">251</span>:     for i in range(n_lines):</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_n_lines;
  __pyx_t_4 = __pyx_t_3;
  for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_i = __pyx_t_5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">252</span>:         for j in range(3):</pre>
<pre class='cython code score-0 '>    for (__pyx_t_6 = 0; __pyx_t_6 &lt; 3; __pyx_t_6+=1) {
      __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">253</span>:             p1[j] = lines[i, 1 + j]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_i;
      __pyx_t_1 = (1 + __pyx_v_j);
      (__pyx_v_p1[__pyx_v_j]) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_lines.data + __pyx_t_2 * __pyx_v_lines.strides[0]) ) + __pyx_t_1 * __pyx_v_lines.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">254</span>:             p2[j] = lines[i, 4 + j]</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = __pyx_v_i;
      __pyx_t_2 = (4 + __pyx_v_j);
      (__pyx_v_p2[__pyx_v_j]) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_lines.data + __pyx_t_1 * __pyx_v_lines.strides[0]) ) + __pyx_t_2 * __pyx_v_lines.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">255</span>:             u[j] = p1[j]</pre>
<pre class='cython code score-0 '>      (__pyx_v_u[__pyx_v_j]) = (__pyx_v_p1[__pyx_v_j]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">256</span>:             v[j] = p2[j] - p1[j]</pre>
<pre class='cython code score-0 '>      (__pyx_v_v[__pyx_v_j]) = ((__pyx_v_p2[__pyx_v_j]) - (__pyx_v_p1[__pyx_v_j]));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">257</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>:         ##############################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">259</span>:         # Initialisation stage</pre>
<pre class="cython line score-0">&#xA0;<span class="">260</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">261</span>:         step_x = 1 if v[0] &gt;= 0 else -1</pre>
<pre class='cython code score-0 '>    if ((((__pyx_v_v[0]) &gt;= 0.0) != 0)) {
      __pyx_t_6 = 1;
    } else {
      __pyx_t_6 = -1L;
    }
    __pyx_v_step_x = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">262</span>:         step_y = 1 if v[1] &gt;= 0 else -1</pre>
<pre class='cython code score-0 '>    if ((((__pyx_v_v[1]) &gt;= 0.0) != 0)) {
      __pyx_t_6 = 1;
    } else {
      __pyx_t_6 = -1L;
    }
    __pyx_v_step_y = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>:         step_z = 1 if v[2] &gt;= 0 else -1</pre>
<pre class='cython code score-0 '>    if ((((__pyx_v_v[2]) &gt;= 0.0) != 0)) {
      __pyx_t_6 = 1;
    } else {
      __pyx_t_6 = -1L;
    }
    __pyx_v_step_z = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">264</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>:         # If the first point is outside the box, find the first voxel it hits</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">266</span>:         if (u[0] &lt; xmin or u[0] &gt; xmax or</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (((__pyx_v_u[0]) &lt; __pyx_v_xmin) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_8 = (((__pyx_v_u[0]) &gt; __pyx_v_xmax) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
/* … */
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">267</span>:                 u[1] &lt; ymin or u[1] &gt; ymax or</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (((__pyx_v_u[1]) &lt; __pyx_v_ymin) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_8 = (((__pyx_v_u[1]) &gt; __pyx_v_ymax) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">268</span>:                 u[2] &lt; zmin or u[2] &gt; zmax):</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (((__pyx_v_u[2]) &lt; __pyx_v_zmin) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_8 = (((__pyx_v_u[2]) &gt; __pyx_v_zmax) != 0);
    __pyx_t_7 = __pyx_t_8;
    __pyx_L8_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">269</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">270</span>:             t = intersect(u, v, xmin, xmax, ymin, ymax, zmin, zmax)</pre>
<pre class='cython code score-0 '>      __pyx_v_t = __pyx_f_4pept_9utilities_8traverse_10traverse3d_intersect(__pyx_v_u, __pyx_v_v, __pyx_v_xmin, __pyx_v_xmax, __pyx_v_ymin, __pyx_v_ymax, __pyx_v_zmin, __pyx_v_zmax);
</pre><pre class="cython line score-0">&#xA0;<span class="">271</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>:             # No intersection</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">273</span>:             if t == 0.0:</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = ((__pyx_v_t == 0.0) != 0);
      if (__pyx_t_7) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">274</span>:                 continue</pre>
<pre class='cython code score-0 '>        goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">275</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>:             # Overwrite U to correspond to the first intersection point</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>:             for j in range(3):</pre>
<pre class='cython code score-0 '>      for (__pyx_t_6 = 0; __pyx_t_6 &lt; 3; __pyx_t_6+=1) {
        __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">278</span>:                 u[j] = u[j] + t * v[j]</pre>
<pre class='cython code score-0 '>        (__pyx_v_u[__pyx_v_j]) = ((__pyx_v_u[__pyx_v_j]) + (__pyx_v_t * (__pyx_v_v[__pyx_v_j])));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">279</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">280</span>:         # Corner case: every voxel is defined as lower boundary (inclusive) and</pre>
<pre class="cython line score-0">&#xA0;<span class="">281</span>:         # upper boundary (exclusive). Therefore, at the upper end of the voxel</pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>:         # grid an undefined case occurs. If a point lies right at the upper</pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>:         # boundary of the voxel space, "move it" a bit lower on the line</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">284</span>:         if u[0] == xmax or u[1] == ymax or u[2] == zmax:</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (((__pyx_v_u[0]) == __pyx_v_xmax) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L18_bool_binop_done;
    }
    __pyx_t_8 = (((__pyx_v_u[1]) == __pyx_v_ymax) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L18_bool_binop_done;
    }
    __pyx_t_8 = (((__pyx_v_u[2]) == __pyx_v_zmax) != 0);
    __pyx_t_7 = __pyx_t_8;
    __pyx_L18_bool_binop_done:;
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>:             for j in range(3):</pre>
<pre class='cython code score-0 '>      for (__pyx_t_6 = 0; __pyx_t_6 &lt; 3; __pyx_t_6+=1) {
        __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>:                 u[j] = u[j] + 1e-5 * v[j]</pre>
<pre class='cython code score-0 '>        (__pyx_v_u[__pyx_v_j]) = ((__pyx_v_u[__pyx_v_j]) + (1e-5 * (__pyx_v_v[__pyx_v_j])));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">287</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">288</span>:         # If, for dimension x, there are 5 voxels between coordinates 0</pre>
<pre class="cython line score-0">&#xA0;<span class="">289</span>:         # and 5, then the delimiting grid is [0, 1, 2, 3, 4, 5].</pre>
<pre class="cython line score-0">&#xA0;<span class="">290</span>:         # If the line starts at 1.5, then it is part of the voxel at</pre>
<pre class="cython line score-0">&#xA0;<span class="">291</span>:         # index 1.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">292</span>:         ix = &lt;Py_ssize_t&gt;((u[0] - xmin) / gsize_x)</pre>
<pre class='cython code score-0 '>    __pyx_v_ix = ((Py_ssize_t)(((__pyx_v_u[0]) - __pyx_v_xmin) / __pyx_v_gsize_x));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">293</span>:         iy = &lt;Py_ssize_t&gt;((u[1] - ymin) / gsize_y)</pre>
<pre class='cython code score-0 '>    __pyx_v_iy = ((Py_ssize_t)(((__pyx_v_u[1]) - __pyx_v_ymin) / __pyx_v_gsize_y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">294</span>:         iz = &lt;Py_ssize_t&gt;((u[2] - zmin) / gsize_z)</pre>
<pre class='cython code score-0 '>    __pyx_v_iz = ((Py_ssize_t)(((__pyx_v_u[2]) - __pyx_v_zmin) / __pyx_v_gsize_z));
</pre><pre class="cython line score-0">&#xA0;<span class="">295</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>:         # Check the indices are inside the voxel grid - just to be sure</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">297</span>:         if (ix &lt; 0 or ix &gt;= nx or iy &lt; 0 or iy &gt;= ny or iz &lt; 0 or iz &gt;= nz):</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_ix &lt; 0) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_ix &gt;= __pyx_v_nx) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_iy &lt; 0) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_iy &gt;= __pyx_v_ny) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_iz &lt; 0) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_iz &gt;= __pyx_v_nz) != 0);
    __pyx_t_7 = __pyx_t_8;
    __pyx_L24_bool_binop_done:;
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">298</span>:             continue</pre>
<pre class='cython code score-0 '>      goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">299</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>:         # If the line is going "up", the next voxel is the next one</pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>:         # If the line is going "down", the next voxel is the current one</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">302</span>:         if v[0] &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[0]) &gt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L30;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">303</span>:             tnext_x = (grid_x[ix + 1] - u[0]) / v[0]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (__pyx_v_ix + 1);
      __pyx_v_tnext_x = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_2 * __pyx_v_grid_x.strides[0]) ))) - (__pyx_v_u[0])) / (__pyx_v_v[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:         elif v[0] &lt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[0]) &lt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L30;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">305</span>:             tnext_x = (grid_x[ix] - u[0]) / v[0]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_ix;
      __pyx_v_tnext_x = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_2 * __pyx_v_grid_x.strides[0]) ))) - (__pyx_v_u[0])) / (__pyx_v_v[0]));
</pre><pre class="cython line score-0">&#xA0;<span class="">306</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>:             tnext_x = DBL_MAX</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_tnext_x = DBL_MAX;
    }
    __pyx_L30:;
</pre><pre class="cython line score-0">&#xA0;<span class="">308</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">309</span>:         if v[1] &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[1]) &gt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L31;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:             tnext_y = (grid_y[iy + 1] - u[1]) / v[1]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (__pyx_v_iy + 1);
      __pyx_v_tnext_y = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_2 * __pyx_v_grid_y.strides[0]) ))) - (__pyx_v_u[1])) / (__pyx_v_v[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>:         elif v[1] &lt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[1]) &lt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L31;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">312</span>:             tnext_y = (grid_y[iy] - u[1]) / v[1]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_iy;
      __pyx_v_tnext_y = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_2 * __pyx_v_grid_y.strides[0]) ))) - (__pyx_v_u[1])) / (__pyx_v_v[1]));
</pre><pre class="cython line score-0">&#xA0;<span class="">313</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">314</span>:             tnext_y = DBL_MAX</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_tnext_y = DBL_MAX;
    }
    __pyx_L31:;
</pre><pre class="cython line score-0">&#xA0;<span class="">315</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">316</span>:         if v[2] &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[2]) &gt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L32;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">317</span>:             tnext_z = (grid_z[iz + 1] - u[2]) / v[2]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (__pyx_v_iz + 1);
      __pyx_v_tnext_z = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_z.data + __pyx_t_2 * __pyx_v_grid_z.strides[0]) ))) - (__pyx_v_u[2])) / (__pyx_v_v[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>:         elif v[2] &lt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[2]) &lt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L32;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">319</span>:             tnext_z = (grid_z[iz] - u[2]) / v[2]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_iz;
      __pyx_v_tnext_z = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_z.data + __pyx_t_2 * __pyx_v_grid_z.strides[0]) ))) - (__pyx_v_u[2])) / (__pyx_v_v[2]));
</pre><pre class="cython line score-0">&#xA0;<span class="">320</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">321</span>:             tnext_z = DBL_MAX</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_tnext_z = DBL_MAX;
    }
    __pyx_L32:;
</pre><pre class="cython line score-0">&#xA0;<span class="">322</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">323</span>:         deltat_x = fabs(gsize_x / v[0]) if v[0] else 0</pre>
<pre class='cython code score-0 '>    if (((__pyx_v_v[0]) != 0)) {
      __pyx_t_9 = __pyx_f_4pept_9utilities_8traverse_10traverse3d_fabs((__pyx_v_gsize_x / (__pyx_v_v[0])));
    } else {
      __pyx_t_9 = 0.0;
    }
    __pyx_v_deltat_x = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">324</span>:         deltat_y = fabs(gsize_y / v[1]) if v[1] else 0</pre>
<pre class='cython code score-0 '>    if (((__pyx_v_v[1]) != 0)) {
      __pyx_t_9 = __pyx_f_4pept_9utilities_8traverse_10traverse3d_fabs((__pyx_v_gsize_y / (__pyx_v_v[1])));
    } else {
      __pyx_t_9 = 0.0;
    }
    __pyx_v_deltat_y = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>:         deltat_z = fabs(gsize_z / v[2]) if v[2] else 0</pre>
<pre class='cython code score-0 '>    if (((__pyx_v_v[2]) != 0)) {
      __pyx_t_9 = __pyx_f_4pept_9utilities_8traverse_10traverse3d_fabs((__pyx_v_gsize_z / (__pyx_v_v[2])));
    } else {
      __pyx_t_9 = 0.0;
    }
    __pyx_v_deltat_z = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">326</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">327</span>:         ###############################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">328</span>:         # Incremental traversal stage</pre>
<pre class="cython line score-0">&#xA0;<span class="">329</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">330</span>:         # Loop until we reach the last voxel in space</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>:         while (ix &lt; nx and iy &lt; ny and iz &lt; nz) and (ix &gt;= 0 and iy &gt;= 0 and iz &gt;= 0):</pre>
<pre class='cython code score-0 '>    while (1) {
      __pyx_t_8 = ((__pyx_v_ix &lt; __pyx_v_nx) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_7 = __pyx_t_8;
        goto __pyx_L35_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_iy &lt; __pyx_v_ny) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_7 = __pyx_t_8;
        goto __pyx_L35_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_iz &lt; __pyx_v_nz) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_7 = __pyx_t_8;
        goto __pyx_L35_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_ix &gt;= 0) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_7 = __pyx_t_8;
        goto __pyx_L35_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_iy &gt;= 0) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_7 = __pyx_t_8;
        goto __pyx_L35_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_iz &gt;= 0) != 0);
      __pyx_t_7 = __pyx_t_8;
      __pyx_L35_bool_binop_done:;
      if (!__pyx_t_7) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">332</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">333</span>:             voxels[ix, iy, iz] += 1.</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_ix;
      __pyx_t_1 = __pyx_v_iy;
      __pyx_t_10 = __pyx_v_iz;
      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_voxels.data + __pyx_t_2 * __pyx_v_voxels.strides[0]) ) + __pyx_t_1 * __pyx_v_voxels.strides[1]) ) + __pyx_t_10 * __pyx_v_voxels.strides[2]) )) += 1.;
</pre><pre class="cython line score-0">&#xA0;<span class="">334</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">335</span>:             # Select the minimum t that makes the line pass</pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>:             # through to the next voxel</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">337</span>:             if tnext_x &lt; tnext_y:</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = ((__pyx_v_tnext_x &lt; __pyx_v_tnext_y) != 0);
      if (__pyx_t_7) {
/* … */
        goto __pyx_L41;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">338</span>:                 if tnext_x &lt; tnext_z:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = ((__pyx_v_tnext_x &lt; __pyx_v_tnext_z) != 0);
        if (__pyx_t_7) {
/* … */
          goto __pyx_L42;
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">339</span>:                     # If the next voxel falls beyond the end of the line (that is at</pre>
<pre class="cython line score-0">&#xA0;<span class="">340</span>:                     # t = 1), stop the traversal stage</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>:                     if tnext_x &gt; 1.:</pre>
<pre class='cython code score-0 '>          __pyx_t_7 = ((__pyx_v_tnext_x &gt; 1.) != 0);
          if (__pyx_t_7) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">342</span>:                         break</pre>
<pre class='cython code score-0 '>            goto __pyx_L34_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">343</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">344</span>:                     ix = ix + step_x</pre>
<pre class='cython code score-0 '>          __pyx_v_ix = (__pyx_v_ix + __pyx_v_step_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">345</span>:                     tnext_x = tnext_x + deltat_x</pre>
<pre class='cython code score-0 '>          __pyx_v_tnext_x = (__pyx_v_tnext_x + __pyx_v_deltat_x);
</pre><pre class="cython line score-0">&#xA0;<span class="">346</span>:                 else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">347</span>:                     if tnext_z &gt; 1.:</pre>
<pre class='cython code score-0 '>        /*else*/ {
          __pyx_t_7 = ((__pyx_v_tnext_z &gt; 1.) != 0);
          if (__pyx_t_7) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">348</span>:                         break</pre>
<pre class='cython code score-0 '>            goto __pyx_L34_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">349</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">350</span>:                     iz = iz + step_z</pre>
<pre class='cython code score-0 '>          __pyx_v_iz = (__pyx_v_iz + __pyx_v_step_z);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>:                     tnext_z = tnext_z + deltat_z</pre>
<pre class='cython code score-0 '>          __pyx_v_tnext_z = (__pyx_v_tnext_z + __pyx_v_deltat_z);
        }
        __pyx_L42:;
</pre><pre class="cython line score-0">&#xA0;<span class="">352</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">353</span>:                 if tnext_y &lt; tnext_z:</pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_t_7 = ((__pyx_v_tnext_y &lt; __pyx_v_tnext_z) != 0);
        if (__pyx_t_7) {
/* … */
          goto __pyx_L45;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">354</span>:                     if tnext_y &gt; 1.:</pre>
<pre class='cython code score-0 '>          __pyx_t_7 = ((__pyx_v_tnext_y &gt; 1.) != 0);
          if (__pyx_t_7) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">355</span>:                         break</pre>
<pre class='cython code score-0 '>            goto __pyx_L34_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">356</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">357</span>:                     iy = iy + step_y</pre>
<pre class='cython code score-0 '>          __pyx_v_iy = (__pyx_v_iy + __pyx_v_step_y);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">358</span>:                     tnext_y = tnext_y + deltat_y</pre>
<pre class='cython code score-0 '>          __pyx_v_tnext_y = (__pyx_v_tnext_y + __pyx_v_deltat_y);
</pre><pre class="cython line score-0">&#xA0;<span class="">359</span>:                 else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">360</span>:                     if tnext_z &gt; 1.:</pre>
<pre class='cython code score-0 '>        /*else*/ {
          __pyx_t_7 = ((__pyx_v_tnext_z &gt; 1.) != 0);
          if (__pyx_t_7) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">361</span>:                         break</pre>
<pre class='cython code score-0 '>            goto __pyx_L34_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">362</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">363</span>:                     iz = iz + step_z</pre>
<pre class='cython code score-0 '>          __pyx_v_iz = (__pyx_v_iz + __pyx_v_step_z);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">364</span>:                     tnext_z = tnext_z + deltat_z</pre>
<pre class='cython code score-0 '>          __pyx_v_tnext_z = (__pyx_v_tnext_z + __pyx_v_deltat_z);
        }
        __pyx_L45:;
      }
      __pyx_L41:;
    }
    __pyx_L34_break:;
    __pyx_L3_continue:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">365</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">366</span>: </pre>
</div></body></html>
