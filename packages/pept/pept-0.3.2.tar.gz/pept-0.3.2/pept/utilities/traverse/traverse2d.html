<!DOCTYPE html>
<!-- Generated by Cython 0.29.23 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: traverse2d.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.23</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="traverse2d.c">traverse2d.c</a></p>
<div class="cython"><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: # -*- coding: utf-8 -*-</pre>
<pre class='cython code score-13 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_kp_u_traverse2d_line_99, __pyx_kp_u_Fast_pixel_traversal_for_2D_lin) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: #    pept is a Python library that unifies Positron Emission Particle</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: #    Tracking (PEPT) research, including tracking, simulation, data analysis</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: #    and visualisation tools.</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: #    If you used this codebase or any software making use of it in a scientific</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: #    publication, you must cite the following paper:</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: #        Nicuşan AL, Windows-Yule CR. Positron emission particle tracking</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: #        using machine learning. Review of Scientific Instruments.</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: #        2020 Jan 1;91(1):013329.</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: #        https://doi.org/10.1063/1.5129251</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: #    Copyright (C) 2019-2021 the pept developers</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: #    This program is free software: you can redistribute it and/or modify</pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: #    it under the terms of the GNU General Public License as published by</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: #    the Free Software Foundation, either version 3 of the License, or</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: #    (at your option) any later version.</pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: #    This program is distributed in the hope that it will be useful,</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: #    but WITHOUT ANY WARRANTY; without even the implied warranty of</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: #    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: #    GNU General Public License for more details.</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: #    You should have received a copy of the GNU General Public License</pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: #    along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: #    pept is a Python library that unifies Positron Emission Particle</pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: #    Tracking (PEPT) research, including tracking, simulation, data analysis</pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: #    and visualisation tools</pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: # File              : traverse2d.pyx</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: # License           : GNU v3.0</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: # Author            : Andrei Leonard Nicusan &lt;a.l.nicusan@bham.ac.uk&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: # Date              : 03.02.2019</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: # cython: language_level=3</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: # cython: boundscheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: # cython: wraparound=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: # cython: initializedcheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: # cython: nonecheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: # cython: embedsignature=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: # cython: cdivision=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>: from libc.float cimport DBL_MAX</pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>: cdef inline double fabs(double x) nogil:</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE double __pyx_f_4pept_9utilities_8traverse_10traverse2d_fabs(double __pyx_v_x) {
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">053</span>:     return (x if x &gt;= 0 else -x)</pre>
<pre class='cython code score-0 '>  if (((__pyx_v_x &gt;= 0.0) != 0)) {
    __pyx_t_1 = __pyx_v_x;
  } else {
    __pyx_t_1 = (-__pyx_v_x);
  }
  __pyx_r = __pyx_t_1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">054</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>: cdef inline void swap(double *x, double *y) nogil:</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE void __pyx_f_4pept_9utilities_8traverse_10traverse2d_swap(double *__pyx_v_x, double *__pyx_v_y) {
  double __pyx_v_aux;
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0">&#xA0;<span class="">057</span>:     cdef double aux</pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">059</span>:     aux = x[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_aux = (__pyx_v_x[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">060</span>:     x[0] = y[0]</pre>
<pre class='cython code score-0 '>  (__pyx_v_x[0]) = (__pyx_v_y[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">061</span>:     y[0] = aux</pre>
<pre class='cython code score-0 '>  (__pyx_v_y[0]) = __pyx_v_aux;
</pre><pre class="cython line score-0">&#xA0;<span class="">062</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">064</span>: cdef double intersect(</pre>
<pre class='cython code score-0 '>static double __pyx_f_4pept_9utilities_8traverse_10traverse2d_intersect(double *__pyx_v_u, double *__pyx_v_v, double __pyx_v_xmin, double __pyx_v_xmax, double __pyx_v_ymin, double __pyx_v_ymax) {
  double __pyx_v_tmin;
  double __pyx_v_tmax;
  double __pyx_v_tymin;
  double __pyx_v_tymax;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">065</span>:     double[2] u,</pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:     double[2] v,</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>:     double xmin,</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:     double xmax,</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:     double ymin,</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>:     double ymax,</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>: ) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:     '''Given a 2D line defined as L(t) = U + t V and an axis-aligned bounding</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:     box (AABB), find the `t` for which the line intersects the box, if it</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:     exists.</pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:     It is assumed that the line starts *outside* the AABB, so that t == 0.0 is</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:     only reserved for when the line does not intersect the box.</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:     '''</pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:     cdef double tmin, tmax, tymin, tymax</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">082</span>:     tmin = (xmin - u[0]) / v[0]     # Relies on IEEE FP behaviour for div by 0</pre>
<pre class='cython code score-0 '>  __pyx_v_tmin = ((__pyx_v_xmin - (__pyx_v_u[0])) / (__pyx_v_v[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">083</span>:     tmax = (xmax - u[0]) / v[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_tmax = ((__pyx_v_xmax - (__pyx_v_u[0])) / (__pyx_v_v[0]));
</pre><pre class="cython line score-0">&#xA0;<span class="">084</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">085</span>:     tymin = (ymin - u[1]) / v[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_tymin = ((__pyx_v_ymin - (__pyx_v_u[1])) / (__pyx_v_v[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">086</span>:     tymax = (ymax - u[1]) / v[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_tymax = ((__pyx_v_ymax - (__pyx_v_u[1])) / (__pyx_v_v[1]));
</pre><pre class="cython line score-0">&#xA0;<span class="">087</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:     if tmin &gt; tmax: swap(&amp;tmin, &amp;tmax)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tmin &gt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
    __pyx_f_4pept_9utilities_8traverse_10traverse2d_swap((&amp;__pyx_v_tmin), (&amp;__pyx_v_tmax));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:     if tymin &gt; tymax: swap(&amp;tymin, &amp;tymax)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tymin &gt; __pyx_v_tymax) != 0);
  if (__pyx_t_1) {
    __pyx_f_4pept_9utilities_8traverse_10traverse2d_swap((&amp;__pyx_v_tymin), (&amp;__pyx_v_tymax));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">090</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:     if tmin &gt; tymax or tymin &gt; tmax: return 0.0</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_tmin &gt; __pyx_v_tymax) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L6_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tymin &gt; __pyx_v_tmax) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L6_bool_binop_done:;
  if (__pyx_t_1) {
    __pyx_r = 0.0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">092</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>:     if tymin &gt; tmin: tmin = tymin</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tymin &gt; __pyx_v_tmin) != 0);
  if (__pyx_t_1) {
    __pyx_v_tmin = __pyx_v_tymin;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:     if tymax &lt; tmax: tmax = tymax</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tymax &lt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
    __pyx_v_tmax = __pyx_v_tymax;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">095</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:     return tmin</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_tmin;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">097</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">098</span>: </pre>
<pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>: cpdef void traverse2d(</pre>
<pre class='cython code score-48 '>static PyObject *__pyx_pw_4pept_9utilities_8traverse_10traverse2d_1traverse2d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static void __pyx_f_4pept_9utilities_8traverse_10traverse2d_traverse2d(__Pyx_memviewslice __pyx_v_pixels, __Pyx_memviewslice __pyx_v_lines, __Pyx_memviewslice __pyx_v_grid_x, __Pyx_memviewslice __pyx_v_grid_y, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_n_lines;
  Py_ssize_t __pyx_v_nx;
  Py_ssize_t __pyx_v_ny;
  double __pyx_v_gsize_x;
  double __pyx_v_gsize_y;
  double __pyx_v_xmin;
  double __pyx_v_xmax;
  double __pyx_v_ymin;
  double __pyx_v_ymax;
  Py_ssize_t __pyx_v_ix;
  Py_ssize_t __pyx_v_iy;
  double __pyx_v_p1[2];
  double __pyx_v_p2[2];
  double __pyx_v_u[2];
  double __pyx_v_v[2];
  Py_ssize_t __pyx_v_step_x;
  Py_ssize_t __pyx_v_step_y;
  double __pyx_v_tnext_x;
  double __pyx_v_tnext_y;
  double __pyx_v_deltat_x;
  double __pyx_v_deltat_y;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  double __pyx_v_t;
/* … */
  /* function exit code */
}

/* Python wrapper */
static PyObject *__pyx_pw_4pept_9utilities_8traverse_10traverse2d_1traverse2d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4pept_9utilities_8traverse_10traverse2d_traverse2d[] = "traverse2d(double[:, :] pixels, double[:, :] lines, double[:] grid_x, double[:] grid_y) -&gt; void\n Fast pixel traversal for 2D lines (or LoRs).\n\n    ::\n\n        Function Signature:\n            traverse2d(\n                double[:, :] pixels,        # Initialised to zero!\n                double[:, :] lines,         # Has exactly 7 columns!\n                double[:] grid_x,           # Has pixels.shape[0] + 1 elements!\n                double[:] grid_y,           # Has pixels.shape[1] + 1 elements!\n            )\n\n    This function computes the number of lines that passes through each pixel,\n    saving the result in `pixels`. It does so in an efficient manner, in which\n    for every line, only the pixels that it passes through are traversed.\n\n    As it is highly optimised, this function does not perform any checks on the\n    validity of the input data. Please check the parameters before calling\n    `traverse2d`, as it WILL segfault on wrong input data. Details are given\n    below, along with an example call.\n\n    Parameters\n    ----------\n    pixels : numpy.ndarray(dtype = numpy.float64, ndim = 2)\n        The `pixels` parameter is a numpy.ndarray of shape (X, Y) that has been\n        initialised to zeros before the function call. The values will be\n        modified in-place in the function to reflect the number of lines that\n        pass through each pixel.\n\n    lines : numpy.ndarray(dtype = numpy.float64, ndim = 2)\n        The `lines` parameter is a numpy.ndarray of shape(N, 5), where each row\n        is formatted as [time, x1, y1, x2, y2]. Only indices 1:5 will be used\n        as the two points P1 = [x1, y1] and P2 = [x2, y2] defining the line (or\n        LoR).\n\n    grid_x : numpy.ndarray(dtype = numpy.float64, ndim = 1)\n        The grid_x parameter is a one-dimensional grid that delimits the pixels\n        in the x-dimension. It must be *sorted* in ascending order with\n        *equally-spaced* numbers and length X + 1 (pixels.shap""e[0] + 1).\n\n    grid_y : numpy.ndarray(dtype = numpy.float64, ndim = 1)\n        The grid_y parameter is a one-dimensional grid that delimits the pixels\n        in the y-dimension. It must be *sorted* in ascending order with\n        *equally-spaced* numbers and length Y + 1 (pixels.shape[1] + 1).\n\n    Examples\n    --------\n    The input parameters can be easily generated using numpy before calling the\n    function. For example, if a plane of 300 x 400 is split into\n    30 x 40 pixels, a possible code would be:\n\n    &gt;&gt;&gt; import numpy as np\n    &gt;&gt;&gt; from pept.utilities.traverse import traverse2d\n    &gt;&gt;&gt;\n    &gt;&gt;&gt; plane = [300, 400]\n    &gt;&gt;&gt; number_of_pixels = [30, 40]\n    &gt;&gt;&gt; pixels = np.zeros(number_of_pixels)\n\n    The grid has one extra element than the number of pixels. For example, 5\n    pixels between 0 and 5 would be delimited by the grid [0, 1, 2, 3, 4, 5]\n    which has 6 elements (see off-by-one errors - story of my life).\n\n    &gt;&gt;&gt; grid_x = np.linspace(0, plane[0], number_of_pixels[0] + 1)\n    &gt;&gt;&gt; grid_y = np.linspace(0, plane[1], number_of_pixels[1] + 1)\n    &gt;&gt;&gt;\n    &gt;&gt;&gt; random_lines = np.random.random((100, 5)) * 100\n\n    Calling `traverse2d` will modify `pixels` in-place.\n\n    &gt;&gt;&gt; traverse2d(pixels, random_lines, grid_x, grid_y)\n\n    Notes\n    -----\n    This function is an adaptation of a widely-used algorithm [1]_, optimised\n    for PEPT LoRs traversal.\n\n    .. [1] Amanatides J, Woo A. A fast voxel traversal algorithm for ray tracing.\n       InEurographics 1987 Aug 24 (Vol. 87, No. 3, pp. 3-10).\n\n    ";
static PyObject *__pyx_pw_4pept_9utilities_8traverse_10traverse2d_1traverse2d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_pixels = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_lines = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_grid_x = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_grid_y = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("traverse2d (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_pixels,&amp;__pyx_n_s_lines,&amp;__pyx_n_s_grid_x,&amp;__pyx_n_s_grid_y,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pixels)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lines)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse2d", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_grid_x)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse2d", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_grid_y)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse2d", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "traverse2d") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_pixels = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_pixels.memview)) __PYX_ERR(0, 100, __pyx_L3_error)</span>
    __pyx_v_lines = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_lines.memview)) __PYX_ERR(0, 101, __pyx_L3_error)</span>
    __pyx_v_grid_x = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_grid_x.memview)) __PYX_ERR(0, 102, __pyx_L3_error)</span>
    __pyx_v_grid_y = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_grid_y.memview)) __PYX_ERR(0, 103, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("traverse2d", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.utilities.traverse.traverse2d.traverse2d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4pept_9utilities_8traverse_10traverse2d_traverse2d(__pyx_self, __pyx_v_pixels, __pyx_v_lines, __pyx_v_grid_x, __pyx_v_grid_y);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4pept_9utilities_8traverse_10traverse2d_traverse2d(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_pixels, __Pyx_memviewslice __pyx_v_lines, __Pyx_memviewslice __pyx_v_grid_x, __Pyx_memviewslice __pyx_v_grid_y) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("traverse2d", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_4pept_9utilities_8traverse_10traverse2d_traverse2d(__pyx_v_pixels, __pyx_v_lines, __pyx_v_grid_x, __pyx_v_grid_y, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 99, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.utilities.traverse.traverse2d.traverse2d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_pixels, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lines, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_grid_x, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_grid_y, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">100</span>:     double[:, :] pixels,        # Initialised to zero!</pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>:     double[:, :] lines,         # Has exactly 5 columns!</pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>:     double[:] grid_x,           # Has pixels.shape[0] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>:     double[:] grid_y,           # Has pixels.shape[1] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>: ) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>:     ''' Fast pixel traversal for 2D lines (or LoRs).</pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>:     ::</pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>:         Function Signature:</pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>:             traverse2d(</pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>:                 double[:, :] pixels,        # Initialised to zero!</pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>:                 double[:, :] lines,         # Has exactly 7 columns!</pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>:                 double[:] grid_x,           # Has pixels.shape[0] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>:                 double[:] grid_y,           # Has pixels.shape[1] + 1 elements!</pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>:             )</pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:     This function computes the number of lines that passes through each pixel,</pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>:     saving the result in `pixels`. It does so in an efficient manner, in which</pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>:     for every line, only the pixels that it passes through are traversed.</pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>:     As it is highly optimised, this function does not perform any checks on the</pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:     validity of the input data. Please check the parameters before calling</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:     `traverse2d`, as it WILL segfault on wrong input data. Details are given</pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:     below, along with an example call.</pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:     pixels : numpy.ndarray(dtype = numpy.float64, ndim = 2)</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:         The `pixels` parameter is a numpy.ndarray of shape (X, Y) that has been</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:         initialised to zeros before the function call. The values will be</pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:         modified in-place in the function to reflect the number of lines that</pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:         pass through each pixel.</pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>:     lines : numpy.ndarray(dtype = numpy.float64, ndim = 2)</pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>:         The `lines` parameter is a numpy.ndarray of shape(N, 5), where each row</pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>:         is formatted as [time, x1, y1, x2, y2]. Only indices 1:5 will be used</pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>:         as the two points P1 = [x1, y1] and P2 = [x2, y2] defining the line (or</pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>:         LoR).</pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">140</span>:     grid_x : numpy.ndarray(dtype = numpy.float64, ndim = 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">141</span>:         The grid_x parameter is a one-dimensional grid that delimits the pixels</pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>:         in the x-dimension. It must be *sorted* in ascending order with</pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:         *equally-spaced* numbers and length X + 1 (pixels.shape[0] + 1).</pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>:     grid_y : numpy.ndarray(dtype = numpy.float64, ndim = 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>:         The grid_y parameter is a one-dimensional grid that delimits the pixels</pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:         in the y-dimension. It must be *sorted* in ascending order with</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:         *equally-spaced* numbers and length Y + 1 (pixels.shape[1] + 1).</pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:     Examples</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>:     --------</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>:     The input parameters can be easily generated using numpy before calling the</pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:     function. For example, if a plane of 300 x 400 is split into</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:     30 x 40 pixels, a possible code would be:</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:     &gt;&gt;&gt; import numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>:     &gt;&gt;&gt; from pept.utilities.traverse import traverse2d</pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>:     &gt;&gt;&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:     &gt;&gt;&gt; plane = [300, 400]</pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>:     &gt;&gt;&gt; number_of_pixels = [30, 40]</pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>:     &gt;&gt;&gt; pixels = np.zeros(number_of_pixels)</pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>:     The grid has one extra element than the number of pixels. For example, 5</pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>:     pixels between 0 and 5 would be delimited by the grid [0, 1, 2, 3, 4, 5]</pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>:     which has 6 elements (see off-by-one errors - story of my life).</pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>:     &gt;&gt;&gt; grid_x = np.linspace(0, plane[0], number_of_pixels[0] + 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">168</span>:     &gt;&gt;&gt; grid_y = np.linspace(0, plane[1], number_of_pixels[1] + 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">169</span>:     &gt;&gt;&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">170</span>:     &gt;&gt;&gt; random_lines = np.random.random((100, 5)) * 100</pre>
<pre class="cython line score-0">&#xA0;<span class="">171</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>:     Calling `traverse2d` will modify `pixels` in-place.</pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>:     &gt;&gt;&gt; traverse2d(pixels, random_lines, grid_x, grid_y)</pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>:     Notes</pre>
<pre class="cython line score-0">&#xA0;<span class="">177</span>:     -----</pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>:     This function is an adaptation of a widely-used algorithm [1]_, optimised</pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>:     for PEPT LoRs traversal.</pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>:     .. [1] Amanatides J, Woo A. A fast voxel traversal algorithm for ray tracing.</pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:        InEurographics 1987 Aug 24 (Vol. 87, No. 3, pp. 3-10).</pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>:     '''</pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">186</span>:     n_lines = lines.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_n_lines = (__pyx_v_lines.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">187</span>:     cdef Py_ssize_t nx = pixels.shape[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_nx = (__pyx_v_pixels.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>:     cdef Py_ssize_t ny = pixels.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_ny = (__pyx_v_pixels.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">189</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">190</span>:     # Grid size</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>:     cdef double gsize_x = grid_x[1] - grid_x[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 1;
  __pyx_t_2 = 0;
  __pyx_v_gsize_x = ((*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_1 * __pyx_v_grid_x.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_2 * __pyx_v_grid_x.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">192</span>:     cdef double gsize_y = grid_y[1] - grid_y[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = 1;
  __pyx_t_1 = 0;
  __pyx_v_gsize_y = ((*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_2 * __pyx_v_grid_y.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_1 * __pyx_v_grid_y.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">193</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">194</span>:     # Delimiting grid</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:     cdef double xmin = grid_x[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_v_xmin = (*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_1 * __pyx_v_grid_x.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:     cdef double xmax = grid_x[nx]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_nx;
  __pyx_v_xmax = (*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_1 * __pyx_v_grid_x.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">197</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:     cdef double ymin = grid_y[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_v_ymin = (*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_1 * __pyx_v_grid_y.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">199</span>:     cdef double ymax = grid_y[ny]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_ny;
  __pyx_v_ymax = (*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_1 * __pyx_v_grid_y.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">200</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>:     # The current pixel indices [ix, iy] that the line passes</pre>
<pre class="cython line score-0">&#xA0;<span class="">202</span>:     # through.</pre>
<pre class="cython line score-0">&#xA0;<span class="">203</span>:     cdef Py_ssize_t ix, iy</pre>
<pre class="cython line score-0">&#xA0;<span class="">204</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">205</span>:     # Define a line as L(t) = U + t V</pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>:     # If an LoR is defined as two points P1 and P2, then</pre>
<pre class="cython line score-0">&#xA0;<span class="">207</span>:     # U = P1 and V = P2 - P1</pre>
<pre class="cython line score-0">&#xA0;<span class="">208</span>:     cdef double[2] p1, p2, u, v</pre>
<pre class="cython line score-0">&#xA0;<span class="">209</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">210</span>:     # The step [step_x, step_y, step_z] defines the sense of the LoR.</pre>
<pre class="cython line score-0">&#xA0;<span class="">211</span>:     # If V[0] is positive, then step_x = 1</pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>:     # If V[0] is negative, then step_x = -1</pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>:     cdef Py_ssize_t step_x, step_y</pre>
<pre class="cython line score-0">&#xA0;<span class="">214</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>:     # The value of t at which the line passes through to the next</pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>:     # pixel, for each dimension.</pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>:     cdef double tnext_x, tnext_y</pre>
<pre class="cython line score-0">&#xA0;<span class="">218</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>:     # deltat indicates how far along the ray we must move (in units of</pre>
<pre class="cython line score-0">&#xA0;<span class="">220</span>:     # t) for each component to be equal to the size of the pixel in</pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>:     # that dimension.</pre>
<pre class="cython line score-0">&#xA0;<span class="">222</span>:     cdef double deltat_x, deltat_y</pre>
<pre class="cython line score-0">&#xA0;<span class="">223</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">224</span>:     cdef Py_ssize_t i, j</pre>
<pre class="cython line score-0">&#xA0;<span class="">225</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">226</span>:     for i in range(n_lines):</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_n_lines;
  __pyx_t_4 = __pyx_t_3;
  for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_i = __pyx_t_5;
</pre><pre class="cython line score-0">&#xA0;<span class="">227</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">228</span>:         for j in range(2):</pre>
<pre class='cython code score-0 '>    for (__pyx_t_6 = 0; __pyx_t_6 &lt; 2; __pyx_t_6+=1) {
      __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">229</span>:             p1[j] = lines[i, 1 + j]</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = __pyx_v_i;
      __pyx_t_2 = (1 + __pyx_v_j);
      (__pyx_v_p1[__pyx_v_j]) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_lines.data + __pyx_t_1 * __pyx_v_lines.strides[0]) ) + __pyx_t_2 * __pyx_v_lines.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">230</span>:             p2[j] = lines[i, 3 + j]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_i;
      __pyx_t_1 = (3 + __pyx_v_j);
      (__pyx_v_p2[__pyx_v_j]) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_lines.data + __pyx_t_2 * __pyx_v_lines.strides[0]) ) + __pyx_t_1 * __pyx_v_lines.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">231</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">232</span>:             u[j] = p1[j]</pre>
<pre class='cython code score-0 '>      (__pyx_v_u[__pyx_v_j]) = (__pyx_v_p1[__pyx_v_j]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:             v[j] = p2[j] - p1[j]</pre>
<pre class='cython code score-0 '>      (__pyx_v_v[__pyx_v_j]) = ((__pyx_v_p2[__pyx_v_j]) - (__pyx_v_p1[__pyx_v_j]));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">234</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>:         ##############################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>:         # Initialisation stage</pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:         step_x = 1 if v[0] &gt;= 0 else -1</pre>
<pre class='cython code score-0 '>    if ((((__pyx_v_v[0]) &gt;= 0.0) != 0)) {
      __pyx_t_6 = 1;
    } else {
      __pyx_t_6 = -1L;
    }
    __pyx_v_step_x = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">239</span>:         step_y = 1 if v[1] &gt;= 0 else -1</pre>
<pre class='cython code score-0 '>    if ((((__pyx_v_v[1]) &gt;= 0.0) != 0)) {
      __pyx_t_6 = 1;
    } else {
      __pyx_t_6 = -1L;
    }
    __pyx_v_step_y = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">240</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>:         # If the first point is outside the box, find the first pixel it hits</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>:         if (u[0] &lt; xmin or u[0] &gt; xmax or</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (((__pyx_v_u[0]) &lt; __pyx_v_xmin) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_8 = (((__pyx_v_u[0]) &gt; __pyx_v_xmax) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
/* … */
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>:                 u[1] &lt; ymin or u[1] &gt; ymax):</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (((__pyx_v_u[1]) &lt; __pyx_v_ymin) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_8 = (((__pyx_v_u[1]) &gt; __pyx_v_ymax) != 0);
    __pyx_t_7 = __pyx_t_8;
    __pyx_L8_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">244</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>:             t = intersect(u, v, xmin, xmax, ymin, ymax)</pre>
<pre class='cython code score-0 '>      __pyx_v_t = __pyx_f_4pept_9utilities_8traverse_10traverse2d_intersect(__pyx_v_u, __pyx_v_v, __pyx_v_xmin, __pyx_v_xmax, __pyx_v_ymin, __pyx_v_ymax);
</pre><pre class="cython line score-0">&#xA0;<span class="">246</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">247</span>:             # No intersection</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>:             if t == 0.0:</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = ((__pyx_v_t == 0.0) != 0);
      if (__pyx_t_7) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>:                 continue</pre>
<pre class='cython code score-0 '>        goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">250</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>:             # Overwrite U to correspond to the first intersection point</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">252</span>:             for j in range(2):</pre>
<pre class='cython code score-0 '>      for (__pyx_t_6 = 0; __pyx_t_6 &lt; 2; __pyx_t_6+=1) {
        __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">253</span>:                 u[j] = u[j] + t * v[j]</pre>
<pre class='cython code score-0 '>        (__pyx_v_u[__pyx_v_j]) = ((__pyx_v_u[__pyx_v_j]) + (__pyx_v_t * (__pyx_v_v[__pyx_v_j])));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">254</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>:         # Corner case: every pixel is defined as lower boundary (inclusive) and</pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>:         # upper boundary (exclusive). Therefore, at the upper end of the pixel</pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>:         # grid an undefined case occurs. If a point lies right at the upper</pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>:         # boundary of the pixel space, "move it" a bit lower on the line</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>:         if u[0] == xmax or u[1] == ymax:</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (((__pyx_v_u[0]) == __pyx_v_xmax) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_8 = (((__pyx_v_u[1]) == __pyx_v_ymax) != 0);
    __pyx_t_7 = __pyx_t_8;
    __pyx_L16_bool_binop_done:;
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">260</span>:             for j in range(2):</pre>
<pre class='cython code score-0 '>      for (__pyx_t_6 = 0; __pyx_t_6 &lt; 2; __pyx_t_6+=1) {
        __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">261</span>:                 u[j] = u[j] + 1e-5 * v[j]</pre>
<pre class='cython code score-0 '>        (__pyx_v_u[__pyx_v_j]) = ((__pyx_v_u[__pyx_v_j]) + (1e-5 * (__pyx_v_v[__pyx_v_j])));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">262</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">263</span>:         # If, for dimension x, there are 5 pixels between coordinates 0</pre>
<pre class="cython line score-0">&#xA0;<span class="">264</span>:         # and 5, then the delimiting grid is [0, 1, 2, 3, 4, 5].</pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>:         # If the line starts at 1.5, then it is part of the pixel at</pre>
<pre class="cython line score-0">&#xA0;<span class="">266</span>:         # index 1</pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">268</span>:         ix = &lt;int&gt;(u[0] / gsize_x)</pre>
<pre class='cython code score-0 '>    __pyx_v_ix = ((int)((__pyx_v_u[0]) / __pyx_v_gsize_x));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">269</span>:         iy = &lt;int&gt;(u[1] / gsize_y)</pre>
<pre class='cython code score-0 '>    __pyx_v_iy = ((int)((__pyx_v_u[1]) / __pyx_v_gsize_y));
</pre><pre class="cython line score-0">&#xA0;<span class="">270</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>:         # Check the indices are inside the pixel grid</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">272</span>:         if (ix &lt; 0 or ix &gt;= nx or iy &lt; 0 or iy &gt;= ny):</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_ix &lt; 0) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L21_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_ix &gt;= __pyx_v_nx) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L21_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_iy &lt; 0) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_7 = __pyx_t_8;
      goto __pyx_L21_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_iy &gt;= __pyx_v_ny) != 0);
    __pyx_t_7 = __pyx_t_8;
    __pyx_L21_bool_binop_done:;
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">273</span>:             continue</pre>
<pre class='cython code score-0 '>      goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">274</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>:         # If the line is going "up", the next pixel is the next one</pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>:         # If the line is going "down", the next pixel is the current one</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>:         if v[0] &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[0]) &gt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L25;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">278</span>:             tnext_x = (grid_x[ix + 1] - u[0]) / v[0]</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = (__pyx_v_ix + 1);
      __pyx_v_tnext_x = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_1 * __pyx_v_grid_x.strides[0]) ))) - (__pyx_v_u[0])) / (__pyx_v_v[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">279</span>:         elif v[0] &lt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[0]) &lt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L25;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>:             tnext_x = (grid_x[ix] - u[0]) / v[0]</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = __pyx_v_ix;
      __pyx_v_tnext_x = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_1 * __pyx_v_grid_x.strides[0]) ))) - (__pyx_v_u[0])) / (__pyx_v_v[0]));
</pre><pre class="cython line score-0">&#xA0;<span class="">281</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">282</span>:             tnext_x = DBL_MAX</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_tnext_x = DBL_MAX;
    }
    __pyx_L25:;
</pre><pre class="cython line score-0">&#xA0;<span class="">283</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">284</span>:         if v[1] &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[1]) &gt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L26;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>:             tnext_y = (grid_y[iy + 1] - u[1]) / v[1]</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = (__pyx_v_iy + 1);
      __pyx_v_tnext_y = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_1 * __pyx_v_grid_y.strides[0]) ))) - (__pyx_v_u[1])) / (__pyx_v_v[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>:         elif v[1] &lt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (((__pyx_v_v[1]) &lt; 0.0) != 0);
    if (__pyx_t_7) {
/* … */
      goto __pyx_L26;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">287</span>:             tnext_y = (grid_y[iy] - u[1]) / v[1]</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = __pyx_v_iy;
      __pyx_v_tnext_y = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_1 * __pyx_v_grid_y.strides[0]) ))) - (__pyx_v_u[1])) / (__pyx_v_v[1]));
</pre><pre class="cython line score-0">&#xA0;<span class="">288</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">289</span>:             tnext_y = DBL_MAX</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_tnext_y = DBL_MAX;
    }
    __pyx_L26:;
</pre><pre class="cython line score-0">&#xA0;<span class="">290</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">291</span>:         deltat_x = fabs((grid_x[1] - grid_x[0]) / v[0]) if v[0] else 0</pre>
<pre class='cython code score-0 '>    if (((__pyx_v_v[0]) != 0)) {
      __pyx_t_1 = 1;
      __pyx_t_2 = 0;
      __pyx_t_9 = __pyx_f_4pept_9utilities_8traverse_10traverse2d_fabs((((*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_1 * __pyx_v_grid_x.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_grid_x.data + __pyx_t_2 * __pyx_v_grid_x.strides[0]) )))) / (__pyx_v_v[0])));
    } else {
      __pyx_t_9 = 0.0;
    }
    __pyx_v_deltat_x = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">292</span>:         deltat_y = fabs((grid_y[1] - grid_y[0]) / v[1]) if v[1] else 0</pre>
<pre class='cython code score-0 '>    if (((__pyx_v_v[1]) != 0)) {
      __pyx_t_2 = 1;
      __pyx_t_1 = 0;
      __pyx_t_9 = __pyx_f_4pept_9utilities_8traverse_10traverse2d_fabs((((*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_2 * __pyx_v_grid_y.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_grid_y.data + __pyx_t_1 * __pyx_v_grid_y.strides[0]) )))) / (__pyx_v_v[1])));
    } else {
      __pyx_t_9 = 0.0;
    }
    __pyx_v_deltat_y = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">293</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>:         ###############################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">295</span>:         # Incremental traversal stage</pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>:         # Loop until we reach the last pixel in space</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">298</span>:         while (ix &lt; nx and iy &lt; ny) and (ix &gt;= 0 and iy &gt;= 0):</pre>
<pre class='cython code score-0 '>    while (1) {
      __pyx_t_8 = ((__pyx_v_ix &lt; __pyx_v_nx) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_7 = __pyx_t_8;
        goto __pyx_L29_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_iy &lt; __pyx_v_ny) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_7 = __pyx_t_8;
        goto __pyx_L29_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_ix &gt;= 0) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_7 = __pyx_t_8;
        goto __pyx_L29_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_iy &gt;= 0) != 0);
      __pyx_t_7 = __pyx_t_8;
      __pyx_L29_bool_binop_done:;
      if (!__pyx_t_7) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">299</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">300</span>:             pixels[ix, iy] += 1</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = __pyx_v_ix;
      __pyx_t_2 = __pyx_v_iy;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_pixels.data + __pyx_t_1 * __pyx_v_pixels.strides[0]) ) + __pyx_t_2 * __pyx_v_pixels.strides[1]) )) += 1.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">301</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">302</span>:             # Select the minimum t that makes the line pass</pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>:             # through to the next pixel</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:             if tnext_x &lt; tnext_y:</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = ((__pyx_v_tnext_x &lt; __pyx_v_tnext_y) != 0);
      if (__pyx_t_7) {
/* … */
        goto __pyx_L33;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">305</span>:                 # If the next pixel falls beyond the end of the line (that is</pre>
<pre class="cython line score-0">&#xA0;<span class="">306</span>:                 # at t = 1), then stop the traversal stage</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>:                 if tnext_x &gt; 1.:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = ((__pyx_v_tnext_x &gt; 1.) != 0);
        if (__pyx_t_7) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>:                     break</pre>
<pre class='cython code score-0 '>          goto __pyx_L28_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">309</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:                 ix = ix + step_x</pre>
<pre class='cython code score-0 '>        __pyx_v_ix = (__pyx_v_ix + __pyx_v_step_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>:                 tnext_x = tnext_x + deltat_x</pre>
<pre class='cython code score-0 '>        __pyx_v_tnext_x = (__pyx_v_tnext_x + __pyx_v_deltat_x);
</pre><pre class="cython line score-0">&#xA0;<span class="">312</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">313</span>:                 if tnext_y &gt; 1.:</pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_t_7 = ((__pyx_v_tnext_y &gt; 1.) != 0);
        if (__pyx_t_7) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">314</span>:                     break</pre>
<pre class='cython code score-0 '>          goto __pyx_L28_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">315</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">316</span>:                 iy = iy + step_y</pre>
<pre class='cython code score-0 '>        __pyx_v_iy = (__pyx_v_iy + __pyx_v_step_y);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">317</span>:                 tnext_y = tnext_y + deltat_y</pre>
<pre class='cython code score-0 '>        __pyx_v_tnext_y = (__pyx_v_tnext_y + __pyx_v_deltat_y);
      }
      __pyx_L33:;
    }
    __pyx_L28_break:;
    __pyx_L3_continue:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">318</span>: </pre>
</div></body></html>
