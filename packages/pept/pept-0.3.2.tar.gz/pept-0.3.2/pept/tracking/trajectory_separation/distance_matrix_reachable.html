<!DOCTYPE html>
<!-- Generated by Cython 0.29.23 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: distance_matrix_reachable.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.23</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="distance_matrix_reachable.c">distance_matrix_reachable.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: # -*- coding: utf-8 -*-</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: #    pept is a Python library that unifies Positron Emission Particle</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: #    Tracking (PEPT) research, including tracking, simulation, data analysis</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: #    and visualisation tools.</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: #    If you used this codebase or any software making use of it in a scientific</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: #    publication, you must cite the following paper:</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: #        Nicuşan AL, Windows-Yule CR. Positron emission particle tracking</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: #        using machine learning. Review of Scientific Instruments.</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: #        2020 Jan 1;91(1):013329.</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: #        https://doi.org/10.1063/1.5129251</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: #    Copyright (C) 2019-2021 the pept developers</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: #    This program is free software: you can redistribute it and/or modify</pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: #    it under the terms of the GNU General Public License as published by</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: #    the Free Software Foundation, either version 3 of the License, or</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: #    (at your option) any later version.</pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: #    This program is distributed in the hope that it will be useful,</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: #    but WITHOUT ANY WARRANTY; without even the implied warranty of</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: #    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: #    GNU General Public License for more details.</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: #    You should have received a copy of the GNU General Public License</pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: #    along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: #    pept is a Python library that unifies Positron Emission Particle</pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: #    Tracking (PEPT) research, including tracking, simulation, data analysis</pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: #    and visualisation tools</pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: # File              : distance_matrix_reachable.pyx</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: # License           : GNU v3.0</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: # Author            : Andrei Leonard Nicusan &lt;a.l.nicusan@bham.ac.uk&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: # Date              : 10.06.2020</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: # cython: language_level=3</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: # cython: boundscheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: # cython: wraparound=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: # cython: initializedcheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: # cython: nonecheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: # cython: embedsignature=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: # cython: cdivision=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>: import numpy as np</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">050</span>: from scipy.sparse import csr_matrix</pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 50, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_csr_matrix);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_csr_matrix);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_csr_matrix);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_sparse, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 50, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_csr_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 50, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_csr_matrix, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 50, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">051</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>: from libc.float cimport DBL_MIN</pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>: from libc.math cimport sqrt</pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: cimport numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: </pre>
<pre class="cython line score-65" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">057</span>: cpdef distance_matrix_reachable(</pre>
<pre class='cython code score-65 '>static PyObject *__pyx_pw_4pept_8tracking_21trajectory_separation_25distance_matrix_reachable_1distance_matrix_reachable(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4pept_8tracking_21trajectory_separation_25distance_matrix_reachable_distance_matrix_reachable(__Pyx_memviewslice __pyx_v_pts, int __pyx_v_points_window, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_n;
  Py_ssize_t __pyx_v_p;
  Py_ssize_t __pyx_v_ndists;
  PyArrayObject *__pyx_v_dists_arr = 0;
  PyArrayObject *__pyx_v_rows_arr = 0;
  PyArrayObject *__pyx_v_cols_arr = 0;
  __Pyx_memviewslice __pyx_v_dists = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_rows = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_cols = { 0, 0, { 0 }, { 0 }, { 0 } };
  Py_ssize_t __pyx_v_ie;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  double __pyx_v_dist;
  PyObject *__pyx_v_distance_matrix = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_cols_arr;
  __Pyx_Buffer __pyx_pybuffer_cols_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dists_arr;
  __Pyx_Buffer __pyx_pybuffer_dists_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_rows_arr;
  __Pyx_Buffer __pyx_pybuffer_rows_arr;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("distance_matrix_reachable", 0);
  __pyx_pybuffer_dists_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_dists_arr.refcount = 0;
  __pyx_pybuffernd_dists_arr.data = NULL;
  __pyx_pybuffernd_dists_arr.rcbuffer = &amp;__pyx_pybuffer_dists_arr;
  __pyx_pybuffer_rows_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_rows_arr.refcount = 0;
  __pyx_pybuffernd_rows_arr.data = NULL;
  __pyx_pybuffernd_rows_arr.rcbuffer = &amp;__pyx_pybuffer_rows_arr;
  __pyx_pybuffer_cols_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_cols_arr.refcount = 0;
  __pyx_pybuffernd_cols_arr.data = NULL;
  __pyx_pybuffernd_cols_arr.rcbuffer = &amp;__pyx_pybuffer_cols_arr;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_30);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cols_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dists_arr.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rows_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.tracking.trajectory_separation.distance_matrix_reachable.distance_matrix_reachable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_cols_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_dists_arr.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_rows_arr.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_dists_arr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_rows_arr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_cols_arr);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_dists, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_rows, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cols, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_distance_matrix);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_4pept_8tracking_21trajectory_separation_25distance_matrix_reachable_1distance_matrix_reachable(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4pept_8tracking_21trajectory_separation_25distance_matrix_reachable_distance_matrix_reachable[] = "distance_matrix_reachable(double[:, :] pts, int points_window)\nCompute the distance matrix from a time-sorted array of points `pts`\n    based on a sliding `points_window`.\n\n    ::\n\n        Function signature:\n            distance_matrix_reachable(\n                double[:, :] pts,   # Array of points, cols = [t, x, y, z, ...]\n                int points_window\n            )\n\n    The distance between the points (pts[i], pts[j]) is stored in the distance\n    matrix at indices (i, j), making it upper-triangular.\n\n    The distance matrix is created and returned using SciPy's sparse CSR\n    matrix format. This saves a lot in terms of memory usage, especially for\n    time-series data such as moving tracers, as not all points can be\n    connected. This format is also closer to the mathematical formulation of\n    \"reachable points\" in terms of undirected (incomplete) graphs - namely\n    storing edges as a list of pairs of vertices.\n\n    This is a low-level Cython function that does not do any checks on the\n    input data - it is meant to be used in other modules / libraries; in\n    particular, the `pept.tracking.trajectory_separation` module.\n\n    Parameters\n    ----------\n    pts : (M, N&gt;=4) numpy.ndarray\n        The points from multiple trajectories. Each row in `pts` will\n        have a timestamp and the 3 spatial coordinates, such that the data\n        columns are [time, x_coord, y_coord, z_coord]. Note that `point_data`\n        can have more data columns and they will simply be ignored.\n    points_window : int\n        Two points are \"reachable\" (i.e. they can be connected) if and only if\n        they are within `points_window` in the time-sorted input `pts`. As the\n        points from different trajectories are intertwined (e.g. for two\n        tracers A and B, the `pts` array might have two entries for A,\n        followed by three entries for B, then one entry for A, etc.), this\n        should optimally be the largest number o""f points in the input array\n        between two consecutive points on the same trajectory. If\n        `pts` is too small, all points in the dataset will be unreachable.\n        Naturally, a larger `time_window` correponds to more pairs needing to\n        be checked (and the function will take a longer to complete).\n\n    Returns\n    -------\n    distance_matrix : CSR &lt;NxN sparse matrix of type '&lt;class 'numpy.float64'&gt;\n        A SciPy sparse matrix in the CSR format, containing the distances\n        between every pair of reachable points in `pts`.\n\n    Notes\n    -----\n    In order for the `points_window` to act as a sliding window, in effect only\n    connecting points which are around the same timeframe, the points should be\n    sorted based on thetime column (the first row) in `pts`. This should be\n    done *prior* to calling this function.\n    ";
static PyObject *__pyx_pw_4pept_8tracking_21trajectory_separation_25distance_matrix_reachable_1distance_matrix_reachable(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_pts = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_points_window;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("distance_matrix_reachable (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_pts,&amp;__pyx_n_s_points_window,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_pts)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_points_window)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("distance_matrix_reachable", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "distance_matrix_reachable") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_pts = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_pts.memview)) __PYX_ERR(0, 58, __pyx_L3_error)</span>
    __pyx_v_points_window = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]); if (unlikely((__pyx_v_points_window == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 59, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("distance_matrix_reachable", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.tracking.trajectory_separation.distance_matrix_reachable.distance_matrix_reachable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4pept_8tracking_21trajectory_separation_25distance_matrix_reachable_distance_matrix_reachable(__pyx_self, __pyx_v_pts, __pyx_v_points_window);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4pept_8tracking_21trajectory_separation_25distance_matrix_reachable_distance_matrix_reachable(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_pts, int __pyx_v_points_window) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("distance_matrix_reachable", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_4pept_8tracking_21trajectory_separation_25distance_matrix_reachable_distance_matrix_reachable(__pyx_v_pts, __pyx_v_points_window, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.tracking.trajectory_separation.distance_matrix_reachable.distance_matrix_reachable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_pts, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">058</span>:     double[:, :] pts,           # Array of points, cols = [t, x, y, z, ...]</pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>:     int points_window</pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>: ):</pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>:     '''Compute the distance matrix from a time-sorted array of points `pts`</pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>:     based on a sliding `points_window`.</pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>:     ::</pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:         Function signature:</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>:             distance_matrix_reachable(</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:                 double[:, :] pts,   # Array of points, cols = [t, x, y, z, ...]</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:                 int points_window</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>:             )</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:     The distance between the points (pts[i], pts[j]) is stored in the distance</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:     matrix at indices (i, j), making it upper-triangular.</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:     The distance matrix is created and returned using SciPy's sparse CSR</pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:     matrix format. This saves a lot in terms of memory usage, especially for</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:     time-series data such as moving tracers, as not all points can be</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:     connected. This format is also closer to the mathematical formulation of</pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:     "reachable points" in terms of undirected (incomplete) graphs - namely</pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:     storing edges as a list of pairs of vertices.</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:     This is a low-level Cython function that does not do any checks on the</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>:     input data - it is meant to be used in other modules / libraries; in</pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>:     particular, the `pept.tracking.trajectory_separation` module.</pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:     pts : (M, N&gt;=4) numpy.ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>:         The points from multiple trajectories. Each row in `pts` will</pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>:         have a timestamp and the 3 spatial coordinates, such that the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>:         columns are [time, x_coord, y_coord, z_coord]. Note that `point_data`</pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>:         can have more data columns and they will simply be ignored.</pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>:     points_window : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>:         Two points are "reachable" (i.e. they can be connected) if and only if</pre>
<pre class="cython line score-0">&#xA0;<span class="">095</span>:         they are within `points_window` in the time-sorted input `pts`. As the</pre>
<pre class="cython line score-0">&#xA0;<span class="">096</span>:         points from different trajectories are intertwined (e.g. for two</pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>:         tracers A and B, the `pts` array might have two entries for A,</pre>
<pre class="cython line score-0">&#xA0;<span class="">098</span>:         followed by three entries for B, then one entry for A, etc.), this</pre>
<pre class="cython line score-0">&#xA0;<span class="">099</span>:         should optimally be the largest number of points in the input array</pre>
<pre class="cython line score-0">&#xA0;<span class="">100</span>:         between two consecutive points on the same trajectory. If</pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>:         `pts` is too small, all points in the dataset will be unreachable.</pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>:         Naturally, a larger `time_window` correponds to more pairs needing to</pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>:         be checked (and the function will take a longer to complete).</pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>:     distance_matrix : CSR &lt;NxN sparse matrix of type '&lt;class 'numpy.float64'&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>:         A SciPy sparse matrix in the CSR format, containing the distances</pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>:         between every pair of reachable points in `pts`.</pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>:     Notes</pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>:     -----</pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>:     In order for the `points_window` to act as a sliding window, in effect only</pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>:     connecting points which are around the same timeframe, the points should be</pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>:     sorted based on thetime column (the first row) in `pts`. This should be</pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>:     done *prior* to calling this function.</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:     '''</pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>:     # Use Py_ssize_t as we will access C arrays (memoryviews on numpy arrays).</pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>:     # That is the "proper" type of a C array pointer / index.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>:     cdef Py_ssize_t n = pts.shape[0]            # Total number of points</pre>
<pre class='cython code score-0 '>  __pyx_v_n = (__pyx_v_pts.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">122</span>:     cdef Py_ssize_t p = min(n, points_window)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_points_window;
  __pyx_t_2 = __pyx_v_n;
  if (((__pyx_t_1 &lt; __pyx_t_2) != 0)) {
    __pyx_t_3 = __pyx_t_1;
  } else {
    __pyx_t_3 = __pyx_t_2;
  }
  __pyx_v_p = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">123</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:     # Calculate sparse distance matrix between reachable points. The number of</pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:     # points we need to check `ndists` is given by the formula below.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">126</span>:     cdef Py_ssize_t ndists = (p + 1) * (n - p) + p * (p + 1) // 2 - n</pre>
<pre class='cython code score-0 '>  __pyx_v_ndists = ((((__pyx_v_p + 1) * (__pyx_v_n - __pyx_v_p)) + ((__pyx_v_p * (__pyx_v_p + 1)) / 2)) - __pyx_v_n);
</pre><pre class="cython line score-0">&#xA0;<span class="">127</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:     # Pre-allocate the arrays for creating the sparse distance matrix. In the</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:     # sparse matrix, every data point `dists` has an associated row in `rows`</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:     # column in `cols`.</pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">131</span>:     cdef np.ndarray[double, ndim = 1] dists_arr = np.zeros(ndists, dtype =</pre>
<pre class='cython code score-28 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 131, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 131, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_ndists);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 131, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 131, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 131, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
/* … */
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_6, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 131, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_8) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_8, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 131, __pyx_L1_error)</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_8);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_dists_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_dists_arr = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_dists_arr.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 131, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_dists_arr.diminfo[0].strides = __pyx_pybuffernd_dists_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_dists_arr.diminfo[0].shape = __pyx_pybuffernd_dists_arr.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_dists_arr = ((PyArrayObject *)__pyx_t_8);
  __pyx_t_8 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">132</span>:                                                            np.float64)</pre>
<pre class='cython code score-11 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 132, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_8) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 131, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>:     cdef np.ndarray[double, ndim = 1] rows_arr = np.zeros(ndists, dtype =</pre>
<pre class='cython code score-28 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_ndists);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_8);
  __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_6, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_7);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_rows_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_rows_arr = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_rows_arr.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_rows_arr.diminfo[0].strides = __pyx_pybuffernd_rows_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_rows_arr.diminfo[0].shape = __pyx_pybuffernd_rows_arr.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_rows_arr = ((PyArrayObject *)__pyx_t_7);
  __pyx_t_7 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:                                                           np.float64)</pre>
<pre class='cython code score-11 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, __pyx_n_s_dtype, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">135</span>:     cdef np.ndarray[double, ndim = 1] cols_arr = np.zeros(ndists, dtype =</pre>
<pre class='cython code score-28 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_ndists);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_6, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 135, __pyx_L1_error)</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_cols_arr.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_cols_arr = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_cols_arr.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 135, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_cols_arr.diminfo[0].strides = __pyx_pybuffernd_cols_arr.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_cols_arr.diminfo[0].shape = __pyx_pybuffernd_cols_arr.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_11 = 0;
  __pyx_v_cols_arr = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">136</span>:                                                           np.float64)</pre>
<pre class='cython code score-11 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 136, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 135, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">137</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>:     # We'll work with memoryviews on the above arrays:</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:     cdef double[:] dists = dists_arr</pre>
<pre class='cython code score-2 '>  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_dists_arr), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  __pyx_v_dists = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:     cdef double[:] rows = rows_arr</pre>
<pre class='cython code score-2 '>  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_rows_arr), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  __pyx_v_rows = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>:     cdef double[:] cols = cols_arr</pre>
<pre class='cython code score-2 '>  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_cols_arr), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
  __pyx_v_cols = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">142</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:     # Calculate the distances between reachable points.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">144</span>:     cdef Py_ssize_t ie = 0  # distance index</pre>
<pre class='cython code score-0 '>  __pyx_v_ie = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">145</span>:     cdef Py_ssize_t i, j    # iterators</pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>:     cdef double dist        # distance between two points</pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">148</span>:     with nogil:</pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>:         for i in range(n - 1):</pre>
<pre class='cython code score-0 '>        __pyx_t_3 = (__pyx_v_n - 1);
        __pyx_t_2 = __pyx_t_3;
        for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_2; __pyx_t_13+=1) {
          __pyx_v_i = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>:             for j in range(i + 1, min(i + p, n - 1) + 1):</pre>
<pre class='cython code score-0 '>          __pyx_t_14 = (__pyx_v_n - 1);
          __pyx_t_15 = (__pyx_v_i + __pyx_v_p);
          if (((__pyx_t_14 &lt; __pyx_t_15) != 0)) {
            __pyx_t_16 = __pyx_t_14;
          } else {
            __pyx_t_16 = __pyx_t_15;
          }
          __pyx_t_14 = (__pyx_t_16 + 1);
          __pyx_t_16 = __pyx_t_14;
          for (__pyx_t_15 = (__pyx_v_i + 1); __pyx_t_15 &lt; __pyx_t_16; __pyx_t_15+=1) {
            __pyx_v_j = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">151</span>:                 # Euclidean distance between points i, j in `pts`</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>:                 # dist = np.linalg.norm(pts[i, 1:4] - pts[j, 1:4])</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>:                 dist = sqrt(</pre>
<pre class='cython code score-0 '>            __pyx_v_dist = sqrt(((pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_pts.data + __pyx_t_17 * __pyx_v_pts.strides[0]) ) + __pyx_t_18 * __pyx_v_pts.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_pts.data + __pyx_t_19 * __pyx_v_pts.strides[0]) ) + __pyx_t_20 * __pyx_v_pts.strides[1]) )))), 2.0) + pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_pts.data + __pyx_t_21 * __pyx_v_pts.strides[0]) ) + __pyx_t_22 * __pyx_v_pts.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_pts.data + __pyx_t_23 * __pyx_v_pts.strides[0]) ) + __pyx_t_24 * __pyx_v_pts.strides[1]) )))), 2.0)) + pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_pts.data + __pyx_t_25 * __pyx_v_pts.strides[0]) ) + __pyx_t_26 * __pyx_v_pts.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_pts.data + __pyx_t_27 * __pyx_v_pts.strides[0]) ) + __pyx_t_28 * __pyx_v_pts.strides[1]) )))), 2.0)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>:                     (pts[j, 1] - pts[i, 1]) ** 2 +</pre>
<pre class='cython code score-0 '>            __pyx_t_17 = __pyx_v_j;
            __pyx_t_18 = 1;
            __pyx_t_19 = __pyx_v_i;
            __pyx_t_20 = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">155</span>:                     (pts[j, 2] - pts[i, 2]) ** 2 +</pre>
<pre class='cython code score-0 '>            __pyx_t_21 = __pyx_v_j;
            __pyx_t_22 = 2;
            __pyx_t_23 = __pyx_v_i;
            __pyx_t_24 = 2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">156</span>:                     (pts[j, 3] - pts[i, 3]) ** 2</pre>
<pre class='cython code score-0 '>            __pyx_t_25 = __pyx_v_j;
            __pyx_t_26 = 3;
            __pyx_t_27 = __pyx_v_i;
            __pyx_t_28 = 3;
</pre><pre class="cython line score-0">&#xA0;<span class="">157</span>:                 )</pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:                 # Fix bug (or feature?) of scipy's minimum_spanning_tree where</pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>:                 # duplicate points (i.e. dist == 0.0) are ommitted from the</pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>:                 # MST vertices.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">162</span>:                 dists[ie] = dist if dist != 0.0 else DBL_MIN</pre>
<pre class='cython code score-0 '>            if (((__pyx_v_dist != 0.0) != 0)) {
              __pyx_t_29 = __pyx_v_dist;
            } else {
              __pyx_t_29 = DBL_MIN;
            }
            __pyx_t_28 = __pyx_v_ie;
            *((double *) ( /* dim=0 */ (__pyx_v_dists.data + __pyx_t_28 * __pyx_v_dists.strides[0]) )) = __pyx_t_29;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:                 rows[ie] = i</pre>
<pre class='cython code score-0 '>            __pyx_t_28 = __pyx_v_ie;
            *((double *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_28 * __pyx_v_rows.strides[0]) )) = __pyx_v_i;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">164</span>:                 cols[ie] = j</pre>
<pre class='cython code score-0 '>            __pyx_t_28 = __pyx_v_ie;
            *((double *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_28 * __pyx_v_cols.strides[0]) )) = __pyx_v_j;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:                 ie = ie + 1</pre>
<pre class='cython code score-0 '>            __pyx_v_ie = (__pyx_v_ie + 1);
          }
        }
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">166</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>:     # Create the distance matrix from the found points.</pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:     distance_matrix = csr_matrix(</pre>
<pre class='cython code score-13 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_csr_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
/* … */
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_8);
  __pyx_t_8 = 0;
/* … */
  __pyx_t_30 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_4, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_30)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_30);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_distance_matrix = __pyx_t_30;
  __pyx_t_30 = 0;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:         (dists, (rows, cols)),</pre>
<pre class='cython code score-14 '>  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_dists, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_rows, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_8 = __pyx_memoryview_fromslice(__pyx_v_cols, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_8);
  __pyx_t_6 = 0;
  __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_4);
  __pyx_t_7 = 0;
  __pyx_t_4 = 0;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">170</span>:         shape = (n, n)</pre>
<pre class='cython code score-25 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_7 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_n);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_30 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_30)) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_30);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_30, 0, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_30, 1, __pyx_t_6);
  __pyx_t_7 = 0;
  __pyx_t_6 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, __pyx_n_s_shape, __pyx_t_30) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_30); __pyx_t_30 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">171</span>:     )</pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">173</span>:     return distance_matrix</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_distance_matrix);
  __pyx_r = __pyx_v_distance_matrix;
  goto __pyx_L0;
</pre></div></body></html>
