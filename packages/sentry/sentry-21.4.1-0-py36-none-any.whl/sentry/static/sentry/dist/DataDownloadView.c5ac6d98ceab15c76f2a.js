/*! For license information please see DataDownloadView.c5ac6d98ceab15c76f2a.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([["DataDownloadView"],{"./app/components/dataExport.tsx":(e,t,n)=>{"use strict";n.d(t,{tD:()=>r,ZP:()=>D});var r,o=n("../node_modules/@babel/runtime/helpers/esm/extends.js"),s=n("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),l=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),u=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),d=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),c=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),p=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),m=n("../node_modules/react/index.js"),h=n("../node_modules/lodash/debounce.js"),y=n.n(h),f=n("../node_modules/lodash/isEqual.js"),Z=n.n(f),v=n("./app/actionCreators/indicator.tsx"),b=n("./app/components/acl/feature.tsx"),w=n("./app/components/button.tsx"),g=n("./app/locale.tsx"),x=n("./app/utils/withApi.tsx"),k=n("./app/utils/withOrganization.tsx"),_=n("../node_modules/@emotion/core/dist/core.browser.esm.js");!function(e){e.IssuesByTag="Issues-by-Tag",e.Discover="Discover"}(r||(r={}));var j=function(e){(0,u.Z)(m,e);var t,n,r=(t=m,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,c.Z)(t);if(n){var o=(0,c.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,d.Z)(this,e)});function m(){var e;(0,a.Z)(this,m);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),(0,p.Z)((0,i.Z)(e),"state",e.initialState),(0,p.Z)((0,i.Z)(e),"resetState",(function(){e.setState(e.initialState)})),(0,p.Z)((0,i.Z)(e),"startDataExport",(function(){var t=e.props,n=t.api,r=t.organization.slug,o=t.payload,a=o.queryType,l=o.queryInfo;e.setState({inProgress:!0}),n.requestPromise("/organizations/".concat(r,"/data-export/"),{includeAllArgs:!0,method:"POST",data:{query_type:a,query_info:l}}).then((function(e){var t=(0,s.Z)(e,3),n=(t[0],t[1],t[2]);(0,v.S9)(201===(null==n?void 0:n.status)?(0,g.t)("Sit tight. We'll shoot you an email when your data is ready for download."):(0,g.t)("It looks like we're already working on it. Sit tight, we'll email you."))})).catch((function(t){var n,r,o=null!==(n=null==t||null===(r=t.responseJSON)||void 0===r?void 0:r.detail)&&void 0!==n?n:"We tried our hardest, but we couldn't export your data. Give it another go.";(0,v.Iw)((0,g.t)(o)),e.setState({inProgress:!1})}))})),e}return(0,l.Z)(m,[{key:"componentDidUpdate",value:function(e){var t=e.payload,n=this.props.payload;Z()(t,n)||this.resetState()}},{key:"initialState",get:function(){return{inProgress:!1}}},{key:"render",value:function(){var e=this.state.inProgress,t=this.props,n=t.children,r=t.disabled,s=t.icon;return(0,_.tZ)(b.Z,{features:["organizations:discover-query"]},e?(0,_.tZ)(w.ZP,(0,o.Z)({size:"small",priority:"default",title:"You can get on with your life. We'll email you when your data's ready."},this.props,{disabled:!0,icon:s}),(0,g.t)("We're working on it...")):(0,_.tZ)(w.ZP,(0,o.Z)({onClick:y()(this.startDataExport,500),disabled:r||!1,size:"small",priority:"default",title:"Put your data to work. Start your export and we'll email you when it's finished.",icon:s},this.props),n||(0,g.t)("Export All to CSV")))}}]),m}(m.Component);j.displayName="DataExport";const D=(0,x.Z)((0,k.Z)(j))},"./app/views/asyncView.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),a=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),i=(n("../node_modules/react/index.js"),n("../node_modules/react-document-title/index.js")),u=n.n(i),d=n("./app/components/asyncComponent.tsx"),c=n("../node_modules/@emotion/core/dist/core.browser.esm.js");var p=function(e){(0,s.Z)(d,e);var t,n,i=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,l.Z)(t);if(n){var o=(0,l.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,a.Z)(this,e)});function d(){return(0,r.Z)(this,d),i.apply(this,arguments)}return(0,o.Z)(d,[{key:"getTitle",value:function(){return""}},{key:"render",value:function(){var e=this.getTitle();return(0,c.tZ)(u(),{title:"".concat(e?"".concat(e," - "):"","Sentry")},this.renderComponent())}}]),d}(d.Z);p.displayName="AsyncView"},"./app/views/dataExport/dataDownload.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{DownloadStatus:()=>r,default:()=>j});var r,o=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),i=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=n("../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),d=n("../node_modules/react/index.js"),c=n("../node_modules/react-router/es/index.js"),p=n("./app/components/button.tsx"),m=n("./app/components/dataExport.tsx"),h=n("./app/components/dateTime.tsx"),y=n("./app/icons/index.tsx"),f=n("./app/locale.tsx"),Z=n("./app/styles/space.tsx"),v=n("./app/views/asyncView.tsx"),b=n("./app/views/auth/layout.tsx"),w=n("../node_modules/@emotion/core/dist/core.browser.esm.js");!function(e){e.Early="EARLY",e.Valid="VALID",e.Expired="EXPIRED"}(r||(r={}));var g=function(e){(0,a.Z)(Z,e);var t,n,u=(t=Z,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,i.Z)(t);if(n){var o=(0,i.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,l.Z)(this,e)});function Z(){return(0,o.Z)(this,Z),u.apply(this,arguments)}return(0,s.Z)(Z,[{key:"getTitle",value:function(){return(0,f.t)("Download Center")}},{key:"getEndpoints",value:function(){var e=this.props.params,t=e.orgId,n=e.dataExportId;return[["download","/organizations/".concat(t,"/data-export/").concat(n,"/")]]}},{key:"getActionLink",value:function(e){var t=this.props.params.orgId;switch(e){case m.tD.IssuesByTag:return"/organizations/".concat(t,"/issues/");case m.tD.Discover:return"/organizations/".concat(t,"/discover/queries/");default:return"/"}}},{key:"renderDate",value:function(e){if(!e)return null;var t=new Date(e);return(0,w.tZ)("strong",null,(0,w.tZ)(h.Z,{date:t}))}},{key:"renderEarly",value:function(){return(0,w.tZ)(d.Fragment,null,(0,w.tZ)(x,null,(0,w.tZ)("h3",null,(0,f.t)("What are"),(0,w.tZ)("i",null,(0,f.t)(" you ")),(0,f.t)("doing here?"))),(0,w.tZ)(k,null,(0,w.tZ)("p",null,(0,f.t)("Not that its any of our business, but were you invited to this page? It's just that we don't exactly remember emailing you about it.")),(0,w.tZ)("p",null,(0,f.t)("Close this window and we'll email you when your download is ready."))))}},{key:"renderExpired",value:function(){var e=this.state.download.query,t=this.getActionLink(e.type);return(0,w.tZ)(d.Fragment,null,(0,w.tZ)(x,null,(0,w.tZ)("h3",null,(0,f.t)("This is awkward."))),(0,w.tZ)(k,null,(0,w.tZ)("p",null,(0,f.t)("That link expired, so your download doesn't live here anymore. Just picked up one day and left town.")),(0,w.tZ)("p",null,(0,f.t)("Make a new one with your latest data. Your old download will never see it coming.")),(0,w.tZ)(_,{href:t,priority:"primary"},(0,f.t)("Start a New Download"))))}},{key:"openInDiscover",value:function(){var e=this.state.download.query.info,t=this.props.params.orgId,n={pathname:"/organizations/".concat(t,"/discover/results/"),query:e};c.browserHistory.push(n)}},{key:"renderOpenInDiscover",value:function(){var e=this,t=this.state.download.query,n=(void 0===t?{type:m.tD.IssuesByTag,info:{}}:t).type;return"Discover"===(void 0===n?m.tD.IssuesByTag:n)?(0,w.tZ)(d.Fragment,null,(0,w.tZ)("p",null,(0,f.t)("Need to make changes?")),(0,w.tZ)(p.ZP,{priority:"primary",onClick:function(){return e.openInDiscover()}},(0,f.t)("Open in Discover")),(0,w.tZ)("br",null)):null}},{key:"renderValid",value:function(){var e=this.state.download,t=e.dateExpired,n=e.checksum,r=this.props.params,o=r.orgId,s=r.dataExportId;return(0,w.tZ)(d.Fragment,null,(0,w.tZ)(x,null,(0,w.tZ)("h3",null,(0,f.t)("All done."))),(0,w.tZ)(k,null,(0,w.tZ)("p",null,(0,f.t)("See, that wasn't so bad. Your data is all ready for download.")),(0,w.tZ)(p.ZP,{priority:"primary",icon:(0,w.tZ)(y.Dj,null),href:"/api/0/organizations/".concat(o,"/data-export/").concat(s,"/?download=true")},(0,f.t)("Download CSV")),(0,w.tZ)("p",null,(0,f.t)("That link won't last forever â€” it expires:"),(0,w.tZ)("br",null),this.renderDate(t)),this.renderOpenInDiscover(),(0,w.tZ)("p",null,(0,w.tZ)("small",null,(0,w.tZ)("strong",null,"SHA1:",n)),(0,w.tZ)("br",null),(0,f._N)("Need help verifying? [link].",{link:(0,w.tZ)("a",{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns",target:"_blank",rel:"noopener noreferrer"},(0,f.t)("Check out our docs"))}))))}},{key:"renderError",value:function(){var e,t=this.state.errors.download,n=null==t||null===(e=t.responseJSON)||void 0===e?void 0:e.detail;return(0,w.tZ)(b.Z,null,(0,w.tZ)("main",null,(0,w.tZ)(x,null,(0,w.tZ)("h3",null,t.status," - ",t.statusText)),n&&(0,w.tZ)(k,null,(0,w.tZ)("p",null,n))))}},{key:"renderContent",value:function(){switch(this.state.download.status){case r.Early:return this.renderEarly();case r.Expired:return this.renderExpired();default:return this.renderValid()}}},{key:"renderBody",value:function(){return(0,w.tZ)(b.Z,null,(0,w.tZ)("main",null,this.renderContent()))}}]),Z}(v.Z),x=(0,u.Z)("header",{target:"eq2c1c20",label:"Header"})("border-bottom:1px solid ",(function(e){return e.theme.border}),";padding:",(0,Z.Z)(3)," 40px 0;h3{font-size:24px;margin:0 0 ",(0,Z.Z)(3)," 0;}"),k=(0,u.Z)("div",{target:"eq2c1c21",label:"Body"})("padding:",(0,Z.Z)(2)," 40px;max-width:500px;p{margin:",(0,Z.Z)(1.5)," 0;}"),_=(0,u.Z)(p.ZP,{target:"eq2c1c22",label:"DownloadButton"})("margin-bottom:",(0,Z.Z)(1.5),";");const j=g}}]);
//# sourceMappingURL=DataDownloadView.js.map