{"version":3,"sources":["webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/components/forms/booleanField.tsx","webpack:///./app/views/settings/components/forms/textField.tsx","webpack:///./app/views/settings/project/projectServiceHookDetails.tsx","webpack:///./app/views/settings/project/serviceHookSettingsForm.tsx"],"names":["AsyncView","title","this","getTitle","renderComponent","AsyncComponent","BooleanField","value","onChange","onBlur","e","newValue","coerceValue","props","confirm","fieldProps","resetOnError","field","disabled","handleChange","bind","switchProps","size","isActive","isDisabled","toggle","renderMessage","toString","onConfirm","open","React","TextField","type","HookStats","until","Math","floor","Date","getTime","since","params","hookId","orgId","projectId","query","resolution","stats","state","emptyStats","series","seriesName","t","data","map","p","total","name","ts","withPadding","description","isGroupedByDate","showTimeInTooltip","labelYAxisExtents","height","ProjectServiceHookDetails","addLoadingMessage","api","request","method","success","clearIndicators","browserHistory","error","addErrorMessage","hook","initialData","status","icon","label","flexibleControlStateSize","inline","help","getDynamicText","secret","fixed","priority","onClick","onDelete","EVENT_CHOICES","ServiceHookSettingsForm","endpoint","apiMethod","apiEndpoint","onSubmitSuccess","footerStyle","marginTop","paddingRight","submitLabel","required","choices"],"mappings":"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","file":"ProjectServiceHookDetails.4eae5a7bb7b0bc9248c0.js","sourcesContent":["import React from 'react';\nimport DocumentTitle from 'react-document-title';\n\nimport AsyncComponent from 'app/components/asyncComponent';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    const title = this.getTitle();\n    return (\n      <DocumentTitle title={`${title ? `${title} - ` : ''}Sentry`}>\n        {this.renderComponent() as React.ReactChild}\n      </DocumentTitle>\n    );\n  }\n}\n","import React from 'react';\n\nimport Confirm from 'app/components/confirm';\nimport Switch from 'app/components/switchButton';\nimport InputField, {onEvent} from 'app/views/settings/components/forms/inputField';\n\ntype Props = {\n  confirm?: {\n    true?: React.ReactNode;\n    false?: React.ReactNode;\n  };\n} & InputField['props'];\n\nexport default class BooleanField extends React.Component<Props> {\n  coerceValue(value: any) {\n    return !!value;\n  }\n\n  handleChange = (\n    value: any,\n    onChange: onEvent,\n    onBlur: onEvent,\n    e: React.FormEvent<HTMLInputElement>\n  ) => {\n    // We need to toggle current value because Switch is not an input\n    const newValue = this.coerceValue(!value);\n    onChange(newValue, e);\n    onBlur(newValue, e);\n  };\n\n  render() {\n    const {confirm, ...fieldProps} = this.props;\n\n    return (\n      <InputField\n        {...fieldProps}\n        resetOnError\n        field={({\n          onChange,\n          onBlur,\n          value,\n          disabled,\n          ...props\n        }: {\n          onChange: onEvent;\n          onBlur: onEvent;\n          value: any;\n          disabled: boolean;\n        }) => {\n          // Create a function with required args bound\n          const handleChange = this.handleChange.bind(this, value, onChange, onBlur);\n\n          const switchProps = {\n            ...props,\n            size: 'lg' as React.ComponentProps<typeof Switch>['size'],\n            isActive: !!value,\n            isDisabled: disabled,\n            toggle: handleChange,\n          };\n\n          if (confirm) {\n            return (\n              <Confirm\n                renderMessage={() => confirm[(!value).toString()]}\n                onConfirm={() => handleChange({})}\n              >\n                {({open}) => (\n                  <Switch\n                    {...switchProps}\n                    toggle={(e: React.MouseEvent) => {\n                      // If we have a `confirm` prop and enabling switch\n                      // Then show confirm dialog, otherwise propagate change as normal\n                      if (confirm[(!value).toString()]) {\n                        // Open confirm modal\n                        open();\n                        return;\n                      }\n\n                      handleChange(e);\n                    }}\n                  />\n                )}\n              </Confirm>\n            );\n          }\n\n          return <Switch {...switchProps} />;\n        }}\n      />\n    );\n  }\n}\n","import React from 'react';\n\nimport InputField from 'app/views/settings/components/forms/inputField';\n\ntype Props = InputField['props'];\n\nexport default function TextField(props: Omit<Props, 'type'>) {\n  return <InputField {...props} type=\"text\" />;\n}\n","import React from 'react';\nimport {browserHistory, WithRouterProps} from 'react-router';\n\nimport {\n  addErrorMessage,\n  addLoadingMessage,\n  clearIndicators,\n} from 'app/actionCreators/indicator';\nimport AsyncComponent from 'app/components/asyncComponent';\nimport Button from 'app/components/button';\nimport MiniBarChart from 'app/components/charts/miniBarChart';\nimport ErrorBoundary from 'app/components/errorBoundary';\nimport {Panel, PanelAlert, PanelBody, PanelHeader} from 'app/components/panels';\nimport {IconFlag} from 'app/icons';\nimport {t} from 'app/locale';\nimport {ServiceHook} from 'app/types';\nimport getDynamicText from 'app/utils/getDynamicText';\nimport AsyncView from 'app/views/asyncView';\nimport EmptyMessage from 'app/views/settings/components/emptyMessage';\nimport Field from 'app/views/settings/components/forms/field';\nimport TextCopyInput from 'app/views/settings/components/forms/textCopyInput';\nimport SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';\nimport ServiceHookSettingsForm from 'app/views/settings/project/serviceHookSettingsForm';\n\ntype Params = {orgId: string; projectId: string; hookId: string};\n\ntype StatsProps = {\n  params: Params;\n};\n\ntype StatsState = {\n  stats: {ts: number; total: number}[] | null;\n} & AsyncComponent['state'];\n\nclass HookStats extends AsyncComponent<StatsProps, StatsState> {\n  getEndpoints(): ReturnType<AsyncComponent['getEndpoints']> {\n    const until = Math.floor(new Date().getTime() / 1000);\n    const since = until - 3600 * 24 * 30;\n    const {hookId, orgId, projectId} = this.props.params;\n    return [\n      [\n        'stats',\n        `/projects/${orgId}/${projectId}/hooks/${hookId}/stats/`,\n        {\n          query: {\n            since,\n            until,\n            resolution: '1d',\n          },\n        },\n      ],\n    ];\n  }\n\n  renderBody() {\n    const {stats} = this.state;\n    if (stats === null) {\n      return null;\n    }\n    let emptyStats = true;\n\n    const series = {\n      seriesName: t('Events'),\n      data: stats.map(p => {\n        if (p.total) {\n          emptyStats = false;\n        }\n        return {\n          name: p.ts * 1000,\n          value: p.total,\n        };\n      }),\n    };\n\n    return (\n      <Panel>\n        <PanelHeader>{t('Events in the last 30 days (by day)')}</PanelHeader>\n        <PanelBody withPadding>\n          {!emptyStats ? (\n            <MiniBarChart\n              isGroupedByDate\n              showTimeInTooltip\n              labelYAxisExtents\n              series={[series]}\n              height={150}\n            />\n          ) : (\n            <EmptyMessage\n              title={t('Nothing recorded in the last 30 days.')}\n              description={t('Total webhooks fired for this configuration.')}\n            />\n          )}\n        </PanelBody>\n      </Panel>\n    );\n  }\n}\n\ntype Props = WithRouterProps<Params, {}>;\ntype State = {\n  hook: ServiceHook | null;\n} & AsyncView['state'];\n\nexport default class ProjectServiceHookDetails extends AsyncView<Props, State> {\n  getEndpoints(): ReturnType<AsyncComponent['getEndpoints']> {\n    const {orgId, projectId, hookId} = this.props.params;\n    return [['hook', `/projects/${orgId}/${projectId}/hooks/${hookId}/`]];\n  }\n\n  onDelete = () => {\n    const {orgId, projectId, hookId} = this.props.params;\n    addLoadingMessage(t('Saving changes\\u2026'));\n    this.api.request(`/projects/${orgId}/${projectId}/hooks/${hookId}/`, {\n      method: 'DELETE',\n      success: () => {\n        clearIndicators();\n        browserHistory.push(`/settings/${orgId}/projects/${projectId}/hooks/`);\n      },\n      error: () => {\n        addErrorMessage(t('Unable to remove application. Please try again.'));\n      },\n    });\n  };\n\n  renderBody() {\n    const {orgId, projectId, hookId} = this.props.params;\n    const {hook} = this.state;\n    if (!hook) {\n      return null;\n    }\n\n    return (\n      <React.Fragment>\n        <SettingsPageHeader title={t('Service Hook Details')} />\n\n        <ErrorBoundary>\n          <HookStats params={this.props.params} />\n        </ErrorBoundary>\n\n        <ServiceHookSettingsForm\n          orgId={orgId}\n          projectId={projectId}\n          hookId={hookId}\n          initialData={{\n            ...hook,\n            isActive: hook.status !== 'disabled',\n          }}\n        />\n        <Panel>\n          <PanelHeader>{t('Event Validation')}</PanelHeader>\n          <PanelBody>\n            <PanelAlert type=\"info\" icon={<IconFlag size=\"md\" />}>\n              Sentry will send the <code>X-ServiceHook-Signature</code> header built using{' '}\n              <code>HMAC(SHA256, [secret], [payload])</code>. You should always verify\n              this signature before trusting the information provided in the webhook.\n            </PanelAlert>\n            <Field\n              label={t('Secret')}\n              flexibleControlStateSize\n              inline={false}\n              help={t('The shared secret used for generating event HMAC signatures.')}\n            >\n              <TextCopyInput>\n                {getDynamicText({\n                  value: hook.secret,\n                  fixed: 'a dynamic secret value',\n                })}\n              </TextCopyInput>\n            </Field>\n          </PanelBody>\n        </Panel>\n        <Panel>\n          <PanelHeader>{t('Delete Hook')}</PanelHeader>\n          <PanelBody>\n            <Field\n              label={t('Delete Hook')}\n              help={t('Removing this hook is immediate and permanent.')}\n            >\n              <div>\n                <Button priority=\"danger\" onClick={this.onDelete}>\n                  {t('Delete Hook')}\n                </Button>\n              </div>\n            </Field>\n          </PanelBody>\n        </Panel>\n      </React.Fragment>\n    );\n  }\n}\n","import React from 'react';\nimport {browserHistory} from 'react-router';\n\nimport {Panel, PanelBody, PanelHeader} from 'app/components/panels';\nimport {t} from 'app/locale';\nimport {Choices, ServiceHook} from 'app/types';\nimport ApiForm from 'app/views/settings/components/forms/apiForm';\nimport BooleanField from 'app/views/settings/components/forms/booleanField';\nimport MultipleCheckbox from 'app/views/settings/components/forms/controls/multipleCheckbox';\nimport FormField from 'app/views/settings/components/forms/formField';\nimport TextField from 'app/views/settings/components/forms/textField';\n\nconst EVENT_CHOICES: Choices = ['event.alert', 'event.created'].map(e => [e, e]);\n\ntype Props = {\n  orgId: string;\n  projectId: string;\n  initialData: Partial<ServiceHook> & {isActive: boolean};\n  hookId?: string;\n};\n\nexport default class ServiceHookSettingsForm extends React.Component<Props> {\n  onSubmitSuccess = () => {\n    const {orgId, projectId} = this.props;\n    browserHistory.push(`/settings/${orgId}/projects/${projectId}/hooks/`);\n  };\n\n  render() {\n    const {initialData, orgId, projectId, hookId} = this.props;\n\n    const endpoint = hookId\n      ? `/projects/${orgId}/${projectId}/hooks/${hookId}/`\n      : `/projects/${orgId}/${projectId}/hooks/`;\n\n    return (\n      <Panel>\n        <ApiForm\n          apiMethod={hookId ? 'PUT' : 'POST'}\n          apiEndpoint={endpoint}\n          initialData={initialData}\n          onSubmitSuccess={this.onSubmitSuccess}\n          footerStyle={{\n            marginTop: 0,\n            paddingRight: 20,\n          }}\n          submitLabel={hookId ? t('Save Changes') : t('Create Hook')}\n        >\n          <PanelHeader>{t('Hook Configuration')}</PanelHeader>\n          <PanelBody>\n            <BooleanField name=\"isActive\" label={t('Active')} />\n            <TextField\n              name=\"url\"\n              label={t('URL')}\n              required\n              help={t('The URL which will receive events.')}\n            />\n            <FormField\n              name=\"events\"\n              label={t('Events')}\n              inline={false}\n              help={t('The event types you wish to subscribe to.')}\n            >\n              {({value, onChange}) => (\n                <MultipleCheckbox\n                  onChange={onChange}\n                  value={value}\n                  choices={EVENT_CHOICES}\n                />\n              )}\n            </FormField>\n          </PanelBody>\n        </ApiForm>\n      </Panel>\n    );\n  }\n}\n"],"sourceRoot":""}