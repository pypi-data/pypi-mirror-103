(self.webpackChunk=self.webpackChunk||[]).push([["DashboardDetail"],{"./app/components/editableText.tsx":(e,t,a)=>{"use strict";a.d(t,{Z:()=>m});var n=a("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),r=a("../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),o=a("../node_modules/react/index.js"),i=a("./app/actionCreators/indicator.tsx"),s=a("./app/components/textOverflow.tsx"),d=a("./app/icons/iconEdit.tsx"),c=a("./app/styles/space.tsx"),l=a("./app/utils.tsx");const u=function(e){var t=(0,o.useState)(!1),a=(0,n.Z)(t,2),r=a[0],i=a[1];function s(t){t.key===e&&i(!0)}function d(t){t.key===e&&i(!1)}return(0,o.useEffect)((function(){return window.addEventListener("keydown",s),window.addEventListener("keyup",d),function(){window.removeEventListener("keydown",s),window.removeEventListener("keyup",d)}}),[]),r};var p=a("./app/views/settings/components/forms/controls/input.tsx"),h=a("./app/views/settings/components/forms/field/index.tsx"),f=a("../node_modules/@emotion/core/dist/core.browser.esm.js");function b(e){var t,a,r=e.value,s=e.onChange,d=e.name,c=e.errorMessage,p=e.successMessage,h=e.isDisabled,b=void 0!==h&&h,m=(0,o.useState)(!1),C=(0,n.Z)(m,2),z=C[0],E=C[1],j=(0,o.useState)(r),O=(0,n.Z)(j,2),P=O[0],R=O[1],_=!P.trim(),I=(0,o.useRef)(null),W=(0,o.useRef)(null),N=(0,o.useRef)(null),A=u("Enter"),B=u("Escape");t=I,a=function(){if(z){if(_)return void U("error");P!==r&&(s(P),U("success")),E(!1)}},(0,o.useEffect)((function(){var e=function(e){var n=null==t?void 0:t.current;n&&!n.contains(e.target)&&a(e)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),function(){document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[t,a]);var L=(0,o.useCallback)((function(){if(A){if(_)return void U("error");P!==r&&(s(P),U("success")),E(!1)}}),[A,P,s]),T=(0,o.useCallback)((function(){B&&(R(r),E(!1))}),[B,r]);function U(e){"error"!==e?p&&(0,i.S9)(p):c&&(0,i.Iw)(c)}return(0,o.useEffect)((function(){r!==P&&R(r)}),[r]),(0,o.useEffect)((function(){if(z){var e=N.current;(0,l.ri)(e)&&e.focus()}}),[z]),(0,o.useEffect)((function(){z&&(L(),T())}),[L,T,z]),(0,f.tZ)(w,{isDisabled:b},z?(0,f.tZ)(x,{ref:I,isEmpty:_,"data-test-id":"editable-text-input"},(0,f.tZ)(D,{inline:!1,flexibleControlStateSize:!0,stacked:!0},(0,f.tZ)(k,{name:d,ref:N,value:P,onChange:function(e){R(e.target.value)}})),(0,f.tZ)(S,null,P)):(0,f.tZ)(g,{onClick:b?void 0:function(){E(!0)},ref:W,"data-test-id":"editable-text-label"},(0,f.tZ)(v,null,(0,f.tZ)(y,null,P)),(0,f.tZ)(Z,null)))}b.displayName="EditableText";const m=b;var g=(0,r.Z)("div",{target:"e1nzw5k70",label:"Content"})({name:"107j8r1",styles:"height:40px;position:relative;max-width:calc(100% - 22px);padding-right:22px;"}),v=(0,r.Z)("div",{target:"e1nzw5k71",label:"Label"})("display:inline-block;border:1px solid transparent;border-radius:",(function(e){return e.theme.borderRadius}),";transition:border 150ms;text-align:left;padding:0 10px;height:40px;max-width:100%;"),y=(0,r.Z)(s.Z,{target:"e1nzw5k72",label:"InnerLabel"})("border-bottom:1px dotted ",(function(e){return e.theme.gray200}),";transition:border 150ms;height:39px;line-height:39px;"),Z=(0,r.Z)(d.y,{target:"e1nzw5k73",label:"StyledIconEdit"})("opacity:0;transition:opacity 150ms;margin-left:",(0,c.Z)(.75),";height:40px;position:absolute;right:0;cursor:pointer;"),w=(0,r.Z)("div",{target:"e1nzw5k74",label:"Wrapper"})("display:flex;justify-content:flex-start;height:40px;",(function(e){return e.isDisabled?"\n          ".concat(Z," {\n            cursor: default;\n          }\n\n          ").concat(y," {\n            border-bottom-color: transparent;\n          }\n        "):"\n          :hover {\n            ".concat(Z," {\n              opacity: 1;\n            }\n            ").concat(v," {\n              border-color: ").concat(e.theme.gray300,";\n            }\n            ").concat(y," {\n              border-bottom-color: transparent;\n            }\n          }\n        ")})),x=(0,r.Z)("div",{target:"e1nzw5k75",label:"InputWrapper"})("position:relative;max-width:100%;min-width:",(function(e){return e.isEmpty?"100px":"50px"}),";"),D=(0,r.Z)(h.Z,{target:"e1nzw5k76",label:"StyledField"})({name:"1e3kfow",styles:"width:100%;padding:0;position:absolute;right:0;"}),k=(0,r.Z)(p.Z,{target:"e1nzw5k77",label:"StyledInput"})({name:"1uhyxrs",styles:"&,&:focus,&:active,&:hover{box-shadow:none;}"}),S=(0,r.Z)("div",{target:"e1nzw5k78",label:"InputLabel"})("width:auto;opacity:0;padding:",(0,c.Z)(1.5),";height:40px;position:relative;z-index:-1;")},"./app/components/sentryDocumentTitle.tsx":(e,t,a)=>{"use strict";a.d(t,{Z:()=>s}),a("../node_modules/react/index.js");var n=a("../node_modules/react-document-title/index.js"),r=a.n(n),o=a("../node_modules/@emotion/core/dist/core.browser.esm.js");function i(e){var t=e.title,a=e.orgSlug,n=e.projectSlug,i=e.children,s=a||n?a&&n?"".concat(t," - ").concat(a," - ").concat(n):a?"".concat(t," - ").concat(a):"".concat(t," - ").concat(n):t;return(0,o.tZ)(r(),{title:"".concat(s," - Sentry")},i)}i.displayName="SentryDocumentTitle";const s=i},"./app/views/dashboardsV2/detail.tsx":(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>_e});var n=a("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),r=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=a("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),i=a("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=a("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),d=a("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),l=a("../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),u=a("../node_modules/react/index.js"),p=a("../node_modules/react-router/es/index.js"),h=a("../node_modules/lodash/isEqual.js"),f=a.n(h),b=a("./app/actionCreators/dashboards.tsx"),m=a("./app/actionCreators/indicator.tsx"),g=a("./app/components/errors/notFound.tsx"),v=a("./app/components/lightWeightNoProjectMessage.tsx"),y=a("./app/components/loadingIndicator.tsx"),Z=a("./app/components/organizations/globalSelectionHeader/index.tsx"),w=a("./app/locale.tsx"),x=a("./app/styles/organization.tsx"),D=a("./app/styles/space.tsx"),k=a("./app/utils/analytics.tsx"),S=a("./app/utils/withApi.tsx"),C=a("./app/utils/withOrganization.tsx"),z=a("./app/components/acl/feature.tsx"),E=a("./app/components/acl/featureDisabled.tsx"),j=a("./app/components/button.tsx"),O=a("./app/components/buttonBar.tsx"),P=a("./app/components/confirm.tsx"),R=a("./app/components/forms/selectControl.tsx"),_=a("./app/components/hovercard.tsx"),I=a("./app/icons/index.tsx"),W=a("../node_modules/@emotion/core/dist/core.browser.esm.js");var N=function(e){(0,i.Z)(c,e);var t,a,o=(t=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,d.Z)(t);if(a){var r=(0,d.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,s.Z)(this,e)});function c(){return(0,n.Z)(this,c),o.apply(this,arguments)}return(0,r.Z)(c,[{key:"render",value:function(){var e=this,t=this.props,a=t.dashboardState,n=t.dashboards,r=t.dashboard,o=t.onEdit,i=t.onCreate,s=t.onCancel,d=t.onCommit,c=t.onDelete,l=(0,W.tZ)(j.ZP,{"data-test-id":"dashboard-cancel",onClick:function(e){e.preventDefault(),s()}},(0,w.t)("Cancel"));if(["edit","pending_delete"].includes(a))return(0,W.tZ)(L,{gap:1,key:"edit-controls"},l,(0,W.tZ)(P.Z,{priority:"danger",message:(0,w.t)("Are you sure you want to delete this dashboard?"),onConfirm:c},(0,W.tZ)(j.ZP,{"data-test-id":"dashboard-delete",priority:"danger"},(0,w.t)("Delete"))),(0,W.tZ)(j.ZP,{"data-test-id":"dashboard-commit",onClick:function(e){e.preventDefault(),d()},priority:"primary"},(0,w.t)("Save and Finish")));if("create"===a)return(0,W.tZ)(L,{gap:1,key:"create-controls"},l,(0,W.tZ)(j.ZP,{"data-test-id":"dashboard-commit",onClick:function(e){e.preventDefault(),d()},priority:"primary"},(0,w.t)("Save and Finish")));var u=n.map((function(e){return{label:e.title,value:e}})),h=void 0;return r?h={label:r.title,value:r}:u.length&&(h=u[0]),(0,W.tZ)(T,{gap:1,key:"controls"},(0,W.tZ)(B,null,(0,W.tZ)(R.Z,{key:"select",name:"parameter",placeholder:(0,w.t)("Select Dashboard"),options:u,value:h,onChange:function(t){var a=t.value,n=e.props.organization;p.browserHistory.push({pathname:"/organizations/".concat(n.slug,"/dashboards/").concat(a.id,"/"),query:{}})}})),(0,W.tZ)(A,null,(function(e){return(0,W.tZ)(j.ZP,{"data-test-id":"dashboard-create",onClick:function(e){e.preventDefault(),i()},icon:(0,W.tZ)(I.N_,{size:"xs",isCircled:!0}),disabled:!e},(0,w.t)("Create Dashboard"))})),(0,W.tZ)(A,null,(function(e){return(0,W.tZ)(j.ZP,{"data-test-id":"dashboard-edit",onClick:function(e){e.preventDefault(),o()},priority:"primary",icon:(0,W.tZ)(I.yl,{size:"xs"}),disabled:!e},(0,w.t)("Edit Dashboard"))})))}}]),c}(u.Component);N.displayName="Controls";var A=function(e){var t=e.children,a=(0,w.t)("Requires dashboard editing.");return(0,W.tZ)(z.Z,{hookName:"feature-disabled:dashboards-edit",features:["organizations:dashboards-edit"],renderDisabled:function(e){return(0,W.tZ)(_.ZP,{body:(0,W.tZ)(E.Z,{features:e.features,hideHelpToggle:!0,message:a,featureName:a})},e.children(e))}},(function(e){var a=e.hasFeature;return t(a)}))};A.displayName="DashboardEditFeature";var B=(0,l.Z)("div",{target:"e78awt50",label:"DashboardSelect"})("min-width:200px;font-size:",(function(e){return e.theme.fontSizeMedium}),";"),L=(0,l.Z)(O.Z,{target:"e78awt51",label:"StyledButtonBar"})({name:"6su6fj",styles:"flex-shrink:0;"}),T=(0,l.Z)(L,{target:"e78awt52",label:"OverviewControls"})("@media (max-width:",(function(e){return e.theme.breakpoints[0]}),"){grid-auto-flow:row;grid-row-gap:",(0,D.Z)(1),";width:100%;}");const U=N;var q=a("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),M=a("../node_modules/@dnd-kit/core/dist/core.esm.js"),Y=a("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),H=a("./app/actionCreators/modal.tsx"),X=a("./app/actionCreators/tags.tsx"),F=a("./app/utils/withGlobalSelection.tsx"),K=a("./app/views/dashboardsV2/types.tsx"),V=a("../node_modules/framer-motion/dist/es/render/dom/motion.js");const G=(0,l.Z)(V.E.div,{target:"ec3gecx0",label:"WidgetWrapper"})("position:relative;touch-action:manipulation;",(function(e){switch(e.displayType){case"big_number":return"\n          /* 2 cols */\n          grid-area: span 1 / span 2;\n\n          @media (min-width: ".concat(e.theme.breakpoints[0],") {\n            /* 4 cols */\n            grid-area: span 1 / span 1;\n          }\n\n          @media (min-width: ").concat(e.theme.breakpoints[3],") {\n            /* 6 and 8 cols */\n            grid-area: span 1 / span 2;\n          }\n        ");default:return"\n          /* 2, 4, 6 and 8 cols */\n          grid-area: span 2 / span 2;\n        "}}),";");var J="add-widget-button",Q={x:0,y:0,scaleX:1,scaleY:1};function $(e){var t=e.onClick,a=e.orgFeatures,n=e.orgSlug,r=e.dashboardId,o=(0,Y.nB)({disabled:!0,id:J,transition:null}),i=o.setNodeRef,s=o.transform;return(0,W.tZ)(G,{key:"add",ref:i,displayType:K.F.BIG_NUMBER,layoutId:J,style:{originX:0,originY:0},animate:s?{x:s.x,y:s.y,scaleX:null!=s&&s.scaleX&&s.scaleX<=1?s.scaleX:1,scaleY:null!=s&&s.scaleY&&s.scaleY<=1?s.scaleY:1}:Q,transition:{duration:.25}},a.includes("metrics")?(0,W.tZ)(ae,null,(0,W.tZ)(O.Z,{gap:1},(0,W.tZ)(j.ZP,{to:"/organizations/".concat(n,"/dashboards/").concat(r,"/widget/new/?dataSet=metrics")},(0,w.t)("Add metrics widget")),(0,W.tZ)(j.ZP,{onClick:t},(0,w.t)("Add events widget")))):(0,W.tZ)(ae,{onClick:t},(0,W.tZ)(te,{"data-test-id":"widget-add",onClick:t,icon:(0,W.tZ)(I.N_,{size:"lg",isCircled:!0,color:"inactive"})})))}$.displayName="AddWidget";const ee=$;var te=(0,l.Z)(j.ZP,{target:"e1sxcph30",label:"AddButton"})({name:"6ayxgl",styles:"border:none;&,&:focus,&:active,&:hover{background:transparent;box-shadow:none;}"}),ae=(0,l.Z)("div",{target:"e1sxcph31",label:"InnerWrapper"})("width:100%;height:110px;border:2px dashed ",(function(e){return e.theme.border}),";border-radius:",(function(e){return e.theme.borderRadius}),";display:flex;align-items:center;justify-content:center;cursor:",(function(e){return e.onClick?"pointer":""}),";"),ne=a("./app/utils/theme.tsx"),re=a("./app/views/dashboardsV2/widgetCard.tsx"),oe={x:0,y:0,scaleX:1,scaleY:1,zIndex:"auto"};function ie(e){var t=e.widget,a=e.dragId,n=e.isEditing,r=e.onDelete,o=e.onEdit,i=(0,Y.nB)({id:a,transition:null}),s=i.attributes,d=i.listeners,c=i.setNodeRef,l=i.transform,p=i.isDragging,h=i.isSorting;return(0,u.useEffect)((function(){if(p)return document.body.style.cursor="grabbing",function(){document.body.style.cursor=""}}),[p]),(0,W.tZ)(G,{ref:c,displayType:t.displayType,layoutId:a,style:{originX:p?1:0,originY:0,boxShadow:p?ne.ZP.dropShadowHeavy:"none",borderRadius:p?ne.ZP.borderRadius:void 0},animate:l?{x:l.x,y:l.y,scaleX:null!=l&&l.scaleX&&l.scaleX<=1?l.scaleX:1,scaleY:null!=l&&l.scaleY&&l.scaleY<=1?l.scaleY:1,zIndex:p?ne.ZP.zIndex.modal:"auto"}:oe,transition:{duration:p?0:.25,easings:{type:"spring"}}},(0,W.tZ)(re.Z,{widget:t,isEditing:n,onDelete:r,onEdit:o,isSorting:h,hideToolbar:h,currentWidgetDragging:p,draggableProps:{attributes:s,listeners:d},showContextMenu:!0}))}ie.displayName="SortableWidget";const se=ie;var de=function(e){(0,i.Z)(u,e);var t,a,l=(t=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,d.Z)(t);if(a){var r=(0,d.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,s.Z)(this,e)});function u(){var e;(0,n.Z)(this,u);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return e=l.call.apply(l,[this].concat(a)),(0,c.Z)((0,o.Z)(e),"handleStartAdd",(function(){var t=e.props,a=t.organization,n=t.dashboard,r=t.selection;(0,H.openAddDashboardWidgetModal)({organization:a,dashboard:n,selection:r,onAddWidget:e.handleAddComplete})})),(0,c.Z)((0,o.Z)(e),"handleAddComplete",(function(t){e.props.onUpdate([].concat((0,q.Z)(e.props.dashboard.widgets),[t]))})),(0,c.Z)((0,o.Z)(e),"handleUpdateComplete",(function(t){return function(a){var n=(0,q.Z)(e.props.dashboard.widgets);n[t]=a,e.props.onUpdate(n)}})),(0,c.Z)((0,o.Z)(e),"handleDeleteWidget",(function(t){return function(){var a=(0,q.Z)(e.props.dashboard.widgets);a.splice(t,1),e.props.onUpdate(a)}})),(0,c.Z)((0,o.Z)(e),"handleEditWidget",(function(t,a){return function(){var n=e.props,r=n.organization,o=n.dashboard,i=n.selection;(0,H.openAddDashboardWidgetModal)({organization:r,dashboard:o,widget:t,selection:i,onAddWidget:e.handleAddComplete,onUpdateWidget:e.handleUpdateComplete(a)})}})),e}return(0,r.Z)(u,[{key:"componentDidMount",value:function(){this.props.isEditing&&this.fetchTags()}},{key:"componentDidUpdate",value:function(e){var t=this.props.isEditing;e.isEditing!==t&&t&&this.fetchTags()}},{key:"fetchTags",value:function(){var e=this.props,t=e.api,a=e.organization,n=e.selection;(0,X.QK)(t,a.slug,n)}},{key:"getWidgetIds",value:function(){return[].concat((0,q.Z)(this.props.dashboard.widgets.map((function(e,t){return ue(e,t)}))),[J])}},{key:"renderWidget",value:function(e,t){var a=this.props.isEditing,n=ue(e,t),r=n;return(0,W.tZ)(se,{key:n,widget:e,dragId:r,isEditing:a,onDelete:this.handleDeleteWidget(t),onEdit:this.handleEditWidget(e,t)})}},{key:"render",value:function(){var e=this,t=this.props,a=t.isEditing,n=t.onUpdate,r=t.dashboard.widgets,o=t.organization,i=t.paramDashboardId,s=this.getWidgetIds();return(0,W.tZ)(M.LB,{collisionDetection:M.pE,onDragEnd:function(e){var t=e.over,a=e.active.id,o=s.indexOf.bind(s),i=a?o(a):-1;if(t&&t.id!==J){var d=o(t.id);i!==d&&n((0,Y.Rp)(r,i,d))}}},(0,W.tZ)(le,null,(0,W.tZ)(Y.Fo,{items:s,strategy:Y.U2},r.map((function(t,a){return e.renderWidget(t,a)})),a&&(0,W.tZ)(ee,{dashboardId:i,orgSlug:o.slug,orgFeatures:o.features,onClick:this.handleStartAdd}))))}}]),u}(u.Component);de.displayName="Dashboard";const ce=(0,S.Z)((0,F.Z)(de));var le=(0,l.Z)("div",{target:"e1wa3gzn0",label:"WidgetContainer"})("display:grid;grid-template-columns:repeat(2,minmax(0,1fr));grid-auto-flow:row dense;grid-gap:",(0,D.Z)(2),";@media (min-width:",(function(e){return e.theme.breakpoints[1]}),"){grid-template-columns:repeat(4,minmax(0,1fr));}@media (min-width:",(function(e){return e.theme.breakpoints[3]}),"){grid-template-columns:repeat(6,minmax(0,1fr));}@media (min-width:",(function(e){return e.theme.breakpoints[4]}),"){grid-template-columns:repeat(8,minmax(0,1fr));}");function ue(e,t){return e.id?"".concat(e.id,"-index-").concat(t):"index-".concat(t)}var pe=a("./app/views/dashboardsV2/data.tsx"),he=a("../node_modules/@babel/runtime/helpers/esm/get.js"),fe=a("./app/components/asyncComponent.tsx"),be=a("./app/components/sentryDocumentTitle.tsx");function me(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ge(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?me(Object(a),!0).forEach((function(t){(0,c.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):me(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const ve=function(e){(0,i.Z)(u,e);var t,a,l=(t=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,d.Z)(t);if(a){var r=(0,d.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,s.Z)(this,e)});function u(){var e;(0,n.Z)(this,u);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return e=l.call.apply(l,[this].concat(a)),(0,c.Z)((0,o.Z)(e),"state",{loading:!0,reloading:!1,error:!1,errors:{},dashboards:[],selectedDashboard:null}),e}return(0,r.Z)(u,[{key:"componentDidUpdate",value:function(e){f()(e.params,this.props.params)||this.remountComponent()}},{key:"getEndpoints",value:function(){var e=this.props,t=e.organization,a=e.params,n="/organizations/".concat(t.slug,"/dashboards/"),r=[["dashboards",n]];return a.dashboardId&&(r.push(["selectedDashboard","".concat(n).concat(a.dashboardId,"/")]),(0,k.ec)({eventKey:"dashboards2.view",eventName:"Dashboards2: View dashboard",organization_id:parseInt(this.props.organization.id,10),dashboard_id:a.dashboardId})),r}},{key:"getDashboards",value:function(){var e=this.state.dashboards;return Array.isArray(e)?e:[]}},{key:"onRequestSuccess",value:function(e){var t=e.stateKey,a=e.data,n=this.props,r=n.params,o=n.organization,i=n.location;if(!r.dashboardId&&"selectedDashboard"!==t){var s=a.length?a[0].id:"default-overview",d="/organizations/".concat(o.slug,"/dashboards/").concat(s,"/");p.browserHistory.replace({pathname:d,query:ge({},i.query)})}}},{key:"renderBody",value:function(){var e=this.props.children,t=this.state,a=t.selectedDashboard;return e({error:t.error,dashboard:a,dashboards:this.getDashboards(),reloadData:this.reloadData.bind(this)})}},{key:"renderError",value:function(e){return Object.values(this.state.errors).find((function(e){return e&&404===e.status}))?(0,W.tZ)(g.Z,null):(0,he.Z)((0,d.Z)(u.prototype),"renderError",this).call(this,e,!0,!0)}},{key:"renderComponent",value:function(){var e=this.props,t=e.organization,a=e.location;return t.features.includes("dashboards-basic")?(0,W.tZ)(be.Z,{title:(0,w.t)("Dashboards"),orgSlug:t.slug},(0,he.Z)((0,d.Z)(u.prototype),"renderComponent",this).call(this)):(p.browserHistory.replace({pathname:"/organizations/".concat(t.slug,"/dashboards/"),query:ge({},a.query)}),null)}}]),u}(fe.Z);var ye=a("./app/components/editableText.tsx"),Ze=a("./app/styles/overflowEllipsis.tsx");function we(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function xe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?we(Object(a),!0).forEach((function(t){(0,c.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):we(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function De(e){var t=e.dashboard,a=e.isEditing,n=e.onUpdate;return(0,W.tZ)(Se,null,t?(0,W.tZ)(Ce,{isDisabled:!a,value:t.title,onChange:function(e){return n(xe(xe({},t),{},{title:e}))},errorMessage:(0,w.t)("Please set a title for this dashboard"),successMessage:(0,w.t)("Dashboard title updated successfully")}):(0,w.t)("Dashboards"))}De.displayName="DashboardTitle";const ke=De;var Se=(0,l.Z)("div",{target:"e13pghn50",label:"Container"})(Ze.Z,";margin-right:",(0,D.Z)(1),";margin-left:-11px;@media (max-width:",(function(e){return e.theme.breakpoints[2]}),"){margin-bottom:",(0,D.Z)(2),";}"),Ce=(0,l.Z)(ye.Z,{target:"e13pghn51",label:"StyledEditableText"})({name:"11mulvh",styles:"position:absolute;width:calc(100% + 11px);"}),ze=a("./app/views/dashboardsV2/utils.tsx");function Ee(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function je(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(a),!0).forEach((function(t){(0,c.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ee(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Oe=(0,w.t)("You have unsaved changes, are you sure you want to leave?"),Pe=function(e){(0,i.Z)(h,e);var t,a,l=(t=h,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,d.Z)(t);if(a){var r=(0,d.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,s.Z)(this,e)});function h(){var e;(0,n.Z)(this,h);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return e=l.call.apply(l,[this].concat(a)),(0,c.Z)((0,o.Z)(e),"state",{dashboardState:"view",modifiedDashboard:null}),(0,c.Z)((0,o.Z)(e),"onEdit",(function(t){return function(){t&&((0,k.ec)({eventKey:"dashboards2.edit.start",eventName:"Dashboards2: Edit start",organization_id:parseInt(e.props.organization.id,10)}),e.setState({dashboardState:"edit",modifiedDashboard:(0,ze.q)(t)}))}})),(0,c.Z)((0,o.Z)(e),"onRouteLeave",(function(){if(!["view","pending_delete"].includes(e.state.dashboardState))return Oe})),(0,c.Z)((0,o.Z)(e),"onUnload",(function(t){["view","pending_delete"].includes(e.state.dashboardState)||(t.preventDefault(),t.returnValue=Oe)})),(0,c.Z)((0,o.Z)(e),"onCreate",(function(){(0,k.ec)({eventKey:"dashboards2.create.start",eventName:"Dashboards2: Create start",organization_id:parseInt(e.props.organization.id,10)}),e.setState({dashboardState:"create",modifiedDashboard:(0,ze.q)(pe.R7)})})),(0,c.Z)((0,o.Z)(e),"onCancel",(function(){"create"===e.state.dashboardState?(0,k.ec)({eventKey:"dashboards2.create.cancel",eventName:"Dashboards2: Create cancel",organization_id:parseInt(e.props.organization.id,10)}):"edit"===e.state.dashboardState&&(0,k.ec)({eventKey:"dashboards2.edit.cancel",eventName:"Dashboards2: Edit cancel",organization_id:parseInt(e.props.organization.id,10)}),e.setState({dashboardState:"view",modifiedDashboard:null})})),(0,c.Z)((0,o.Z)(e),"onDelete",(function(t){return function(){var a=e.props,n=a.api,r=a.organization,o=a.location;if(null!=t&&t.id){var i=e.state.dashboardState;e.setState({dashboardState:"pending_delete"},(function(){(0,k.ec)({eventKey:"dashboards2.delete",eventName:"Dashboards2: Delete",organization_id:parseInt(e.props.organization.id,10)}),(0,b.iM)(n,r.slug,t.id).then((function(){(0,m.S9)((0,w.t)("Dashboard deleted")),p.browserHistory.replace({pathname:"/organizations/".concat(r.slug,"/dashboards/"),query:je({},o.query)})})).catch((function(){e.setState({dashboardState:i})}))}))}}})),(0,c.Z)((0,o.Z)(e),"onCommit",(function(t){var a=t.dashboard,n=t.reloadData;return function(){var t=e.props,r=t.api,o=t.organization,i=t.location,s=e.state,d=s.dashboardState,c=s.modifiedDashboard;switch(d){case"create":c&&(0,b.JR)(r,o.slug,c).then((function(t){(0,m.S9)((0,w.t)("Dashboard created")),(0,k.ec)({eventKey:"dashboards2.create.complete",eventName:"Dashboards2: Create complete",organization_id:parseInt(o.id,10)}),e.setState({dashboardState:"view",modifiedDashboard:null}),p.browserHistory.replace({pathname:"/organizations/".concat(o.slug,"/dashboards/").concat(t.id,"/"),query:je({},i.query)})}));break;case"edit":if(c)return f()(a,c)?void e.setState({dashboardState:"view",modifiedDashboard:null}):void(0,b.Y)(r,o.slug,c).then((function(t){(0,m.S9)((0,w.t)("Dashboard updated")),(0,k.ec)({eventKey:"dashboards2.edit.complete",eventName:"Dashboards2: Edit complete",organization_id:parseInt(o.id,10)}),e.setState({dashboardState:"view",modifiedDashboard:null}),a&&t.id!==a.id?p.browserHistory.replace({pathname:"/organizations/".concat(o.slug,"/dashboards/").concat(t.id,"/"),query:je({},i.query)}):n()}));e.setState({dashboardState:"view",modifiedDashboard:null});break;case"view":default:e.setState({dashboardState:"view",modifiedDashboard:null})}}})),(0,c.Z)((0,o.Z)(e),"onWidgetChange",(function(t){null!==e.state.modifiedDashboard&&e.setState((function(e){return je(je({},e),{},{modifiedDashboard:je(je({},e.modifiedDashboard),{},{widgets:t})})}))})),(0,c.Z)((0,o.Z)(e),"setModifiedDashboard",(function(t){e.setState({modifiedDashboard:t})})),(0,c.Z)((0,o.Z)(e),"onSaveWidget",(function(t){null!==e.state.modifiedDashboard&&e.setState((function(e){return je(je({},e),{},{modifiedDashboard:je(je({},e.modifiedDashboard),{},{widgets:t})})}),e.updateRouteAfterSavingWidget)})),e}return(0,r.Z)(h,[{key:"componentDidMount",value:function(){var e=this.props,t=e.route,a=e.router;this.checkStateRoute(),a.setRouteLeaveHook(t,this.onRouteLeave),window.addEventListener("beforeunload",this.onUnload)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onUnload)}},{key:"checkStateRoute",value:function(){if(this.isWidgetBuilderRouter&&!this.isEditing){var e=this.props,t=e.router,a=e.organization,n=e.params.dashboardId;t.replace("/organizations/".concat(a.slug,"/dashboards/").concat(n,"/"))}}},{key:"updateRouteAfterSavingWidget",value:function(){if(this.isWidgetBuilderRouter){var e=this.props,t=e.router,a=e.organization,n=e.params.dashboardId;t.replace("/organizations/".concat(a.slug,"/dashboards/").concat(n,"/"))}}},{key:"isEditing",get:function(){var e=this.state.dashboardState;return["edit","create","pending_delete"].includes(e)}},{key:"isWidgetBuilderRouter",get:function(){var e=this.props,t=e.location,a=e.params,n=e.organization,r=a.dashboardId;return t.pathname==="/organizations/".concat(n.slug,"/dashboards/").concat(r,"/widget/new/")}},{key:"renderDetails",value:function(e){var t=e.dashboard,a=e.dashboards,n=e.reloadData,r=e.error,o=this.props,i=o.organization,s=o.params,d=this.state,c=d.modifiedDashboard,l=d.dashboardState,u=s.dashboardId;return(0,W.tZ)(Z.Z,{skipLoadLastUsed:i.features.includes("global-views"),defaultSelection:{datetime:{start:null,end:null,utc:!1,period:pe.GY}}},(0,W.tZ)(x.JH,null,(0,W.tZ)(v.Z,{organization:i},(0,W.tZ)(Re,null,(0,W.tZ)(ke,{dashboard:c||t,onUpdate:this.setModifiedDashboard,isEditing:this.isEditing}),(0,W.tZ)(U,{organization:i,dashboards:a,dashboard:t,onEdit:this.onEdit(t),onCreate:this.onCreate,onCancel:this.onCancel,onCommit:this.onCommit({dashboard:t,reloadData:n}),onDelete:this.onDelete(t),dashboardState:l})),r?(0,W.tZ)(g.Z,null):t?(0,W.tZ)(ce,{dashboard:c||t,paramDashboardId:u,organization:i,isEditing:this.isEditing,onUpdate:this.onWidgetChange}):(0,W.tZ)(y.Z,null))))}},{key:"renderWidgetBuilder",value:function(e){var t=this.props.children,a=this.state.modifiedDashboard;return u.isValidElement(t)?u.cloneElement(t,{dashboard:a||e,onSave:this.onSaveWidget}):t}},{key:"render",value:function(){var e=this,t=this.props,a=t.api,n=t.location,r=t.params,o=t.organization;return(0,W.tZ)(ve,{api:a,location:n,params:r,organization:o},(function(t){var a=t.dashboard,n=t.dashboards,r=t.error,o=t.reloadData;return e.isEditing&&e.isWidgetBuilderRouter?e.renderWidgetBuilder(a):e.renderDetails({dashboard:a,dashboards:n,error:r,reloadData:o})}))}}]),h}(u.Component);Pe.displayName="DashboardDetail";var Re=(0,l.Z)("div",{target:"e1anno2f0",label:"StyledPageHeader"})("display:flex;align-items:center;justify-content:space-between;font-size:",(function(e){return e.theme.headerFontSize}),";color:",(function(e){return e.theme.textColor}),";height:40px;margin-bottom:",(0,D.Z)(2),";@media (max-width:",(function(e){return e.theme.breakpoints[2]}),"){flex-direction:column;align-items:flex-start;height:auto;}");const _e=(0,S.Z)((0,C.Z)(Pe))}}]);
//# sourceMappingURL=DashboardDetail.js.map