(self.webpackChunk=self.webpackChunk||[]).push([["app_views_eventsV2_table_queryField_tsx"],{"./app/views/eventsV2/table/queryField.tsx":(e,n,t)=>{"use strict";t.d(n,{q:()=>F});var a=t("../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),r=t("../node_modules/@babel/runtime/helpers/esm/extends.js"),i=t("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),l=t("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=t("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),u=t("../node_modules/@babel/runtime/helpers/esm/inherits.js"),s=t("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),d=t("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),p=t("../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),f=t("../node_modules/react/index.js"),m=t("../node_modules/react-select/dist/chunk-80640036.browser.esm.js"),h=t("../node_modules/lodash/cloneDeep.js"),v=t.n(h),g=t("./app/components/forms/selectControl.tsx"),b=t("./app/components/tag.tsx"),k=t("./app/locale.tsx"),y=t("./app/styles/space.tsx"),Z=t("./app/views/settings/components/forms/controls/input.tsx"),O=t("./app/views/eventsV2/table/types.tsx"),w=t("../node_modules/@emotion/core/dist/core.browser.esm.js");function C(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function j(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?C(Object(t),!0).forEach((function(n){(0,c.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function T(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,a=(0,d.Z)(e);if(n){var r=(0,d.Z)(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return(0,s.Z)(this,t)}}var F=function(e){(0,u.Z)(t,e);var n=T(t);function t(){var e;(0,i.Z)(this,t);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return e=n.call.apply(n,[this].concat(r)),(0,c.Z)((0,o.Z)(e),"handleFieldChange",(function(n){if(n){var t=n.value,a=e.props.fieldValue,r=v()(e.props.fieldValue);switch(t.kind){case O.L.TAG:case O.L.MEASUREMENT:case O.L.BREAKDOWN:case O.L.FIELD:r={kind:"field",field:t.meta.name};break;case O.L.FUNCTION:"field"===a.kind?r={kind:"function",function:[t.meta.name,"",void 0]}:"function"===a.kind&&(r={kind:"function",function:[t.meta.name,a.function[1],a.function[2]]});break;default:throw new Error("Invalid field type found in column picker")}t.kind===O.L.FUNCTION&&(t.meta.parameters.forEach((function(n,t){if("function"===r.kind)if("column"===n.kind){var a=e.getFieldOrTagOrMeasurementValue(r.function[t+1]);null===a?r.function[t+1]=n.defaultValue||"":a.kind!==O.L.FIELD&&a.kind!==O.L.TAG&&a.kind!==O.L.MEASUREMENT&&a.kind!==O.L.BREAKDOWN||!L(n.columnTypes,a)?(r.function[t+1]=n.defaultValue||"",r.function[t+2]=void 0):r.function[t+1]=a.meta.name}else"value"===n.kind&&(r.function[t+1]=n.defaultValue||"")})),"function"===r.kind&&(0===t.meta.parameters.length?r.function=[r.function[0],"",void 0]:1===t.meta.parameters.length&&(r.function[2]=void 0))),e.triggerChange(r)}})),(0,c.Z)((0,o.Z)(e),"handleFieldParameterChange",(function(n){var t=n.value,a=v()(e.props.fieldValue);"function"===a.kind&&(a.function[1]=t.meta.name),e.triggerChange(a)})),(0,c.Z)((0,o.Z)(e),"handleScalarParameterChange",(function(n){var t=v()(e.props.fieldValue);"function"===t.kind&&(t.function[1]=n),e.triggerChange(t)})),(0,c.Z)((0,o.Z)(e),"handleRefinementChange",(function(n){var t=v()(e.props.fieldValue);"function"===t.kind&&(t.function[2]=n),e.triggerChange(t)})),e}return(0,l.Z)(t,[{key:"triggerChange",value:function(e){this.props.onChange(e)}},{key:"getFieldOrTagOrMeasurementValue",value:function(e){var n=this.props.fieldOptions;if(void 0===e)return null;var t="field:".concat(e);if(n[t])return n[t].value;var a="measurement:".concat(e);if(n[a])return n[a].value;var r="span_op_breakdown:".concat(e);if(n[r])return n[r].value;var i=0===e.indexOf("tags[")?"tag:".concat(e.replace(/tags\[(.*?)\]/,"$1")):"tag:".concat(e);return n[i]?n[i].value:e.length>0?{kind:O.L.TAG,meta:{name:e,dataType:"string",unknown:!0}}:null}},{key:"getFieldData",value:function(){var e=this,n=null,t=this.props.fieldValue,a=this.props.fieldOptions;if("function"===t.kind){var r="function:".concat(t.function[0]);void 0!==a[r]&&(n=a[r].value)}"field"===t.kind&&(n=this.getFieldOrTagOrMeasurementValue(t.field),a=this.appendFieldIfUnknown(a,n));var i=[];return n&&n.kind===O.L.FUNCTION&&n.meta.parameters.length>0&&t.kind===O.L.FUNCTION&&(i=n.meta.parameters.map((function(n,r){if("column"===n.kind){var i=e.getFieldOrTagOrMeasurementValue(t.function[1]);return a=e.appendFieldIfUnknown(a,i),{kind:"column",value:i,required:n.required,options:Object.values(a).filter((function(e){var t=e.value;return(t.kind===O.L.FIELD||t.kind===O.L.TAG||t.kind===O.L.MEASUREMENT||t.kind===O.L.BREAKDOWN)&&L(n.columnTypes,t)}))}}return{kind:"value",value:"function"===t.kind&&t.function[r+1]||n.defaultValue||"",dataType:n.dataType,required:n.required}}))),{field:n,fieldOptions:a,parameterDescriptions:i}}},{key:"appendFieldIfUnknown",value:function(e,n){return n?(n&&n.kind===O.L.TAG&&n.meta.unknown&&((e=Object.assign({},e))[n.meta.name]={label:n.meta.name,value:n}),e):e}},{key:"renderParameterInputs",value:function(e){var n=this,t=this.props,a=t.disabled,i=t.inFieldLabels,l=t.filterAggregateParameters,o=e.map((function(e,t){if("column"===e.kind&&e.options.length>0){var o=l?e.options.filter(l):e.options;return(0,w.tZ)(g.Z,{key:"select",name:"parameter",placeholder:(0,k.t)("Select value"),options:o,value:e.value,required:e.required,onChange:n.handleFieldParameterChange,inFieldLabel:i?(0,k.t)("Parameter: "):void 0,disabled:a})}if("value"===e.kind){var u=0===t?n.handleScalarParameterChange:n.handleRefinementChange,s={required:e.required,value:e.value,onUpdate:u,disabled:a};switch(e.dataType){case"number":return(0,w.tZ)(E,(0,r.Z)({name:"refinement",key:"parameter:number",type:"text",inputMode:"numeric",pattern:"[0-9]*(\\.[0-9]*)?"},s));case"integer":return(0,w.tZ)(E,(0,r.Z)({name:"refinement",key:"parameter:integer",type:"text",inputMode:"numeric",pattern:"[0-9]*"},s));default:return(0,w.tZ)(E,(0,r.Z)({name:"refinement",key:"parameter:text",type:"text"},s))}}throw new Error("Unknown parameter type encountered for ".concat(n.props.fieldValue))})),u=this.props.gridColumns,s=(null!=u?u:o.length+1)-o.length-1;if(void 0!==u&&s>0)for(var d=0;d<s;d++)o.push((0,w.tZ)(V,{key:d}));return o}},{key:"renderTag",value:function(e){var n,t;if(!1===this.props.shouldRenderTag)return null;switch(e){case O.L.FUNCTION:n="f(x)",t="success";break;case O.L.MEASUREMENT:n="measure",t="info";break;case O.L.BREAKDOWN:n="breakdown",t="error";break;case O.L.TAG:n=e,t="warning";break;case O.L.FIELD:n=e,t="highlight";break;default:n=e}return(0,w.tZ)(b.Z,{type:t},n)}},{key:"render",value:function(){var e=this,n=this.props,t=n.className,i=n.takeFocus,l=n.filterPrimaryOptions,o=n.inFieldLabels,u=n.disabled,s=this.getFieldData(),d=s.field,c=s.fieldOptions,p=s.parameterDescriptions,f=l?Object.values(c).filter(l):Object.values(c),h={name:"field",options:Object.values(f),placeholder:(0,k.t)("(Required)"),value:d,onChange:this.handleFieldChange,inFieldLabel:o?(0,k.t)("Function: "):void 0,disabled:u};i&&null===d&&(h.autoFocus=!0);var v={singleValue:function(e){return j(j({},e),{display:"flex",justifyContent:"space-between",alignItems:"center",width:"calc(100% - 10px)"})},option:function(e){return j(j({},e),{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"})}},b=this.renderParameterInputs(p);return(0,w.tZ)(x,{className:t,gridColumns:b.length+1},(0,w.tZ)(g.Z,(0,r.Z)({},h,{styles:o?void 0:v,components:{Option:function(n){var t=n.label,i=n.data,l=(0,a.Z)(n,["label","data"]);return(0,w.tZ)(m.y.Option,(0,r.Z)({label:t,data:i},l),(0,w.tZ)("span",{"data-test-id":"label"},t),e.renderTag(i.value.kind))},SingleValue:function(n){var t=n.data,i=(0,a.Z)(n,["data"]);return(0,w.tZ)(m.y.SingleValue,(0,r.Z)({data:t},i),(0,w.tZ)("span",{"data-test-id":"label"},t.label),e.renderTag(t.value.kind))}}})),b)}}]),t}(f.Component);function L(e,n){return"function"==typeof e?e({name:n.meta.name,dataType:n.meta.dataType}):e.includes(n.meta.dataType)}F.displayName="QueryField";var x=(0,p.Z)("div",{target:"eve9joo0",label:"Container"})("display:grid;grid-template-columns:repeat(",(function(e){return e.gridColumns}),",1fr);grid-column-gap:",(0,y.Z)(1),";align-items:center;flex-grow:1;"),E=function(e){(0,u.Z)(t,e);var n=T(t);function t(e){var a;return(0,i.Z)(this,t),a=n.call(this,e),(0,c.Z)((0,o.Z)(a),"state",{value:a.props.value}),(0,c.Z)((0,o.Z)(a),"input",void 0),(0,c.Z)((0,o.Z)(a),"handleBlur",(function(){a.isValid?a.props.onUpdate(a.state.value):a.setState({value:a.props.value})})),(0,c.Z)((0,o.Z)(a),"handleChange",(function(e){a.isValid&&a.setState({value:e.target.value})})),a.input=f.createRef(),a}return(0,l.Z)(t,[{key:"isValid",get:function(){return!this.input.current||this.input.current.validity.valid}},{key:"render",value:function(){var e=this.props,n=(e.onUpdate,(0,a.Z)(e,["onUpdate"]));return(0,w.tZ)(N,(0,r.Z)({},n,{ref:this.input,className:"form-control",value:this.state.value,onChange:this.handleChange,onBlur:this.handleBlur}))}}]),t}(f.Component);E.displayName="BufferedInput";var N=(0,p.Z)(Z.Z,{target:"eve9joo1",label:"StyledInput"})({name:"141chpg",styles:"height:41px;min-width:50px;"}),V=(0,p.Z)("div",{target:"eve9joo2",label:"BlankSpace"})("height:41px;min-width:50px;background:",(function(e){return e.theme.backgroundSecondary}),";border-radius:",(function(e){return e.theme.borderRadius}),";display:flex;align-items:center;justify-content:center;&:after{font-size:",(function(e){return e.theme.fontSizeMedium}),";content:'",(0,k.t)("No parameter"),"';color:",(function(e){return e.theme.gray300}),";}")}}]);
//# sourceMappingURL=app_views_eventsV2_table_queryField_tsx.js.map