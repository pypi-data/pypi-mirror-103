(self.webpackChunktoon_note=self.webpackChunktoon_note||[]).push([[568],{568:(e,t,o)=>{"use strict";o.r(t),o.d(t,{CaptureEventsButtonExtension:()=>V,ToggleInputCodeButton:()=>z,ResetButton:()=>K,default:()=>q});var n=o(83),i=o(751),l=o(850),r=o(120),s=o(129),a=o(669);const d="intermediate",u="full",c="half",m="third",p="twothird",f="1100px";var h,y,v,g,b;let A=!1;class E{constructor(e){this.reset=function(){this.mouseEventType=new Array,this.relativeMousePosXArray=new Array,this.relativeMousePosYArray=new Array,this.childIndexArray=new Array,this.mouseClickTrails=new Array},this.updateMetadata=function(){let e=h.activeNotebookPanel.content.model.cells;for(let t=0;t<e.length;++t)if(e.get(t).id==this.id)return e.get(t).metadata.set("mouseEventType",this.mouseEventType),e.get(t).metadata.set("relativeMousePosXArray",this.relativeMousePosXArray),e.get(t).metadata.set("relativeMousePosYArray",this.relativeMousePosYArray),e.get(t).metadata.set("childIndexArray",this.childIndexArray),void e.get(t).metadata.set("mouseClickTrails",this.mouseClickTrails)},this.updateFromMetadata=function(){let e=h.activeNotebookPanel.content.model.cells;for(let t=0;t<e.length;++t)if(e.get(t).id==this.id&&e.get(t).metadata.has("mouseEventType"))return this.mouseEventType=e.get(t).metadata.get("mouseEventType"),this.relativeMousePosXArray=e.get(t).metadata.get("relativeMousePosXArray"),this.relativeMousePosYArray=e.get(t).metadata.get("relativeMousePosYArray"),this.childIndexArray=e.get(t).metadata.get("childIndexArray"),this.mouseClickTrails=e.get(t).metadata.get("mouseClickTrails"),!0;return!1},this.id=e,this.reset()}}const w={id:"toon_note:plugin",requires:[n.IMainMenu,i.INotebookTools,i.INotebookTracker],autoStart:!0,activate:(e,t,o,n)=>{console.log("JupyterLab extension toon_note is activated!");const{commands:l}=e,r="viewmenu:command",s="viewmenu:intermediatecommand";h=o,y=n,v=new Array,g=new Array,b=new Array;var a=new z;e.docRegistry.addWidgetExtension("Notebook",a);var d=new K;e.docRegistry.addWidgetExtension("Notebook",d);var u=new V;e.docRegistry.addWidgetExtension("Notebook",u),i.NotebookActions.executed.connect(C),y.currentChanged.connect((()=>{setTimeout((()=>{let e=y.currentWidget.node.getElementsByClassName("jp-NotebookPanel-notebook").item(0);e.style.width=f,e.style.minWidth=f,e.style.maxWidth=f}),1e4)})),l.addCommand(r,{label:"Comic Command",isToggled:()=>A,execute:()=>{A=!A;let e=o.activeNotebookPanel.content.widgets;for(let o=0;o<e.length;++o){var t=!1;I(n=e[o])&&(t=!0,"code"==n.model.type?j(n,A):"markdown"==n.model.type&&(A?n.hide():n.show()),!A&&B(n)&&(c?n.show():n.hide())),t||(A?n.node.style.setProperty("display","none"):n.node.style.setProperty("display",""))}if(A)for(let t=0;t<e.length;++t){var n;I(n=e[t])&&"code"==n.model.type&&X(L(n.node).output_arr[0].item(0).parentElement,n)}o.activeCell.node.scrollIntoView(!0)}});let c=!1;l.addCommand(s,{label:"intermediate",isToggled:()=>c,execute:()=>{c=!c;let e=o.activeNotebookPanel.content.widgets;for(let o=0;o<e.length;++o){var t=e[o];B(t)&&(c?t.show():t.hide())}o.activeCell.node.scrollIntoView(!0)}}),t&&(t.viewMenu.addGroup([{command:r}]),t.viewMenu.addGroup([{command:s}])),l.addKeyBinding({command:r,args:{},keys:["Accel Shift C"],selector:".jp-Notebook"}),l.addKeyBinding({command:s,args:{},keys:["Accel Shift I"],selector:".jp-Notebook"})}};function C(e,t){"code"==t.cell.model.type&&setTimeout((function(){var e=t.cell;if(b.push(e.model.id),g.push(e.outputArea.node),b.length>0&&!x){N();var o=function(){setTimeout((function(){x?o():P(e)}),500)};o()}else P(e)}),1e3)}var k,x=!1,T=!1;const N=function(){if(b.length>0){x=!0,T=!0;let t=b.shift(),o=M(t);if(null==o)return x=!1,void(T=!1);let n=0;o.updateFromMetadata();let i=g.shift(),l=0;var e=function(){setTimeout((function(){if(l>=o.mouseEventType.length)return void N();let t=i.children[o.childIndexArray[l]];t=t.getElementsByClassName("jp-OutputArea-output")[0],t.scrollIntoView(!0);let r=t.getBoundingClientRect(),s=r.width*o.relativeMousePosXArray[l]+r.left,a=r.height*o.relativeMousePosYArray[l]+r.top;if("click"==o.mouseEventType[l]||"dblclick"==o.mouseEventType[l]){for(let e=o.mouseClickTrails[n].length-1;e>=0;--e){let i=o.mouseClickTrails[n][e];t=t.children[i]}s=t.clientLeft+t.scrollLeft+1,a=t.clientTop+t.scrollTop+1}let d=new MouseEvent(o.mouseEventType[l],{bubbles:!0,clientX:s,clientY:a});if("click"==o.mouseEventType[l]||"dblclick"==o.mouseEventType[l])t.dispatchEvent(d),n++;else{let e=document.elementFromPoint(s,a);null!=e&&void 0!==e&&e.dispatchEvent(d)}l++,e()}),25)};e()}else x=!1,T=!1},M=function(e){for(let t=0;t<v.length;++t)if(v[t].id==e)return v[t];let t=new E(e);return t.updateFromMetadata(),v.push(t),t};function P(e){if(I(e)){var t=L(e.node);t.frame.setAttribute("style",""),t.frame.parentElement.parentElement.parentElement.setAttribute("style",""),j(e,A),t.frame.scrollIntoView(!0)}}function I(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>"comic"==e||e==d)))return!0}return!1}function B(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>e==d)))return!0}return!1}function L(e){var t=[e.getElementsByClassName("jp-Cell-inputWrapper")],o=[e.getElementsByClassName("jp-Cell-outputWrapper")],n=o[0].item(0).getElementsByClassName("jp-OutputArea-child").item(0),i=t[0].item(0);return{arr:t,output_arr:o,frame:n,codecell:i}}function j(e,t){var o=L(e.node),n=o.arr,i=o.frame,l=o.codecell;if(t){e.show(),Y(i,O(e),W(e)),function(e){let t=e.parentElement.getElementsByClassName("jp-OutputArea-executeResult"),o=e.parentElement.firstElementChild,n=e.parentElement.lastElementChild;if(t.length>0)for(let e of t)e!=o&&e==n&&e.setAttribute("style","display:none")}(i),function(e){e.firstElementChild.nextElementSibling.setAttribute("style","width:100%;overflow: hidden;")}(i),l.setAttribute("style","display: none;"),function(e,t){(function(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>"img"==e)))return!0}return!1})(t)&&e.getElementsByClassName("jp-OutputArea-output")[0].firstElementChild.setAttribute("style","width:100%; height:100%; object - fit: cover;")}(i,e);var r=_(e);if(null!=r){var s=r.node;let e=function(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>"bottom"==e)))return!0}return!1}(r),t=function(e,t){var o=e.firstChild.nextSibling.lastChild.childNodes[2].textContent;let n="top:0px;";t&&(n="bottom:0px;");var i=document.createElement("p");return i.innerText=o,i.style.cssText="color: black; border:1px solid black; z-index:1; background-color:white; width: auto; height:auto; position:absolute !important; margine:4px; font-size: large;"+n,i.setAttribute("class","annobox"),i}(s,e);i.firstChild.after(t),function(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>"stack"==e)))return!0}return!1}(r)&&(e?i.getElementsByClassName("jp-OutputArea-output").item(0).setAttribute("style","width:100%;overflow: hidden; margin-bottom:"+t.clientHeight+"px;"):i.getElementsByClassName("jp-OutputArea-output").item(0).setAttribute("style","width:100%;overflow: hidden; margin-top:"+t.clientHeight+"px;")),r.hide()}}else{var a=document.getElementsByClassName("new_frame");if(null==a)return;var d=document.getElementsByClassName("annobox");if(n[0].item(0).setAttribute("style","display: ;"),i.setAttribute("style",""),i.firstElementChild.setAttribute("style","display:;"),i.parentElement.parentElement.parentElement.setAttribute("style",""),null!=d[0])for(var u=0;u<d.length;u++)d[u].remove();if(null!=a[0])for(u=0;u<a.length;u++)a[u].remove()}}function X(e,t){let o=h.activeNotebookPanel.content.widgets,n=o.findIndex((e=>e==t)),i=e.offsetLeft,l=-1;for(let e=n-1;e>=0;--e)if(I(o[e])&&"code"==o[e].model.type&&o[e].node.offsetLeft<i){l=e;break}if(l<0)return;let r=e.offsetTop+e.clientHeight-(o[l].node.offsetTop+o[l].node.clientHeight);if(r>0)if(r>e.clientHeight/2){let e=-1;for(let t=n-1;t>l;--t)if(I(o[t])&&"code"==o[t].model.type&&o[t].node.offsetLeft==i){e=t;break}if(e>0){let t=o[e].node.getElementsByClassName("jp-Cell-outputWrapper").item(0).parentElement,n=o[l].node.offsetTop+o[l].node.clientHeight-(t.offsetTop+t.clientHeight)+.5;t.style.marginBottom=n+"px"}}else o[l].node.style.marginBottom=r+"px"}function Y(e,t,o){let n=e.parentElement.parentElement.parentElement;n.setAttribute("style","width:100%; position:relative; float:left; resize:both; overflow:hidden; height:auto;"),e.style.backgroundColor="white",e.style.border="solid 2px",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.style.position="relative",e.style.margin="0px !important",e.style.float="left",n.style.width=t==u?"100%":t==m?"33.3%":t==p?"66.6%":"50%",""!=o&&(n.style.height=o),e.firstElementChild.setAttribute("style","display:none;")}function O(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t){if(t.find((e=>e==u)))return u;if(t.find((e=>e==c)))return c;if(t.find((e=>e==m)))return m;if(t.find((e=>e==p)))return p}}}function W(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t)for(let e=0;e<t.length;++e)if(t[e].startsWith("height"))return t[e].split(":")[1]}return""}function _(e){let t=h.activeNotebookPanel.content.widgets;for(let o=0;o<t.length;++o)if(t[o]==e){let e=0,n=-1;for(let i=o-1;i>=0&&(n=i,"code"==t[i].model.type&&I(t[i]));--i)e++;for(let o=n;o>=0;--o)if("markdown"!=t[o].model.type||!I(t[o])){let i=o+1+e;if(i<=n)return t[i];break}break}return null}const R=function(e){let t=e.target;for(;null!=t&&!t.classList.contains("jp-OutputArea-child");)t=t.parentElement;if(null!=t)for(let e=0;e<t.parentElement.childElementCount;++e)if(t.parentElement.children[e]==t)return t=t.getElementsByClassName("jp-OutputArea-output")[0],{rect:t.getBoundingClientRect(),index:e};return{rect:null,index:-1}},H=function(e){if(T)return;let t=R(e);if(!(t.index<0)){var o=h.activeCell.model.id,n=M(o);n.childIndexArray.push(t.index),n.relativeMousePosXArray.push((e.clientX-t.rect.left)/t.rect.width),n.relativeMousePosYArray.push((e.clientY-t.rect.top)/t.rect.height),n.mouseEventType.push(e.type),n.mouseClickTrails.push(function(e,t){var o;o=new Array;let n=document.elementFromPoint(e,t);for(;null!=n&&!n.classList.contains("jp-OutputArea-output");){for(let e=0;e<n.parentElement.children.length;++e)if(n.parentElement.children[e]==n){o.push(e);break}n=n.parentElement}return o}(e.clientX,e.clientY))}},D=e=>{if(T)return;var t=R(e);let o=t.index;if(!(o<0)){var n=h.activeCell.model.id,i=M(n);i.childIndexArray.push(o),k=t.rect,i.relativeMousePosXArray.push((e.clientX-k.left)/k.width),i.relativeMousePosYArray.push((e.clientY-k.top)/k.height),i.mouseEventType.push(e.type),document.addEventListener("mousemove",S),document.addEventListener("mouseup",F)}},S=e=>{if(T)return;var t=h.activeCell.model.id,o=M(t);let n=o.childIndexArray;n.push(n[n.length-1]);var i=k;o.relativeMousePosXArray.push((e.clientX-i.left)/i.width),o.relativeMousePosYArray.push((e.clientY-i.top)/i.height),o.mouseEventType.push(e.type)},F=function(e){if(T)return;var t=h.activeCell.model.id,o=M(t);let n=o.childIndexArray;n.push(n[n.length-1]);var i=k;o.relativeMousePosXArray.push((e.clientX-i.left)/i.width),o.relativeMousePosYArray.push((e.clientY-i.top)/i.height),o.mouseEventType.push(e.type),document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",F),k=null};class V{createNew(e,t){let o=new r.ToolbarButton({className:"record",icon:a.editIcon,onClick:()=>{if(x=!1,T=!1,"code"==e.content.activeCell.model.type){var t=e.content.activeCell;(function(e){let t=!1;for(let o=0;o<v.length;++o)if(v[o].id==e){t=!0;break}return t})(t.model.id)||v.push(new E(t.model.id)),M(t.model.id).reset(),t.outputArea.widgets.forEach((e=>{let t=(0,l.toArray)(e.children());for(var o=0;o<t.length;++o)t[o].node.classList.contains("jp-OutputArea-output")&&(t[o].node.removeEventListener("click",H),t[o].node.removeEventListener("dblclick",H),t[o].node.removeEventListener("mousedown",D),t[o].node.addEventListener("click",H),t[o].node.addEventListener("dblclick",H),t[o].node.addEventListener("mousedown",D))}))}},tooltip:"record actions"}),n=new r.ToolbarButton({className:"stop",icon:a.stopIcon,onClick:()=>{if("code"==e.content.activeCell.model.type){var t=e.content.activeCell;M(t.model.id).updateMetadata()}},tooltip:"stop recording"});return e.toolbar.insertItem(2,"record",o),e.toolbar.insertItem(3,"stop",n),new s.DisposableDelegate((()=>{o.dispose(),n.dispose()}))}}class z{constructor(){this.previousMargin=""}createNew(e,t){let o=new r.ToolbarButton({className:"showCode",icon:a.searchIcon,onClick:()=>{if(A){var t=e.content.activeCell;if(null!=t&&"code"==t.model.type){var o=L(t.node),n=o.frame,i=o.codecell,l=!1;"display: ;"==i.getAttribute("style")&&(l=!0);var r=_(t);for(var s of(l?(Y(n,O(t),W(t)),null==r||r.hide(),o.output_arr[0].item(0).parentElement.style.marginBottom=this.previousMargin):(this.previousMargin=o.output_arr[0].item(0).parentElement.style.marginBottom,n.setAttribute("style",""),n.parentElement.parentElement.parentElement.setAttribute("style",""),n.firstElementChild.setAttribute("style","display:;"),null==r||r.show()),l?i.setAttribute("style","display: none;"):i.setAttribute("style","display: ;"),n.children))if("annobox"==s.className){var a=s.getAttribute("style");a=l?a.replace("display: none;",""):a.concat("display: none;"),s.setAttribute("style",a)}n.scrollIntoView(!0)}}},tooltip:"Show Comic code"});return e.toolbar.insertItem(0,"showCC",o),new s.DisposableDelegate((()=>{o.dispose()}))}}function G(){i.NotebookActions.executed.disconnect(G),i.NotebookActions.executed.connect(C)}class K{createNew(e,t){let o=new r.ToolbarButton({className:"reset",icon:a.refreshIcon,onClick:()=>{let t=e.content.activeCell.model.id,o=M(t);o.reset(),o.updateMetadata(),i.NotebookActions.executed.disconnect(C),i.NotebookActions.executed.connect(G),i.NotebookActions.run(e.content,e.sessionContext)},tooltip:"Reset cell"});return e.toolbar.insertItem(1,"reset",o),new s.DisposableDelegate((()=>{o.dispose()}))}}const q=w}}]);